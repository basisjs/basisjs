// filelist: 
//   ../../../src/basis/date.js
//   ../../../src/basis/ua.js
//   ../../../src/basis/dom.js
//   ../../../src/basis/event.js
//   ../../../src/basis/data.js
//   ../../../src/basis/data/dataset.js
//   ../../../src/basis/timer.js
//   ../../../src/basis/dom/event.js
//   ../../../src/basis/cssom.js
//   ../../../src/basis/data/property.js
//   ../../../src/basis/data/index.js
//   ../../../src/basis/l10n.js
//   ../../../src/basis/dom/wrapper.js
//   ../../../src/basis/template.js
//   ../../../src/basis/html.js
//   ../../../src/basis/ui.js
//   ../../../src/basis/layout.js
//   ../../../src/basis/dragdrop.js
//   ../../../src/basis/ui/paginator.js
//   blog.js
//   ../../../src/basis/entity.js
(function(){
'use strict';

(function(global){"use strict";var document=global.document;var externalResourceCache={"15.js":function(exports,module,basis,global,__filename,__dirname,resource){alert("hello world")},"16.json":'[{"id":1,"pubDate":"2008-07-29T23:49:05.107","title":"consequat reprehenderit in aliqua dolor in","content":"cillum commodo voluptate et enim quis id reprehenderit sed in incididunt adipisicing id et anim in Excepteur","category":"js","tags":""}]',"17.tmpl":[[1,0,["element"],"div",[[2,0,0,"class","blog-post"]],[[1,0,0,"h2",[[2,0,0,"class","blog-post__title"]],[[3,"title",["title"]]]],[1,0,0,"span",[[2,0,0,"class","blog-post__pubDate"]],[[3,0,0,"[#"],[3,"id",["id"]],[3,0,0,"] "],[3,"pubDate",["pubDate"]]]],[1,"content",["content"],"div",[[2,0,0,"class","blog-post__content"]],0],[1,0,0,"div",[[2,0,0,"class","blog-post__footer"]],[[1,0,0,"span",[[2,0,0,"class","blog-post__category"]],[[3,0,0,"Category: "],[1,0,0,"span",[[2,0,0,"class","blog-post__category-link"],[2,0,0,"event-click","filterByCategory"]],[[3,"category",["category"]]]]]],[8,"tagList",["tagList"]]]]]]],"18.tmpl":[[1,0,["element"],"div",[[2,0,0,"class","blog-post__tag-list"]],[[3,0,0,"Tags: "],[8,"childNodesHere",["childNodesHere"]]]]],"19.tmpl":[[1,0,["element"],"span",[[2,0,0,"class","blog-post-tag"]],[[1,0,0,"span",[[2,0,0,"class","blog-post-tag__title"],[2,0,0,"event-click","pick"]],[[3,"title",["title"]]]]]]],"20.tmpl":[[1,0,["element"],"div",[[2,0,0,"class","category-list"]],[[1,0,0,"h2",[[2,0,0,"class","category-list__header"]],[[3,0,0,"Category"]]],[1,"childNodesElement",["childNodesElement"],"ul",[[2,0,0,"class","category-list__content"]],0]]]],"21.tmpl":[[1,0,["element"],"li",[[2,0,0,"class","category-list-item"],[2,0,0,"event-click","choose"]],[[3,"title",["title"]]]]],"22.tmpl":[[1,0,["element"],"li",[[2,0,0,"class","archive-year"]],[[1,0,0,"div",[[2,[["archive-year__title_","collapsed",0]],0,"class","archive-year__title"],[2,0,0,"event-click","toggle"]],[[3,"title",["title"]]]],[1,"childNodesElement",["childNodesElement"],"ul",[[2,[["archive-year__content_","collapsed",0]],0,"class","archive-year__content"]],0]]]],"23.tmpl":[[1,0,["element"],"div",[[2,0,0,"class","archive-list"]],[[1,0,0,"h2",[[2,0,0,"class","archive-list__header"]],[[3,0,0,"Archive"]]],[1,"childNodesElement",["childNodesElement"],"ul",[[2,0,0,"class","archive-list__content"]],0]]]],"24.tmpl":[[1,0,["element"],"li",[[2,0,0,"class","archive-list-item"]],[[1,0,0,"span",[[2,0,0,"class","archive-list-item__link"],[2,0,0,"event-click","choose"]],[[3,"title",["title"]]]],[3,0,0," ("],[3,"count",["count"]],[3,0,0,")"]]]],"25.tmpl":[[1,0,["element"],"div",[[2,0,0,"id","tag-cloud"],[2,0,0,"class","tag-cloud"]],[[1,0,0,"h2",[[2,0,0,"class","tag-cloud__header"]],[[3,0,0,"Tags cloud"]]],[1,"childNodesElement",["childNodesElement"],"div",[[2,0,0,"class","tag-cloud__content"]],0]]]],"26.tmpl":[[1,0,["element"],"span",[[2,0,0,"class","cloud-tag"],[2,0,0,"event-click","pick"],[2,[[["fontSize"],[0],"font-size"]],0,"style",""]],[[3,0,0," "],[3,"title",["title"]],[3,0,0," "]]]],"27.tmpl":[[1,0,["element"],"div",[[2,0,0,"id","page"]],[[1,0,0,"div",[[2,0,0,"id","page-wrapper"]],[[1,0,0,"div",[[2,0,0,"id","sidebar"]],[[8,"categoryList",["categoryList"]],[8,"tagCloud",["tagCloud"]],[8,"archiveList",["archiveList"]]]],[1,"content",["content"],"div",[[2,0,0,"id","content"]],[[1,0,0,"h1",0,[[3,0,0,"Basis.js blog"]]],[8,"stat",["stat"]],[1,0,0,"button",[[2,0,0,"event-click","reset"]],[[3,0,0,"Show all posts"]]],[8,"paginator",["paginator"]],[8,"postList",["postList"]]]]]]]]],"38.tmpl":[[1,0,["element"],"td",[[2,0,0,"class","Basis-PaginatorNode"]],[[1,0,0,"span",0,[[1,"link",["link"],"a",[[2,[["","selected",0],["","disabled",0]],0,"class",""],[2,0,0,"event-click","click"],[2,0,0,"href","#"]],[[3,"pageNumber",["pageNumber"]]]]]]]]],"39.tmpl":[[1,0,["element"],"div",[[2,[["Basis-Paginator-","noScroll",0],["","selected",0],["","disabled",0]],0,"class","Basis-Paginator"],[2,0,0,"event-mousewheel","scroll"]],[[1,0,0,"table",0,[[1,0,0,"tbody",0,[[1,"childNodesElement",["childNodesElement"],"tr",0,0]]]]],[1,"scrollbarContainer",["scrollbarContainer"],"div",[[2,0,0,"class","Basis-Paginator-ScrollbarContainer"]],[[1,"scrollbar",["scrollbar"],"div",[[2,0,0,"class","Basis-Paginator-Scrollbar"],[2,0,0,"event-click","jumpTo"]],[[1,"activePageMarkWrapper",["activePageMarkWrapper"],"div",0,[[1,"activePageMark",["activePageMark"],"div",[[2,0,0,"class","Basis-Paginator-ActivePageMark"]],[[1,0,0,"div",0,0]]]]],[1,"scrollTrumbWrapper",["scrollTrumbWrapper"],"div",0,[[1,"scrollTrumb",["scrollTrumb"],"div",[[2,0,0,"class","Basis-Paginator-ScrollbarSlider"]],[[1,"scrollTrumbElement",["scrollTrumbElement"],"div",0,[[1,0,0,"span",0,0]]]]]]]]]]]]]]}||{};function coalesce(){var args=arguments;for(var i=0;i<args.length;i++)if(args[i]!=null)return args[i]}function extend(object,source){for(var key in source)object[key]=source[key];return object}function complete(object,source){for(var key in source)if(key in object==false)object[key]=source[key];return object}function keys(object){var result=new Array;for(var key in object)result.push(key);return result}function values(object){var result=new Array;for(var key in object)result.push(object[key]);return result}function slice(source,keys){var result={};if(!keys)return extend(result,source);for(var i=0,key;key=keys[i++];)if(key in source)result[key]=source[key];return result}function splice(source,keys){var result={};if(!keys)return extend(result,source);for(var i=0,key;key=keys[i++];)if(key in source){result[key]=source[key];delete source[key]}return result}function iterate(object,callback,thisObject){var result=new Array;for(var key in object)result.push(callback.call(thisObject,key,object[key]));return result}extend(Object,{extend:extend,complete:complete,keys:keys,values:values,slice:slice,splice:splice,iterate:iterate,coalesce:coalesce});function $undefined(value){return value==undefined}function $defined(value){return value!=undefined}function $isNull(value){return value==null||value==undefined}function $isNotNull(value){return value!=null&&value!=undefined}function $isSame(value){return value===this}function $isNotSame(value){return value!==this}function $self(value){return value}function $const(value){return function(){return value}}var $false=function(){return false};var $true=function(){return true};var $null=function(){return null};var $undef=function(){};var getter=function(){var modificatorSeed=1;var getterMap=[];var pathCache={};var modCache={};return function(path,modificator){var func;var result;var getterId;if(!path||path===nullGetter)return nullGetter;if(typeof path=="function"){getterId=path.basisGetterId_;if(getterId){func=getterMap[Math.abs(getterId)-1]}else{func=function(object){return path(object)};func.base=path;func.__extend__=getter;getterId=getterMap.push(func);path.basisGetterId_=-getterId;func.basisGetterId_=getterId}}else{func=pathCache[path];if(func){getterId=func.basisGetterId_}else{func=new Function("object","return object != null ? object."+path+" : object");func.base=path;func.__extend__=getter;getterId=getterMap.push(func);func.basisGetterId_=getterId;pathCache[path]=func}}var modType=modificator!=null&&typeof modificator;if(!modType)return func;var modList=modCache[getterId];var modId;if(modType=="string")modId=modType+modificator;else if(modType=="function")modId=modificator.basisModId_;else if(modType!="object"){return func}if(modId&&modList&&modList[modId])return modList[modId];if(typeof func.base=="function")func=func.base;switch(modType){case"string":result=function(object){return modificator.format(func(object))};break;case"function":if(!modId){modId=modType+modificatorSeed++;modificator.basisModId_=modId}result=function(object){return modificator(func(object))};break;case"object":result=function(object){return modificator[func(object)]};break}result.base=func.base||func;result.__extend__=getter;if(modId){if(!modList){modList={};modCache[getterId]=modList}modList[modId]=result;result.mod=modificator;result.basisGetterId_=getterMap.push(result)}else{}return result}}();var nullGetter=Function();nullGetter.__extend__=getter;function def(getter,defValue,checker){checker=checker||$isNull;var result=function(object){var res=getter(object);return checker(res)?defValue:res};return result}function wrapper(key){return function(value){var result={};result[key]=value;return result}}extend(Function,{$undefined:$undefined,$defined:$defined,$isNull:$isNull,$isNotNull:$isNotNull,$isSame:$isSame,$isNotSame:$isNotSame,$self:$self,$const:$const,$false:$false,$true:$true,$null:$null,$undef:$undef,getter:getter,nullGetter:nullGetter,def:def,wrapper:wrapper,lazyInit:function(init,thisObject){var inited=0,self,data;return self=function(){if(!(inited++)){self.inited=true;self.data=data=init.apply(thisObject||this,arguments)}return data}},lazyInitAndRun:function(init,run,thisObject){var inited=0,self,data;return self=function(){if(!(inited++)){self.inited=true;self.data=data=init.call(thisObject||this)}run.apply(data,arguments);return data}},runOnce:function(run,thisObject){var fired=0;return function(){if(!(fired++))return run.apply(thisObject||this,arguments)}},body:function(fn){return fn.toString().replace(/^\s*\(?\s*function[^(]*\([^\)]*\)[^{]*\{|\}\s*\)?\s*$/g,"")}});complete(Function.prototype,{bind:function(thisObject){var method=this;var params=Array.from(arguments,1);return params.length?function(){return method.apply(thisObject,params.concat.apply(params,arguments))}:function(){return method.apply(thisObject,arguments)}}});complete(Array,{isArray:function(value){return Object.prototype.toString.call(value)==="[object Array]"}});extend(Array,{from:function(object,offset){if(object!=null){var len=object.length;if(typeof len=="undefined")return[object];if(!offset)offset=0;if(len-offset>0){for(var result=[],k=0,i=offset;i<len;)result[k++]=object[i++];return result}}return[]},create:function(length,fillValue,thisObject){var result=new Array;var isFunc=typeof fillValue=="function";for(var i=0;i<length;i++)result[i]=isFunc?fillValue.call(thisObject,i,result):fillValue;return result}});complete(Array.prototype,{indexOf:function(searchElement,offset){offset=parseInt(offset)||0;if(offset<0)return-1;for(;offset<this.length;offset++)if(this[offset]===searchElement)return offset;return-1},lastIndexOf:function(searchElement,offset){var len=this.length;offset=parseInt(offset);if(isNaN(offset)||offset>=len)offset=len-1;else offset=(offset+len)%len;for(;offset>=0;offset--)if(this[offset]===searchElement)return offset;return-1},forEach:function(callback,thisObject){for(var i=0,len=this.length;i<len;i++)if(i in this)callback.call(thisObject,this[i],i,this)},every:function(callback,thisObject){for(var i=0,len=this.length;i<len;i++)if(i in this&&!callback.call(thisObject,this[i],i,this))return false;return true},some:function(callback,thisObject){for(var i=0,len=this.length;i<len;i++)if(i in this&&callback.call(thisObject,this[i],i,this))return true;return false},filter:function(callback,thisObject){var result=new Array;for(var i=0,len=this.length;i<len;i++)if(i in this&&callback.call(thisObject,this[i],i,this))result.push(this[i]);return result},map:function(callback,thisObject){var result=new Array;for(var i=0,len=this.length;i<len;i++)if(i in this)result[i]=callback.call(thisObject,this[i],i,this);return result},reduce:function(callback,initialValue){var len=this.length;var argsLen=arguments.length;if(len==0&&argsLen==1)throw new TypeError;var result;var inited=0;if(argsLen>1){result=initialValue;inited=1}for(var i=0;i<len;i++)if(i in this)if(inited++)result=callback.call(null,result,this[i],i,this);else result=this[i];return result}});extend(Array.prototype,{flatten:function(){return this.concat.apply([],this)},repeat:function(count){return Array.create(parseInt(count)||0,this).flatten()},item:function(index){index=parseInt(index||0);return this[index>=0?index:this.length+index]},search:function(value,getter,offset){Array.lastSearchIndex=-1;getter=Function.getter(getter||$self);for(var index=parseInt(offset)||0,len=this.length;index<len;index++)if(getter(this[index])===value)return this[Array.lastSearchIndex=index]},lastSearch:function(value,getter,offset){Array.lastSearchIndex=-1;getter=Function.getter(getter||$self);var len=this.length;var index=isNaN(offset)||offset==null?len:parseInt(offset);for(var i=index>len?len:index;i-->0;)if(getter(this[i])===value)return this[Array.lastSearchIndex=i]},binarySearchPos:function(value,getter,desc,strong,left,right){if(!this.length)return strong?-1:0;getter=Function.getter(getter||$self);desc=!!desc;var pos,compareValue;var l=isNaN(left)?0:left;var r=isNaN(right)?this.length-1:right;do{pos=l+r>>1;compareValue=getter(this[pos]);if(desc?value>compareValue:value<compareValue)r=pos-1;else if(desc?value<compareValue:value>compareValue)l=pos+1;else return value==compareValue?pos:strong?-1:0}while(l<=r);return strong?-1:pos+(compareValue<value^desc)},binarySearch:function(value,getter){return this.binarySearchPos(value,getter,false,true)},add:function(value){return this.indexOf(value)==-1&&!!this.push(value)},remove:function(value){var index=this.indexOf(value);return index!=-1&&!!this.splice(index,1)},has:function(value){return this.indexOf(value)!=-1},merge:function(object){return this.reduce(extend,object||{})},sortAsObject:function(getter,comparator,desc){getter=Function.getter(getter);desc=desc?-1:1;return this.map(function(item,index){return{i:index,v:getter(item)}}).sort(comparator||function(a,b){return desc*(a.v>b.v||-(a.v<b.v)||(a.i>b.i?1:-1))}).map(function(item){return this[item.i]},this)},set:function(array){if(this!==array){this.length=0;this.push.apply(this,array)}return this},clear:function(){this.length=0;return this}});if(![1,2].splice(1).length){var _native_Array_splice=Array.prototype.splice;Array.prototype.splice=function(){var params=Array.from(arguments);if(params.length<2)params[1]=this.length;return _native_Array_splice.apply(this,params)}}var STRING_QUOTE_PAIRS={"<":">","[":"]","(":")","{":"}","«":"»"};var ESCAPE_FOR_REGEXP=/([\/\\\(\)\[\]\?\{\}\|\*\+\-\.\^\$])/g;var FORMAT_REGEXP=/\{([a-z\d\_]+)(?::([\.0])(\d+)|:(\?))?\}/gi;var QUOTE_REGEXP_CACHE={};String.Entity={laquo:"«",raquo:"»",nbsp:" ",quot:'"',quote:'"',copy:"©",shy:"­",para:"¶",sect:"§",deg:"°",mdash:"—",hellip:"…"};complete(String,{toLowerCase:function(value){return String(value).toLowerCase()},toUpperCase:function(value){return String(value).toUpperCase()},trim:function(value){return String(value).trim()},trimLeft:function(value){return String(value).trimLeft()},trimRight:function(value){return String(value).trimRight()},isEmpty:function(value){return value==null||String(value)==""},isNotEmpty:function(value){return value!=null&&String(value)!=""}});complete(String.prototype,{trimLeft:function(){return this.replace(/^\s+/,"")},trimRight:function(){return this.replace(/\s+$/,"")},trim:function(){return this.trimLeft().trimRight()}});extend(String.prototype,{toObject:function(rethrow){try{return Function("return 0,"+this)()}catch(e){if(rethrow)throw e}},toArray:(new String("a"))[0]?function(){return Array.from(this)}:function(){var result=new Array;var len=this.length;for(var i=0;i<len;i++)result[i]=this.charAt(i);return result},repeat:function(count){return(new Array(parseInt(count)+1||0)).join(this)},qw:function(){var trimed=this.trim();return trimed?trimed.split(/\s+/):[]},forRegExp:function(){return this.replace(ESCAPE_FOR_REGEXP,"\\$1")},format:function(first){var data={};for(var i=0;i<arguments.length;i++)data[i]=arguments[i];if(typeof first=="object")extend(data,first);return this.replace(FORMAT_REGEXP,function(m,key,numFormat,num,noNull){var value=key in data?data[key]:noNull?"":m;if(numFormat&&!isNaN(value)){value=Number(value);return numFormat=="."?value.toFixed(num):value.lead(num)}return value})},quote:function(quoteS,quoteE){quoteS=quoteS||'"';quoteE=quoteE||STRING_QUOTE_PAIRS[quoteS]||quoteS;var rx=(quoteS.length==1?quoteS:"")+(quoteE.length==1?quoteE:"");return quoteS+(rx?this.replace(QUOTE_REGEXP_CACHE[rx]||(QUOTE_REGEXP_CACHE[rx]=new RegExp("["+rx.forRegExp()+"]","g"),"\\$&")):this)+quoteE},capitalize:function(){return this.charAt(0).toUpperCase()+this.substr(1).toLowerCase()},camelize:function(){return this.replace(/-(.)/g,function(m,chr){return chr.toUpperCase()})},dasherize:function(){return this.replace(/[A-Z]/g,function(m){return"-"+m.toLowerCase()})}});String.format=String.prototype.format;if("|||".split(/\|/).length+"|||".split(/(\|)/).length!=11){String.prototype.split=function(pattern,count){if(pattern==""||pattern&&pattern.source=="")return this.toArray();var result=new Array;var pos=0;var match;if(pattern instanceof RegExp){if(!pattern.global)pattern=new RegExp(pattern.source,/\/([mi]*)$/.exec(pattern)[1]+"g");while(match=pattern.exec(this)){match[0]=this.substring(pos,match.index);result.push.apply(result,match);pos=pattern.lastIndex}}else{while((match=this.indexOf(pattern,pos))!=-1){result.push(this.substring(pos,match));pos=match+pattern.length}}result.push(this.substr(pos));return result}}if("12".substr(-1)!="2"){var _native_String_substr=String.prototype.substr;String.prototype.substr=function(start,end){return _native_String_substr.call(this,start<0?Math.max(0,this.length+start):start,end)}}extend(Number.prototype,{fit:function(min,max){if(!isNaN(min)&&this<min)return Number(min);if(!isNaN(max)&&this>max)return Number(max);return this},between:function(min,max){return!isNaN(this)&&this>=min&&this<=max},quote:function(start,end){return(this+"").quote(start,end)},toHex:function(){return parseInt(this).toString(16).toUpperCase()},sign:function(){return this<0?-1:+(this>0)},base:function(div){return!div||isNaN(div)?0:Math.floor(this/div)*div},lead:function(len,leadChar){return(this+"").replace(/\d+/,function(number){return(len-=number.length-1)>1?Array(len).join(leadChar||0)+number:number})},group:function(len,splitter){return(this+"").replace(/\d+/,function(number){return number.replace(/\d/g,function(m,pos){return!pos+(number.length-pos)%(len||3)?m:(splitter||" ")+m})})},format:function(prec,gs,prefix,postfix,comma){var res=this.toFixed(prec);if(gs||comma)res=res.replace(/(\d+)(\.?)/,function(m,number,c){return(gs?Number(number).group(3,gs):number)+(c?comma||c:"")});if(prefix)res=res.replace(/^-?/,"$&"+(prefix||""));return res+(postfix||"")}});complete(Date,{now:function(){return+(new Date)}});if((new Date).getYear()<1900){extend(Date.prototype,{getYear:function(){return this.getFullYear()-1900},setYear:function(year){return this.setFullYear(!isNaN(year)&&year<100?Number(year)+1900:year)}})}var namespace="basis";var NODE_ENV=typeof module!="undefined"&&typeof require=="function"&&typeof exports!="undefined"&&exports===this;var pathUtils=function(){var utils;if(NODE_ENV){utils=Object.slice(require("path"),["normalize","dirname","extname","basename","resolve","relative","existsSync"])}else{var linkEl=document.createElement("A");utils={normalize:function(path){linkEl.href=path||"";return linkEl.href.substring(0,linkEl.href.length-linkEl.hash.length-linkEl.search.length)},dirname:function(path){return this.normalize(path).replace(/\/[^\/]*$/,"")},extname:function(path){var ext=String(path).match(/\.[a-z0-9\_\-]+$/);return ext?ext[0]:""},basename:function(path,ext){var filename=String(path).match(/[^\\\/]*$/);filename=filename?filename[0]:"";if(ext==this.extname(filename))filename=filename.substring(0,filename.length-ext.length);return filename},resolve:function(path){return this.normalize(path)},relative:function(path){var abs=this.normalize(path).split(/\//);var loc=this.baseURI.split(/\//);var i=0;while(abs[i]==loc[i]&&typeof loc[i]=="string")i++;return"../".repeat(loc.length-i)+abs.slice(i).join("/")}}}utils.baseURI=utils.dirname(utils.resolve());return utils}();var namespaces={};var namespaceWrappers={};var nullNamespaceWrapper=Function();function getNamespace(namespace,wrapFunction){var path=namespace.split(".");var cursor=global;var name;var stepPath;var nsRoot;while(path.length){name=path.shift();stepPath=(stepPath?stepPath+".":"")+name;if(!cursor[name]){cursor[name]=function(namespace,wrapFn){var wrapFunction=typeof wrapFn=="function"?wrapFn:null;var newNamespace=function(){if(wrapFunction)return wrapFunction.apply(this,arguments)};return extend(newNamespace,{path:namespace,exports:{},toString:function(){return"[basis.namespace "+namespace+"]"},extend:function(newNames){complete(this,newNames);extend(this.exports,newNames)},setWrapper:function(wrapFn){if(typeof wrapFn=="function"){wrapFunction=wrapFn}}})}(stepPath,!path.length?wrapFunction:null);if(nsRoot)nsRoot.namespaces_[stepPath]=cursor[name]}cursor=cursor[name];if(!nsRoot){nsRoot=cursor;if(!nsRoot.namespaces_)nsRoot.namespaces_={}}}return namespaces[namespace]=cursor}var requireNamespace=function(){var lastScriptEl=Array.from(global.document?global.document.getElementsByTagName("SCRIPT"):null).filter(function(scriptEl){return scriptEl.getAttributeNode("basis-config")}).pop();var basisRequirePath=pathUtils.dirname(lastScriptEl?lastScriptEl.src:typeof module!="undefined"?module.filename:"")+"/";var nsRootPath={basis:basisRequirePath};var requested={};var requireFunc;if(typeof require=="function"){var requirePath=pathUtils.dirname(module.filename)+"/";requireFunc=function(namespace){return function(){var temp=module.constructor.prototype.load;module.constructor.prototype.load=function(fn){this.exports=getNamespace(namespace);temp.apply(this,arguments)};var exports=require(requirePath+namespace.replace(/\./g,"/"));complete(getNamespace(namespace),exports);module.constructor.prototype.load=temp;return exports}()}}else{requireFunc=function(namespace,path){if(/[^a-z0-9\_\.]/i.test(namespace))throw"Namespace `"+namespace+"` contains wrong chars.";var filename=namespace.replace(/\./g,"/")+".js";var namespaceRoot=namespace.split(".")[0];if(namespaceRoot==namespace)nsRootPath[namespaceRoot]=path||pathUtils.baseURI+"/";var requirePath=nsRootPath[namespaceRoot];if(!namespaces[namespace]){if(!/^(https?|chrome-extension):/.test(requirePath))throw"Path `"+namespace+"` ("+requirePath+") can't be resolved";if(!requested[namespace])requested[namespace]=true;else throw"Recursive require for "+namespace;var requestUrl=requirePath+filename;var ns=basis.namespace(namespace);var scriptText=externalResource(requestUrl);runScriptInContext(ns,requestUrl,scriptText,"/** @namespace "+namespace+" */\n");complete(ns,ns.exports);requireFunc.sequence.push(filename)}};requireFunc.sequence=[]}return requireFunc}();(function(){var tmp=externalResourceCache;externalResourceCache={};for(var key in tmp)externalResourceCache[pathUtils.resolve(key)]=tmp[key]})();var externalResource=function(url){var requestUrl=url;if(!externalResourceCache.hasOwnProperty(requestUrl)){var resourceContent="";if(!NODE_ENV){var req=new XMLHttpRequest;req.open("GET",requestUrl,false);req.setRequestHeader("If-Modified-Since",(new Date(0)).toGMTString());req.send("");if(req.status>=200&&req.status<400)resourceContent=req.responseText;else{if(typeof console!="undefined")console.warn("basis.resource: Unable to load "+requestUrl)}}else{if(pathUtils.existsSync(requestUrl))resourceContent=require("fs").readFileSync(requestUrl,"utf-8");else console.warn("basis.resource: Unable to load "+requestUrl)}externalResourceCache[requestUrl]=resourceContent}return externalResourceCache[requestUrl]};var frfCache={};var fetchResourceFunction=function(resourceUrl){if(typeof resourceUrl!="number")resourceUrl=pathUtils.resolve(resourceUrl);if(!frfCache[resourceUrl]){var ext=pathUtils.extname(resourceUrl);var extWrapper;var extWrapperFn;if(ext){extWrapper=fetchResourceFunction.extensions[ext];extWrapperFn=function(content){return extWrapper(content,resourceUrl)}}var attaches=[];var resourceObject;var wrapped=false;var resource=extWrapper?function(){if(!wrapped){wrapped=true;resource.source=externalResource(resourceUrl);resourceObject=extWrapperFn(resource.source)}return resourceObject}:function(){return externalResource(resourceUrl)};resource.url=resourceUrl;resource.fetch=resource;resource.toString=function(){return"[basis.resource "+resourceUrl+"]"};resource.update=function(content){content=String(content);if(content!=externalResourceCache[resourceUrl]){externalResourceCache[resourceUrl]=content;if(extWrapper){if(extWrapper.updatable){resource.source=content;resourceObject=extWrapperFn(content);content=resourceObject}else return}for(var i=0,listener;listener=attaches[i];i++)listener.handler.call(listener.context,content)}};resource.reload=function(){var content=externalResourceCache[resourceUrl];delete externalResourceCache[resourceUrl];var newContent=externalResource(resourceUrl);if(newContent!=content){delete externalResourceCache[resourceUrl];this.update(newContent)}};resource.bindingBridge={attach:function(fn,handler,context){for(var i=0,listener;listener=attaches[i];i++){if(listener.handler==handler&&listener.context==context)return false}attaches.push({handler:handler,context:context});return true},detach:function(fn,handler,context){for(var i=0,listener;listener=attaches[i];i++)if(listener.handler==handler&&listener.context==context){attaches.splice(i,1);return true}return false},get:function(fn){return externalResource(resourceUrl)}};frfCache[resourceUrl]=resource}return frfCache[resourceUrl]};fetchResourceFunction.getSource=function(resourceUrl){return externalResource(pathUtils.resolve(resourceUrl))};fetchResourceFunction.exists=function(resourceUrl){return!!frfCache.hasOwnProperty(pathUtils.resolve(resourceUrl))};fetchResourceFunction.extensions={".js":function(resource,url){return runScriptInContext({exports:{}},url,resource).exports},".json":function(resource,url){if(typeof resource=="object")return resource;var result;try{result=JSON.parse(String(resource))}catch(e){if(typeof console!="undefined")console.warn("basis.resource: Can't parse JSON from "+url,{url:url,source:String(resource)})}return result||false}};fetchResourceFunction.extensions[".json"].updatable=true;var runScriptInContext=function(context,sourceURL,sourceCode,prefix){var baseURL=pathUtils.dirname(sourceURL)+"/";var compiledSourceCode;if(!context.exports)context.exports={};try{compiledSourceCode=typeof sourceCode=="function"?sourceCode:Function("exports, module, basis, global, __filename, __dirname, resource",(prefix||"")+'"use strict";\n\n'+sourceCode+"//@ sourceURL="+sourceURL)}catch(e){var src=document.createElement("script");src.src=sourceURL;src.async=false;document.head.appendChild(src);document.head.removeChild(src);throw"Compilation error "+sourceURL+":\n"+("stack"in e?e.stack:e)}compiledSourceCode.call(context,context.exports,context,basis,global,sourceURL,baseURL,function(relativePath){return fetchResourceFunction(baseURL+relativePath)});return context};var Class=function(){var namespace="basis.Class";var BaseClass=Function();var seed={id:1};var classSeed=1;var NULL_FUNCTION=Function();var SELF={};function isClass(object){return typeof object=="function"&&!!object.basisClassId_}function isSubclassOf(superClass){var cursor=this;while(cursor&&cursor!==superClass)cursor=cursor.superClass_;return cursor===superClass}var TOSTRING_BUG=function(){for(var key in{toString:1})return;return true}();extend(BaseClass,{className:namespace,extendConstructor_:false,prototype:{constructor:null,init:NULL_FUNCTION,postInit:NULL_FUNCTION,toString:function(){return"[object "+(this.constructor||this).className+"]"},destroy:function(){for(var prop in this)this[prop]=null;this.destroy=$undef}},create:function(SuperClass){if(typeof SuperClass!="function")SuperClass=BaseClass;var SuperClass_=Function();SuperClass_.prototype=SuperClass.prototype;var newProto=new SuperClass_;var classId=classSeed++;var genericClassName=SuperClass.className+"._Class"+classId;var newClassProps={className:genericClassName,basisClassId_:classId,superClass_:SuperClass,extendConstructor_:!!SuperClass.extendConstructor_,isSubclassOf:isSubclassOf,subclass:function(){return BaseClass.create.apply(null,[newClass].concat(Array.from(arguments)))},extend:BaseClass.extend,__extend__:function(value){if(value&&value!==SELF&&(typeof value=="object"||typeof value=="function"&&!isClass(value)))return BaseClass.create.call(null,newClass,value);else return value},prototype:newProto};for(var i=1,extension;extension=arguments[i];i++){newClassProps.extend(typeof extension=="function"&&!isClass(extension)?extension(SuperClass.prototype):extension)}var className=newClassProps.className;var newClass=newClassProps.extendConstructor_?function(extend,config){this.eventObjectId=seed.id++;var prop;for(var key in extend){prop=this[key];this[key]=prop&&prop.__extend__?prop.__extend__(extend[key]):extend[key]}this.init();this.postInit()}:function(){this.eventObjectId=seed.id++;this.init.apply(this,arguments);this.postInit()};newProto.constructor=newClass;for(var key in newProto)if(newProto[key]===SELF)newProto[key]=newClass;extend(newClass,newClassProps);return newClass},extend:function(source){var proto=this.prototype;if(source.prototype)source=source.prototype;for(var key in source){var value=source[key];var protoValue=proto[key];if(key=="className"||key=="extendConstructor_")this[key]=value;else{if(protoValue&&protoValue.__extend__)proto[key]=protoValue.__extend__(value);else{proto[key]=value}}}if(TOSTRING_BUG&&source[key="toString"]!==Object.prototype[key])proto[key]=source[key];return this}});var customExtendProperty=function(extension,func){return{__extend__:function(extension){if(!extension)return extension;if(extension&&extension.__extend__)return extension;var Base=Function();Base.prototype=this;var result=new Base;func(result,extension);return result}}.__extend__(extension||{})};var extensibleProperty=function(extension){return customExtendProperty(extension,extend)};var nestedExtendProperty=function(extension){return customExtendProperty(extension,function(result,extension){for(var key in extension){var value=result[key];result[key]=value&&value.__extend__?value.__extend__(extension[key]):extensibleProperty(extension[key])}})};var oneFunctionProperty=function(fn,keys){var create=function(keys){var result;if(keys){if(keys.__extend__)return keys;result={__extend__:create};for(var key in keys)if(keys[key])result[key]=fn}return result};return create(keys||{})};return getNamespace(namespace,BaseClass.create).extend({SELF:SELF,BaseClass:BaseClass,create:BaseClass.create,isClass:isClass,customExtendProperty:customExtendProperty,extensibleProperty:extensibleProperty,nestedExtendProperty:nestedExtendProperty,oneFunctionProperty:oneFunctionProperty})}();var onLoad=function(){var fired=false;var loadHandler=[];function fireHandlers(e){if(typeof document!="undefined"&&document.readyState=="complete"){if(!(fired++))for(var i=0;i<loadHandler.length;i++)loadHandler[i].callback.call(loadHandler[i].thisObject)}}function doScrollCheck(){try{document.documentElement.doScroll("left");fireHandlers()}catch(e){setTimeout(doScrollCheck,1)}}if(typeof document!="undefined"&&document.readyState!="complete"){if(document.addEventListener){document.addEventListener("DOMContentLoaded",fireHandlers,false);window.addEventListener("load",fireHandlers,false)}else{document.attachEvent("onreadystatechange",fireHandlers);window.attachEvent("onload",fireHandlers);try{if(window.frameElement==null&&document.documentElement.doScroll)doScrollCheck()}catch(e){}}}return function(callback,thisObject){if(!fired){loadHandler.push({callback:callback,thisObject:thisObject})}else callback.call(thisObject)}}();var Cleaner=function(){var objects=new Array;function destroy(log){result.globalDestroy=true;result.add=$undef;result.remove=$undef;var object;while(object=objects.pop()){if(typeof object.destroy=="function"){try{object.destroy()}catch(e){}}else{for(var prop in object)delete object[prop]}}objects.clear()}if("attachEvent"in global)global.attachEvent("onunload",destroy);else if("addEventListener"in global)global.addEventListener("unload",destroy,false);else return{add:Function(),remove:Function()};var result={add:function(object){if(object!=null)objects.push(object)},remove:function(object){objects.remove(object)}};return result}();var basis=getNamespace(namespace);basis.extend({namespace:getNamespace,require:requireNamespace,resource:fetchResourceFunction,ready:onLoad,platformFeature:{},Cleaner:Cleaner});basis.path=pathUtils}).call(this,this);[
// ../../../src/basis/date.js
["basis.date", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var getter=Function.getter;var MONTH_DAY_COUNT=[31,28,31,30,31,30,31,31,30,31,30,31];var monthNumToAbbr=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];var dayNumToAbbr=["mon","tue","wed","thr","fri","sat","sun"];var DIFF_BASE={day:24*3600*1e3,hour:3600*1e3,minute:60*1e3,second:1e3};var PART_ERROR="Unknown date part: ";var DATE_PART="year month day hour minute second millisecond".qw();var GETTER={};var SETTER={};Object.iterate({year:"FullYear",month:"Month",day:"Date",hour:"Hours",minute:"Minutes",second:"Seconds",millisecond:"Milliseconds"},function(key,value){GETTER[key]=getter("get"+value+"()");SETTER[key]=new Function("d,v","d.set"+value+"(v)")});var FORMAT={y:getter("getFullYear().toString().substr(2)"),Y:getter("getFullYear()"),d:getter("getDate()"),D:getter("getDate()","{0:02}"),m:getter("getMonth() + 1"),M:getter("getMonth() + 1","{0:02}"),h:getter("getHours()"),H:getter("getHours()","{0:02}"),i:getter("getHours() % 12 || 12","{0:02}"),p:getter("getHours() > 12",{"true":"pm","false":"am"}),P:getter("getHours() > 12",{"true":"PM","false":"AM"}),I:getter("getMinutes()","{0:02}"),s:getter("getSeconds()"),S:getter("getSeconds()","{0:02}"),z:getter("getMilliseconds()"),Z:getter("getMilliseconds()","{0:03}")};var reISOFormat=/^(\d{1,4})-(\d\d?)-(\d\d?)(?:[T ](\d\d?):(\d\d?):(\d\d?)(?:\.(\d{1,3}))?)?$/;var reFormat=/%([ymdhiszp])/ig;function isLeapYear(year){return!!(!(year%400)||year%100&&!(year%4))}function getMonthDayCount(month,year){return month==1?28+isLeapYear(year):MONTH_DAY_COUNT[month]}function dateFormat(date,format){return format.replace(reFormat,function(m,part){return FORMAT[part](date)})}Object.extend(Date.prototype,{isLeapYear:function(){return isLeapYear(this.getFullYear())},getMonthDayCount:function(){return getMonthDayCount(this.getMonth(),this.getFullYear())},add:function(part,value){var getter=GETTER[part];if(!getter)throw new Error(PART_ERROR+part);var day;if(part=="year"||part=="month"){day=this.getDate();if(day>28)this.setDate(1)}SETTER[part](this,getter(this)+value);if(day>28){var monthDayCount=this.getMonthDayCount();if(day>monthDayCount)this.setDate(monthDayCount)}return this},diff:function(part,date){if(part=="year"||part=="month"){var dir=Number(this)-Number(date)>0?-1:1;var left=dir>0?this:date;var right=dir>0?date:this;var ly=left.getFullYear();var ry=right.getFullYear();var ydiff=ry-ly;if(part=="year")return dir*ydiff;var lm=left.getMonth();var rm=right.getMonth();var mdiff=ydiff?(ydiff>1?(ydiff-1)*12:0)+(12-1-lm)+(rm+1):rm-lm;return dir*mdiff}else{var diff=Math.floor((date-this)/DIFF_BASE[part]);return diff+Number(GETTER[part](new Date(date-diff*DIFF_BASE[part]))-GETTER[part](this)!=0)}},set:function(part,value){var setter=SETTER[part];if(!setter)throw new Error(PART_ERROR+part);var day;if(part=="year"||part=="month"){day=this.getDate();if(day>28)this.setDate(1)}setter(this,value);if(day>28){var monthDayCount=this.getMonthDayCount();if(day>monthDayCount)this.setDate(monthDayCount)}return this},get:function(part){if(GETTER[part])return GETTER[part](this);throw new Error(PART_ERROR+part)},toISODateString:function(){return dateFormat(this,"%Y-%M-%D")},toISOTimeString:function(){return dateFormat(this,"%H:%I:%S.%Z")},fromDate:function(date){if(date instanceof Date){this.setFullYear(date.getFullYear(),date.getMonth(),date.getDate());this.setTime(date.getTime())}return this},toFormat:function(format){return dateFormat(this,format)}});var _native_toISOString=Date.prototype.toISOString;if(_native_toISOString&&(new Date).toISOString().match(/Z/i)){Date.prototype.toISOString=function(){return _native_toISOString.call(this).replace(/Z/i,"")}}Object.complete(Date.prototype,{toISOString:function(){return this.toISODateString()+"T"+this.toISOTimeString()},fromISOString:function(datetime){var m=String(datetime).match(reISOFormat);if(!m)throw new Error("Value of date isn't in ISO format: "+datetime);m[2]-=1;for(var i=0,part;part=DATE_PART[i];i++)this.set(part,m[i+1]||0);return this}});Object.extend(Date.prototype,{toODBCDate:Date.prototype.toISODateString,toODBCTime:Date.prototype.toISOTimeString,toODBC:Date.prototype.toISOString,fromODBC:Date.prototype.fromISOString});var reIsoStringSplit=/\D/;function fastDateParse(y,m,d,h,i,s,ms){return new Date(y,m-1,d,h||0,i||0,s||0,ms||0)}Date.fromISOString=function(isoString){return isoString?fastDateParse.apply(null,String(isoString).split(reIsoStringSplit)):null};Date.timer=function(date){var timer=date||new Date;timer.measure=function(seconds){return seconds?((new Date-timer)/1e3).toFixed(3):new Date-timer};return timer};module.exports={monthNumToAbbr:monthNumToAbbr,dayNumToAbbr:dayNumToAbbr,isLeapYear:isLeapYear,getMonthDayCount:getMonthDayCount,format:dateFormat}}],
// ../../../src/basis/ua.js
["basis.ua", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var answers={};var versions={};var userAgent=global.navigator&&global.navigator.userAgent||"";var browserName="unknown";var browserPrettyName="unknown";var browserNames={MSIE:["Internet Explorer","msie","ie"],Gecko:["Gecko","gecko"],Safari:["Safari","safari"],"iPhone OS":["iPhone","iphone"],AdobeAir:["AdobeAir","air"],AppleWebKit:["WebKit"],Chrome:["Chrome","chrome"],FireFox:["FireFox","firefox","ff"],Iceweasel:["FireFox","firefox","ff"],Shiretoko:["FireFox","firefox","ff"],Opera:["Opera","opera"]};for(var name in browserNames){if(name=="MSIE"&&global.opera)continue;if(name=="Safari"&&userAgent.match(/chrome/i))continue;if(name=="AppleWebKit"&&userAgent.match(/iphone/i))continue;if(userAgent.match(new RegExp(name+"."+"(\\d+(\\.\\d+)*)","i"))){var names=browserNames[name];var version=global.opera&&typeof global.opera.version=="function"?global.opera.version():RegExp.$1;var verNumber=versionToInt(version);browserName=names[0]+verNumber;browserPrettyName=names[0]+" "+version;for(var j=0;j<names.length;j++)versions[names[j].toLowerCase()]=verNumber}}basis.platformFeature.datauri=false;if(typeof Image!="undefined")(function(){var testImage=new Image;testImage.onload=function(){basis.platformFeature.datauri=true};testImage.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=="})();function versionToInt(version){var base=1e6;var part=String(version).split(".");for(var i=0,result=0;i<4&&i<part.length;i++,base/=100)result+=part[i]*base;return result}function testBrowser(){for(var i=0;i<arguments.length;i++){var forTest=arguments[i].toLowerCase();if(forTest in answers){if(answers[forTest])return true}else{var m=forTest.match(/^([a-z]+)(([\d\.]+)([+-=]?))?$/i);if(m){answers[forTest]=false;var name=m[1].toLowerCase();var version=versionToInt(m[3]);var operation=m[4]||"=";var cmpVersion=versions[name];if(!cmpVersion)continue;return answers[forTest]=!version||operation=="="&&cmpVersion==version||operation=="+"&&cmpVersion>=version||operation=="-"&&cmpVersion<version}else{}}}return false}var cookies={set:function(name,value,expire,path){document.cookie=name+"="+(value==null?"":escape(value))+";path="+(path||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)+(expire?";expires="+(new Date(Date.now()+expire*1e3)).toGMTString():"")},get:function(name){var m=document.cookie.match(new RegExp("(^|;)\\s*"+name+"\\s*=\\s*(.*?)\\s*(;|$)"));return m&&unescape(m[2])},remove:function(name,path){document.cookie=name+"=;expires="+(new Date(0)).toGMTString()+";path="+(path||(location.pathname.indexOf("/")==0?"":"/")+location.pathname)}};if(testBrowser("IE7-"))try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}module.exports={prettyName:browserPrettyName,test:testBrowser,is:function(name){return testBrowser(name)},cookies:cookies}}],
// ../../../src/basis/dom.js
["basis.dom", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var coalesce=Object.coalesce;var document=global.document;var Class=basis.Class;var getter=Function.getter;var testElement=document.createElement("div");var ELEMENT_NODE=1;var ATTRIBUTE_NODE=2;var TEXT_NODE=3;var CDATA_SECTION_NODE=4;var ENTITY_REFERENCE_NODE=5;var ENTITY_NODE=6;var PROCESSING_INSTRUCTION_NODE=7;var COMMENT_NODE=8;var DOCUMENT_NODE=9;var DOCUMENT_TYPE_NODE=10;var DOCUMENT_FRAGMENT_NODE=11;var NOTATION_NODE=12;var AXIS_ANCESTOR=1;var AXIS_ANCESTOR_OR_SELF=2;var AXIS_DESCENDANT=4;var AXIS_DESCENDANT_OR_SELF=8;var AXIS_SELF=16;var AXIS_PARENT=32;var AXIS_CHILD=64;var AXIS_FOLLOWING=128;var AXIS_FOLLOWING_SIBLING=256;var AXIS_PRESCENDING=512;var AXIS_PRESCENDING_SIBLING=1024;var POSITION_DISCONNECTED=1;var POSITION_PRECENDING=2;var POSITION_FOLLOWING=4;var POSITION_CONTAINS=8;var POSITION_CONTAINED_BY=16;var POSITION_IMPLEMENTATION_SPECIFIC=32;var PARENT_NODE="parentNode";var FIRST_CHILD="firstChild";var LAST_CHILD="lastChild";var NEXT_SIBLING="nextSibling";var PREVIOUS_SIBLING="previousSibling";var INSERT_BEGIN="begin";var INSERT_END="end";var INSERT_BEFORE="before";var INSERT_AFTER="after";var comparePosition;if(typeof testElement.compareDocumentPosition=="function"){comparePosition=function(nodeA,nodeB){return nodeA.compareDocumentPosition(nodeB)}}else{comparePosition=function(nodeA,nodeB){if(nodeA==nodeB)return 0;if(nodeA.document!=nodeB.document)return POSITION_DISCONNECTED|POSITION_IMPLEMENTATION_SPECIFIC;if(nodeA.sourceIndex>nodeB.sourceIndex)return POSITION_PRECENDING|POSITION_CONTAINS*nodeB.contains(childA);else return POSITION_FOLLOWING|POSITION_CONTAINED_BY*nodeA.contains(childB)}}var isNode;if(typeof Node!="undefined"){isNode=function(node){return node instanceof Node};if(!Node.prototype.contains){Node.prototype.contains=function(node){return!!(this.compareDocumentPosition(node)&POSITION_CONTAINED_BY)}}}else{isNode=function(node){return node&&node.ownerDocument===document}}function handleInsert(node,newNode,refChild){if(newNode!=null)return node.insertBefore(isNode(newNode)?newNode:createText(newNode),refChild||null)}var TreeWalker=Class(null,{className:namespace+".TreeWalker",root_:null,cursor_:null,filter:Function.$true,init:function(root,filter,direction){this.setRoot(root);this.setDirection(direction);if(typeof filter=="function")this.filter=filter},setDirection:function(direction){Object.extend(this,direction?{a:LAST_CHILD,b:PREVIOUS_SIBLING,c:NEXT_SIBLING,d:FIRST_CHILD}:{a:FIRST_CHILD,b:NEXT_SIBLING,c:PREVIOUS_SIBLING,d:LAST_CHILD})},setRoot:function(node){this.root_=node||document;this.reset()},reset:function(){this.cursor_=null},first:function(filter){this.reset();return this.next(filter)},last:function(filter){this.reset();return this.prev(filter)},nodes:function(filter,result){var node;if(!result)result=new Array;this.reset();while(node=this.next(filter))result.push(node);return result},next:function(filter){filter=filter||this.filter;var cursor=this.cursor_||this.root_;do{var node=cursor[this.a];while(!node){if(cursor===this.root_)return this.cursor_=null;node=cursor[this.b];if(!node)cursor=cursor[PARENT_NODE]}}while(!filter(cursor=node));return this.cursor_=cursor},prev:function(filter){filter=filter||this.filter;var cursor=this.cursor_;var prevSibling=this.c;var prevChild=this.d;do{var node=cursor?cursor[prevSibling]:this.root_[prevChild];if(node){while(node[prevChild])node=node[prevChild];cursor=node}else if(cursor)cursor=cursor[PARENT_NODE];if(!cursor||cursor===this.root_){cursor=null;break}}while(!filter(cursor));return this.cursor_=cursor},destroy:function(){this.root_=null;this.cursor_=null}});TreeWalker.BACKWARD=true;function outerHTML(node,noClone){return node.outerHTML||createElement("",noClone?node:node.cloneNode(true)).innerHTML}var TEXT_PROPERTIES="textContent innerText nodeValue".qw();function textContent(node){for(var i=0,property;property=TEXT_PROPERTIES[i++];)if(node[property]!=null)return node[property];return axis(node,AXIS_DESCENDANT,function(node){return node.nodeType==TEXT_NODE}).map(getter("nodeValue")).join("")}function get(id){if(isNode(id)||id&&id.nodeType)return id;else return typeof id=="string"?document.getElementById(id):null}function tag(node,tagName){node=get(node)||document;if(tagName=="*"&&node.all)return Array.from(node.all);else return Array.from(node.getElementsByTagName(tagName||"*"))}function axis(root,axis,filter){var walker,cursor;var result=new Array;filter=typeof filter=="string"?getter(filter):filter||Function.$true;if(axis&(AXIS_SELF|AXIS_ANCESTOR_OR_SELF|AXIS_DESCENDANT_OR_SELF))if(filter(root))result.push(root);switch(axis){case AXIS_ANCESTOR:case AXIS_ANCESTOR_OR_SELF:cursor=root;while((cursor=cursor[PARENT_NODE])&&cursor!==root.document)if(filter(cursor))result.push(cursor);break;case AXIS_CHILD:cursor=root[FIRST_CHILD];while(cursor){if(filter(cursor))result.push(cursor);cursor=cursor[NEXT_SIBLING]}break;case AXIS_DESCENDANT:case AXIS_DESCENDANT_OR_SELF:if(root[FIRST_CHILD]){walker=new TreeWalker(root);walker.nodes(filter,result)}break;case AXIS_FOLLOWING:walker=new TreeWalker(root,filter);walker.cursor_=root[NEXT_SIBLING]||root[PARENT_NODE];while(cursor=walker.next())result.push(cursor);break;case AXIS_FOLLOWING_SIBLING:cursor=root;while(cursor=cursor[NEXT_SIBLING])if(filter(cursor))result.push(cursor);break;case AXIS_PARENT:if(filter(root[PARENT_NODE]))result.push(root[PARENT_NODE]);break;case AXIS_PRESCENDING:walker=new TreeWalker(root,filter,TreeWalker.BACKWARD);walker.cursor_=root[PREVIOUS_SIBLING]||root[PARENT_NODE];while(cursor=walker.next())result.push(cursor);break;case AXIS_PRESCENDING_SIBLING:cursor=root;while(cursor=cursor[PREVIOUS_SIBLING])if(filter(cursor))result.push(cursor);break}return result}function findAncestor(node,matchFunction,bound){while(node&&node!==bound){if(matchFunction(node))return node;node=node.parentNode}}function createText(text){return document.createTextNode(text!=null?text:"")}function createFragment(){var result=document.createDocumentFragment();var len=arguments.length;var array=createFragment.array=new Array;for(var i=0;i<len;i++)array.push(handleInsert(result,arguments[i]));return result}var IS_ATTRIBUTE_BUG_NAME=function(){var input=document.createElement("input");input.name="a";return!/name/.test(outerHTML(input))}();var IS_ATTRIBUTE_BUG_STYLE=function(){testElement.setAttribute("style","color: red");return testElement.style.color!=="red"}();var DESCRIPTION_PART_REGEXP=/#([a-z0-9\_\-\:]+)|\.([a-z0-9\_\-\:]+)|\[([a-z0-9\_\-:]+)(="((?:\\.|[^"])*)"|='((?:\\.|[^'])*)'|=((?:\\.|[^\]])*))?\s*\]|\s*(\S)/gi;function createElement(config,childs){var isConfig=config!=undefined&&typeof config!="string";var description=(isConfig?config.description:config)||"";var elementName="div";var element;var m=description.match(/^([a-z0-9\_\-]+)(.*)$/i);if(m){elementName=m[1];description=m[2]}if(description!=""){var classNames=new Array;var attributes={};var entryName;while(m=DESCRIPTION_PART_REGEXP.exec(description)){if(m[8]){throw new Error("Create element error in basis.dom.createElement()"+"\n\nDescription:\n> "+description+"\n\nProblem place:\n> "+description.substr(0,m.index)+"-->"+description.substr(m.index)+"<--")}entryName=m[1]||m[2]||m[3];if(m[1])attributes.id=entryName;else if(m[2])classNames.push(entryName);else{if(entryName!="class")attributes[entryName]=m[4]?m[5]||m[6]||m[7]||"":entryName}}if(IS_ATTRIBUTE_BUG_NAME&&attributes.name&&/^(input|textarea|select)$/i.test(elementName))elementName="<"+elementName+" name="+attributes.name+">"}element=document.createElement(elementName);if(attributes){if(attributes.style&&IS_ATTRIBUTE_BUG_STYLE)element.style.cssText=attributes.style;for(var attrName in attributes)element.setAttribute(attrName,attributes[attrName],0)}if(classNames&&classNames.length)element.className=classNames.join(" ");if(arguments.length>1)handleInsert(element,createFragment.apply(0,Array.from(arguments,1).flatten()));if(isConfig){if(config.css&&basis.cssom)basis.cssom.setStyle(element,config.css);if(basis.dom.event){for(var event in config)if(typeof config[event]=="function")basis.dom.event.addHandler(element,event,config[event],element);else if(config[event]instanceof basis.dom.event.Handler)basis.dom.event.addHandler(element,event,config[event].handler,config[event].thisObject)}}return element}function insert(node,source,insertPoint,refChild){node=get(node);if(!node)throw new Error("basis.dom.insert: destination node can't be null");switch(insertPoint){case undefined:case INSERT_END:refChild=null;break;case INSERT_BEGIN:refChild=node[FIRST_CHILD];break;case INSERT_BEFORE:break;case INSERT_AFTER:refChild=refChild[NEXT_SIBLING];break;default:refChild=Number(insertPoint).between(0,node.childNodes.length)?node.childNodes[insertPoint]:null}var isDOMLikeObject=!isNode(node);var result;if(!source||!Array.isArray(source))result=isDOMLikeObject?source&&node.insertBefore(source,refChild):handleInsert(node,source,refChild);else{if(isDOMLikeObject){result=new Array;for(var i=0,len=source.length;i<len;i++)result[i]=node.insertBefore(source[i],refChild)}else{node.insertBefore(createFragment.apply(0,source),refChild);result=createFragment.array}}return result}function remove(node){return node[PARENT_NODE]?node[PARENT_NODE].removeChild(node):node}function replace(oldNode,newNode){return oldNode[PARENT_NODE]?oldNode[PARENT_NODE].replaceChild(newNode,oldNode):oldNode}function swap(nodeA,nodeB){if(nodeA===nodeB||comparePosition(nodeA,nodeB)&(POSITION_CONTAINED_BY|POSITION_CONTAINS|POSITION_DISCONNECTED))return false;replace(nodeA,testElement);replace(nodeB,nodeA);replace(testElement,nodeB);return true}function clone(node,noChildren){var result=node.cloneNode(!noChildren);if(result.attachEvent)axis(result,AXIS_DESCENDANT_OR_SELF).forEach(Event.clearHandlers);return result}function clear(node){node=get(node);while(node[LAST_CHILD])node.removeChild(node[LAST_CHILD]);return node}function wrap(array,map,getter){var result=[];getter=Function.getter(getter||Function.$self);for(var k in map)for(var i=0;i<array.length;i++){var value=getter(array[i]);result[i]=map[k](array[i],i,value)?createElement(k,value):array[i]}return result}function setAttribute(node,name,value){if(value==null)node.removeAttribute(name);else node.setAttribute(name,value)}function is(element,names){return(new RegExp("(^|\\W)"+element.tagName+"(\\W|$)")).test(names)}function parentOf(node,child){return node.contains(child)}function isInside(node,root){return node==root||root.contains(node)}function focus(node,select){try{node=get(node);node.focus();if(select&&node.select)node.select()}catch(e){}}function setSelectionRange(input,start,end){if(arguments.length<3)end=start;if(input.setSelectionRange)input.setSelectionRange(start,end);else if(input.createTextRange){var range=input.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",end-start);range.select()}}function ieGetInputPosition(isStart){if(document.selection){var range=document.selection.createRange();if(range.compareEndPoints("StartToEnd",range)!=0)range.collapse(isStart);return range.getBookmark().charCodeAt(2)-2}}function getSelectionStart(input){if(typeof input.selectionStart!="undefined")return input.selectionStart;else return ieGetInputPosition(true)}function getSelectionEnd(input){if(typeof input.selectionEnd!="undefined")return input.selectionEnd;else return ieGetInputPosition(false)}function appendHead(node){if(document)insert(document.head||tag("head")[0],node);else{}}module.exports={ELEMENT_NODE:ELEMENT_NODE,ATTRIBUTE_NODE:ATTRIBUTE_NODE,TEXT_NODE:TEXT_NODE,CDATA_SECTION_NODE:CDATA_SECTION_NODE,ENTITY_REFERENCE_NODE:ENTITY_REFERENCE_NODE,ENTITY_NODE:ENTITY_NODE,PROCESSING_INSTRUCTION_NODE:PROCESSING_INSTRUCTION_NODE,COMMENT_NODE:COMMENT_NODE,DOCUMENT_TYPE_NODE:DOCUMENT_TYPE_NODE,DOCUMENT_NODE:DOCUMENT_NODE,DOCUMENT_FRAGMENT_NODE:DOCUMENT_FRAGMENT_NODE,NOTATION_NODE:NOTATION_NODE,AXIS_ANCESTOR:AXIS_ANCESTOR,AXIS_ANCESTOR_OR_SELF:AXIS_ANCESTOR_OR_SELF,AXIS_DESCENDANT:AXIS_DESCENDANT,AXIS_DESCENDANT_OR_SELF:AXIS_DESCENDANT_OR_SELF,AXIS_SELF:AXIS_SELF,AXIS_PARENT:AXIS_PARENT,AXIS_CHILD:AXIS_CHILD,AXIS_FOLLOWING:AXIS_FOLLOWING,AXIS_FOLLOWING_SIBLING:AXIS_FOLLOWING_SIBLING,AXIS_PRESCENDING:AXIS_PRESCENDING,AXIS_PRESCENDING_SIBLING:AXIS_PRESCENDING_SIBLING,INSERT_BEGIN:INSERT_BEGIN,INSERT_END:INSERT_END,INSERT_BEFORE:INSERT_BEFORE,INSERT_AFTER:INSERT_AFTER,TreeWalker:TreeWalker,outerHTML:outerHTML,textContent:textContent,get:get,tag:tag,axis:axis,findAncestor:findAncestor,createElement:createElement,createText:createText,createFragment:createFragment,insert:insert,remove:remove,replace:replace,swap:swap,clone:clone,clear:clear,wrap:wrap,setAttribute:setAttribute,parentOf:parentOf,isInside:isInside,focus:focus,setSelectionRange:setSelectionRange,getSelectionStart:getSelectionStart,getSelectionEnd:getSelectionEnd,appendHead:appendHead}}],
// ../../../src/basis/event.js
["basis.event", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var extend=Object.extend;var slice=Array.prototype.slice;var eventObjectId=1;var events={};var warnOnDestroy=function(){throw"Object had been destroed before. Destroy method shouldn't be call more than once."};function createEvent(eventName){var eventFunction=events[eventName];if(!eventFunction){eventFunction=events[eventName]=function dispatchEvent(){var handlers=this.handlers_;var handler;var args;var fn;if(eventFunction.listen)if(fn=this.listen[eventFunction.listenName])eventFunction.listen.call(this,fn,args=[this].concat(slice.call(arguments)));if(handlers&&handlers.length){handlers=slice.call(handlers);for(var i=handlers.length;i-->0;){handler=handlers[i];if(fn=handler.handler[eventName])if(typeof fn=="function"){args=args||[this].concat(slice.call(arguments));fn.apply(handler.thisObject,args)}if(fn=handler.handler["*"])if(typeof fn=="function")fn.call(handler.thisObject,{sender:this,type:eventName,args:arguments})}}};if(LISTEN_MAP[eventName])extend(eventFunction,LISTEN_MAP[eventName])}return eventFunction}var LISTEN_MAP={};var LISTEN={add:function(listenName,eventName,propertyName,handler){if(!propertyName)propertyName=listenName;LISTEN_MAP[eventName]={listenName:listenName,listen:handler||function(listen,args){var object;if(object=args[1])object.removeHandler(listen,this);if(object=this[propertyName])object.addHandler(listen,this)}};var eventFunction=events[eventName];if(eventFunction)extend(eventFunction,LISTEN_MAP[eventName])}};var EventObject=Class(null,{className:namespace+".EventObject",handlers_:null,event_destroy:createEvent("destroy"),listen:Class.nestedExtendProperty(),extendConstructor_:true,init:function(){if(this.handler){(this.handlers_||(this.handlers_=[])).push({handler:this.handler,thisObject:this.handlerContext||this})}},addHandler:function(handler,thisObject){var handlers=this.handlers_;if(!handlers)handlers=this.handlers_=[];if(!thisObject)thisObject=this;for(var i=handlers.length,item;i-->0;){item=handlers[i];if(item.handler===handler&&item.thisObject===thisObject){return false}}return!!handlers.push({handler:handler,thisObject:thisObject})},removeHandler:function(handler,thisObject){var handlers=this.handlers_;if(!handlers)return;if(!thisObject)thisObject=this;for(var i=handlers.length,item;i-->0;){item=handlers[i];if(item.handler===handler&&item.thisObject===thisObject)return!!handlers.splice(i,1)}return false},destroy:function(){if(this.handlers_){events.destroy.call(this);this.handlers_=null}}});module.exports={LISTEN:LISTEN,create:createEvent,events:events,EventObject:EventObject}}],
// ../../../src/basis/data.js
["basis.data", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var Cleaner=basis.Cleaner;var values=Object.values;var $self=Function.$self;var EventObject=basis.event.EventObject;var LISTEN=basis.event.LISTEN;var createEvent=basis.event.create;var events=basis.event.events;var NULL_OBJECT={};var EMPTY_ARRAY=[];var STATE_EXISTS={};var STATE={PRIORITY:[],add:function(state,order){var name=state.toUpperCase();var value=state.toLowerCase();this[name]=value;STATE_EXISTS[value]=name;if(order)order=this.PRIORITY.indexOf(order);else order=-1;if(order==-1)this.PRIORITY.push(value);else this.PRIORITY.splice(order,0,value)},getList:function(){return Object.values(STATE_EXISTS)}};STATE.add("READY");STATE.add("DEPRECATED");STATE.add("UNDEFINED");STATE.add("ERROR");STATE.add("PROCESSING");var subscriptionHandlers={};var subscriptionSeed=1;var SUBSCRIPTION={NONE:0,ALL:0,add:function(name,handler,action){subscriptionHandlers[subscriptionSeed]={handler:handler,action:action,context:{add:function(thisObject,object){if(object){var subscriberId=SUBSCRIPTION[name]+"_"+thisObject.eventObjectId;if(!object.subscribers_)object.subscribers_={};if(!object.subscribers_[subscriberId]){var oldSubscriberCount=object.subscriberCount;object.subscribers_[subscriberId]=thisObject;object.subscriberCount+=1;object.event_subscribersChanged(oldSubscriberCount)}else{}}},remove:function(thisObject,object){if(object){var subscriberId=SUBSCRIPTION[name]+"_"+thisObject.eventObjectId;if(object.subscribers_[subscriberId]){var oldSubscriberCount=object.subscriberCount;delete object.subscribers_[subscriberId];object.subscriberCount-=1;object.event_subscribersChanged(oldSubscriberCount)}else{}}}}};SUBSCRIPTION[name]=subscriptionSeed;SUBSCRIPTION.ALL|=subscriptionSeed;subscriptionSeed<<=1}};function applySubscription(object,mask,state){var idx=1;var config;while(mask){if(mask&1){config=subscriptionHandlers[idx];if(state&idx){object.addHandler(config.handler,config.context);config.action(config.context.add,object)}else{object.removeHandler(config.handler,config.context);config.action(config.context.remove,object)}}mask>>=1;idx<<=1}}SUBSCRIPTION.add("DELEGATE",{delegateChanged:function(object,oldDelegate){this.remove(object,oldDelegate);this.add(object,object.delegate)}},function(action,object){action(object,object.delegate)});SUBSCRIPTION.add("TARGET",{targetChanged:function(object,oldTarget){this.remove(object,oldTarget);this.add(object,object.target)}},function(action,object){action(object,object.target)});var DataObject=Class(EventObject,{className:namespace+".DataObject",state:STATE.READY,data:null,canHaveDelegate:true,delegate:null,root:null,cascadeDestroy:false,isTarget:false,target:null,active:false,subscribeTo:SUBSCRIPTION.DELEGATE+SUBSCRIPTION.TARGET,subscriberCount:0,subscribers_:null,event_update:createEvent("update","delta"),event_stateChanged:createEvent("stateChanged","oldState"),event_delegateChanged:createEvent("delegateChanged","oldDelegate"),event_rootChanged:createEvent("rootChanged","oldRoot"),event_targetChanged:createEvent("targetChanged","oldTarget"),event_subscribersChanged:createEvent("subscribersChanged"),event_activeChanged:createEvent("activeChanged"),listen:{delegate:{update:function(object,delta){this.data=object.data;this.event_update(delta)},stateChanged:function(object,oldState){this.state=object.state;this.event_stateChanged(oldState)},targetChanged:function(object,oldTarget){this.target=object.target;this.event_targetChanged(oldTarget)},rootChanged:function(object,oldRoot){this.data=object.data;this.root=object.root;this.event_rootChanged(oldRoot)},destroy:function(){if(this.cascadeDestroy)this.destroy();else this.setDelegate()}}},init:function(){EventObject.prototype.init.call(this);var delegate=this.delegate;if(delegate){this.delegate=null;this.data=delegate.data;this.state=delegate.state;this.setDelegate(delegate)}else{this.root=this;if(!this.data)this.data={};if(this.isTarget)this.target=this}if(this.active)applySubscription(this,this.subscribeTo,SUBSCRIPTION.ALL)},isConnected:function(object){if(object instanceof DataObject){while(object&&object!==this&&object!==object.delegate)object=object.delegate;return object===this}return false},getRootDelegate:function(){var object=this;while(object.delegate&&object.delegate!==object)object=object.delegate;return object},setDelegate:function(newDelegate){if(this.canHaveDelegate&&newDelegate&&newDelegate instanceof DataObject){if(newDelegate.delegate&&this.isConnected(newDelegate)){return false}}else{newDelegate=null}if(this.delegate!==newDelegate){var oldState=this.state;var oldData=this.data;var oldDelegate=this.delegate;var oldTarget=this.target;var oldRoot=this.root;var delta={};var delegateListenHandler=this.listen.delegate;var targetListenHandler=(oldTarget||newDelegate)&&(!newDelegate||newDelegate.target!==oldTarget)&&this.listen.target;if(oldDelegate&&delegateListenHandler)oldDelegate.removeHandler(delegateListenHandler,this);if(oldTarget&&targetListenHandler)oldTarget.removeHandler(targetListenHandler,this);if(newDelegate){this.delegate=newDelegate;this.root=newDelegate.root;this.data=newDelegate.data;this.state=newDelegate.state;this.target=newDelegate.target;for(var key in newDelegate.data)if(key in oldData===false)delta[key]=undefined;for(var key in oldData)if(oldData[key]!==newDelegate.data[key])delta[key]=oldData[key];if(delegateListenHandler)newDelegate.addHandler(delegateListenHandler,this);if(newDelegate.target&&targetListenHandler)newDelegate.target.addHandler(targetListenHandler,this);for(var key in delta){this.event_update(delta);break}if(oldState!==this.state&&(String(oldState)!=this.state||oldState.data!==this.state.data))this.event_stateChanged(oldState)}else{this.delegate=null;this.target=null;this.root=this;this.data={};for(var key in oldData)this.data[key]=oldData[key]}if(this.root!==oldRoot)this.event_rootChanged(oldRoot);if(this.target!==oldTarget)this.event_targetChanged(oldTarget);this.event_delegateChanged(oldDelegate);return true}return false},setState:function(state,data){var root=this.target||this.getRootDelegate();if(root!==this)return root.setState(state,data);var stateCode=String(state);if(!STATE_EXISTS[stateCode])throw new Error("Wrong state value");if(this.state!=stateCode||this.state.data!=data){var oldState=this.state;this.state=Object(stateCode);this.state.data=data;this.event_stateChanged(oldState);return true}return false},deprecate:function(){if(this.state!=STATE.PROCESSING)this.setState(STATE.DEPRECATED)},update:function(data){var root=this.target||this.getRootDelegate();if(root!==this)return root.update(data);if(data){var delta={};var updateCount=0;for(var prop in data){if(this.data[prop]!==data[prop]){updateCount++;delta[prop]=this.data[prop];this.data[prop]=data[prop]}}if(updateCount){this.event_update(delta);return delta}}return false},setActive:function(isActive){isActive=!!isActive;if(this.active!=isActive){this.active=isActive;this.event_activeChanged();applySubscription(this,this.subscribeTo,SUBSCRIPTION.ALL*isActive);return true}return false},setSubscription:function(subscriptionType){var curSubscriptionType=this.subscribeTo;var newSubscriptionType=subscriptionType&SUBSCRIPTION.ALL;var delta=curSubscriptionType^newSubscriptionType;if(delta){this.subscribeTo=newSubscriptionType;if(this.active)applySubscription(this,delta,newSubscriptionType);return true}return false},destroy:function(){if(this.active)applySubscription(this,this.subscribeTo,0);if(this.delegate)this.setDelegate();EventObject.prototype.destroy.call(this);this.data=NULL_OBJECT;this.state=STATE.UNDEFINED;this.root=null;this.target=null}});var KEYOBJECTMAP_MEMBER_HANDLER={destroy:function(object){delete this.map[this.itemId]}};var KeyObjectMap=Class(null,{className:namespace+".KeyObjectMap",itemClass:DataObject,keyGetter:$self,map_:null,extendConstructor_:true,init:function(){this.map_={};Cleaner.add(this)},resolve:function(object){return this.get(this.keyGetter(object),object)},create:function(key,object){var itemConfig={};if(key instanceof DataObject){itemConfig.delegate=key}else{itemConfig.data={id:key,title:key}}return new this.itemClass(itemConfig)},get:function(key,object){var itemId=key instanceof DataObject?key.eventObjectId:key;var item=this.map_[itemId];if(!item&&object){item=this.map_[itemId]=this.create(key,object);item.addHandler(KEYOBJECTMAP_MEMBER_HANDLER,{map:this.map_,itemId:itemId})}return item},destroy:function(){Cleaner.remove(this);var items=values(this.map_);for(var i=0,item;item=items[i++];)item.destroy()}});function getDelta(inserted,deleted){var delta={};var result;if(inserted&&inserted.length)result=delta.inserted=inserted;if(deleted&&deleted.length)result=delta.deleted=deleted;if(result)return delta}var AbstractDataset=Class(DataObject,{className:namespace+".AbstractDataset",state:STATE.UNDEFINED,itemCount:0,item_:null,memberMap_:null,cache_:null,syncEvents:Class.oneFunctionProperty(function(){if(this.isSyncRequired())this.syncAction()},{stateChanged:true,subscribersChanged:true}),isSyncRequired:function(){return this.subscriberCount>0&&(this.state==STATE.UNDEFINED||this.state==STATE.DEPRECATED)},syncAction:false,event_datasetChanged:createEvent("datasetChanged","delta")&&function(delta){var items;var insertCount=0;var deleteCount=0;var object;if(items=delta.inserted){while(object=items[insertCount]){this.item_[object.eventObjectId]=object;insertCount++}}if(items=delta.deleted){while(object=items[deleteCount]){delete this.item_[object.eventObjectId];deleteCount++}}this.itemCount+=insertCount-deleteCount;this.cache_=null;events.datasetChanged.call(this,delta)},init:function(){DataObject.prototype.init.call(this);if(this.syncAction)this.setSyncAction(this.syncAction);this.memberMap_={};this.item_={}},has:function(object){return!!(object&&this.item_[object.eventObjectId])},getItems:function(){if(!this.cache_)this.cache_=values(this.item_);return this.cache_},pick:function(){for(var objectId in this.item_)return this.item_[objectId];return null},top:function(count){var result=[];if(count)for(var objectId in this.item_)if(result.push(this.item_[objectId])>=count)break;return result},add:function(items){},remove:function(items){},set:function(items){},sync:function(items,set){},clear:function(){},setSyncAction:function(syncAction){if(typeof syncAction!="function")syncAction=false;this.syncAction=syncAction;if(syncAction){this.addHandler(this.syncEvents);if(this.isSyncRequired())this.syncAction()}else{this.removeHandler(this.syncEvents)}},destroy:function(){this.clear();DataObject.prototype.destroy.call(this);this.cache_=EMPTY_ARRAY;this.itemCount=0;this.memberMap_=null;this.item_=null}});var Dataset=Class(AbstractDataset,{className:namespace+".Dataset",listen:{item:{destroy:function(object){this.remove([object])}}},init:function(){AbstractDataset.prototype.init.call(this);var items=this.items;if(items){this.items=null;this.set(items)}},add:function(data){var delta;var memberMap=this.memberMap_;var inserted=[];var listenHandler=this.listen.item;for(var i=0;i<data.length;i++){var object=data[i];if(object instanceof DataObject){var objectId=object.eventObjectId;if(!memberMap[objectId]){memberMap[objectId]=object;if(listenHandler)object.addHandler(listenHandler,this);inserted.push(object)}}}if(inserted.length){this.event_datasetChanged(delta={inserted:inserted})}return delta},remove:function(data){var delta;var memberMap=this.memberMap_;var deleted=[];var listenHandler=this.listen.item;for(var i=0;i<data.length;i++){var object=data[i];if(object instanceof DataObject){var objectId=object.eventObjectId;if(memberMap[objectId]){if(listenHandler)object.removeHandler(listenHandler,this);delete memberMap[objectId];deleted.push(object)}}}if(deleted.length){this.event_datasetChanged(delta={deleted:deleted})}return delta},set:function(data){if(!this.itemCount)return this.add(data);if(!data.length)return this.clear();var memberMap=this.memberMap_;var exists={};var deleted=[];var inserted=[];var object;var objectId;var delta;var listenHandler=this.listen.item;for(var i=0;i<data.length;i++){object=data[i];if(object instanceof DataObject){objectId=object.eventObjectId;exists[objectId]=object;if(!memberMap[objectId]){memberMap[objectId]=object;if(listenHandler)object.addHandler(listenHandler,this);inserted.push(object)}}}for(var objectId in memberMap){if(!exists[objectId]){object=memberMap[objectId];if(listenHandler)object.removeHandler(listenHandler,this);delete memberMap[objectId];deleted.push(object)}}if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta);return delta},sync:function(data,set){if(!data)return;Dataset.setAccumulateState(true);var memberMap=this.memberMap_;var object;var objectId;var exists={};var inserted=[];var deleted=[];var res;for(var i=0;i<data.length;i++){object=data[i];if(object instanceof DataObject){objectId=object.eventObjectId;exists[objectId]=object;if(!memberMap[objectId])inserted.push(object)}}for(var objectId in this.item_){if(!exists[objectId])this.item_[objectId].destroy()}if(set&&inserted.length)res=this.add(inserted);Dataset.setAccumulateState(false);return res},clear:function(){var delta;var deleted=this.getItems();var listenHandler=this.listen.item;if(deleted.length){if(listenHandler)for(var i=deleted.length;i-->0;)deleted[i].removeHandler(listenHandler,this);this.event_datasetChanged(delta={deleted:deleted});this.memberMap_={}}return delta}});Dataset.setAccumulateState=function(){var proto=AbstractDataset.prototype;var realEvent=proto.event_datasetChanged;var setStateCount=0;var urgentTimer;var eventCache={};function flushCache(cache){var dataset=cache.dataset;realEvent.call(dataset,cache)}function flushAllDataset(){var eventCacheCopy=eventCache;eventCache={};for(var datasetId in eventCacheCopy)flushCache(eventCacheCopy[datasetId])}function storeDatasetDelta(delta){var dataset=this;var datasetId=dataset.eventObjectId;var inserted=delta.inserted;var deleted=delta.deleted;var cache=eventCache[datasetId];if(inserted&&deleted){if(cache){delete eventCache[datasetId];flushCache(cache)}return realEvent.call(dataset,delta)}var mode=inserted?"inserted":"deleted";if(cache){var array=cache[mode];if(!array)flushCache(cache);else return array.push.apply(array,inserted||deleted)}eventCache[datasetId]=delta;delta.dataset=dataset}function urgentFlush(){urgentTimer=null;if(setStateCount){setStateCount=0;setAccumulateStateOff()}}function setAccumulateStateOff(){proto.event_datasetChanged=realEvent;flushAllDataset()}return function(state){if(state){if(setStateCount==0){proto.event_datasetChanged=storeDatasetDelta;if(!urgentTimer)urgentTimer=setTimeout(urgentFlush,0)}setStateCount++}else{setStateCount-=setStateCount>0;if(setStateCount==0)setAccumulateStateOff()}}}();function dataWrapper(data){if(Array.isArray(data))return data.map(dataWrapper);else return{data:data}}this.setWrapper(dataWrapper);module.exports={STATE:STATE,SUBSCRIPTION:SUBSCRIPTION,Object:DataObject,DataObject:DataObject,KeyObjectMap:KeyObjectMap,AbstractDataset:AbstractDataset,Dataset:Dataset}}],
// ../../../src/basis/data/dataset.js
["basis.data.dataset", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var oneFunctionProperty=Class.oneFunctionProperty;var extend=Object.extend;var values=Object.values;var $self=Function.$self;var $true=Function.$true;var $false=Function.$false;var createEvent=basis.event.create;var SUBSCRIPTION=basis.data.SUBSCRIPTION;var DataObject=basis.data.DataObject;var KeyObjectMap=basis.data.KeyObjectMap;var AbstractDataset=basis.data.AbstractDataset;var Dataset=basis.data.Dataset;SUBSCRIPTION.add("SOURCE",{sourceChanged:function(object,oldSource){this.remove(object,oldSource);this.add(object,object.source)},sourcesChanged:function(object,delta){var array;if(array=delta.inserted)for(var i=array.length;i-->0;)this.add(object,array[i]);if(array=delta.deleted)for(var i=array.length;i-->0;)this.remove(object,array[i])}},function(action,object){var sources=object.sources||[object.source];for(var i=0,source;source=sources[i++];)action(object,source)});SUBSCRIPTION.add("MINUEND",{operandsChanged:function(object,oldMinuend,oldSubtrahend){if(this.minuend!==oldMinuend){this.remove(object,oldMinuend);this.add(object,object.minuend)}}},function(action,object){action(object,object.minuend)});SUBSCRIPTION.add("SUBTRAHEND",{operandsChanged:function(object,oldMinuend,oldSubtrahend){if(this.subtrahend!==oldSubtrahend){this.remove(object,oldSubtrahend);this.add(object,object.subtrahend)}}},function(action,object){action(object,object.subtrahend)});function getDelta(inserted,deleted){var delta={};var result;if(inserted&&inserted.length)result=delta.inserted=inserted;if(deleted&&deleted.length)result=delta.deleted=deleted;if(result)return delta}var MERGE_DATASET_HANDLER={datasetChanged:function(source,delta){var memberMap=this.memberMap_;var updated={};var deleted=[];var object;var objectId;if(delta.inserted){for(var i=0;object=delta.inserted[i];i++){objectId=object.eventObjectId;if(memberMap[objectId]){memberMap[objectId].count++}else{memberMap[objectId]={count:1,object:object}}updated[objectId]=memberMap[objectId]}}if(delta.deleted){for(var i=0;object=delta.deleted[i];i++){objectId=object.eventObjectId;updated[objectId]=memberMap[objectId];memberMap[objectId].count--}}this.applyRule(updated)},destroy:function(source){this.removeSource(source)}};var Merge=Class(AbstractDataset,{className:namespace+".Merge",subscribeTo:SUBSCRIPTION.SOURCE,event_sourcesChanged:createEvent("sourcesChanged","delta"),sources:null,rule:function(count,sourceCount){return count>0},listen:{source:MERGE_DATASET_HANDLER},init:function(){AbstractDataset.prototype.init.call(this);var sources=this.sources;this.sources=[];if(sources)sources.forEach(this.addSource,this)},setRule:function(rule){if(typeof rule!="function")rule=Merge.UNION;if(this.rule!==rule){this.rule=rule;this.applyRule()}},applyRule:function(scope){var memberMap=this.memberMap_;var rule=this.rule;var sourceCount=this.sources.length;var inserted=[];var deleted=[];var memberCounter;var isMember;var delta;if(!scope)scope=memberMap;for(var objectId in scope){memberCounter=memberMap[objectId];isMember=sourceCount&&memberCounter.count&&rule(memberCounter.count,sourceCount);if(isMember!=!!this.item_[objectId])(isMember?inserted:deleted).push(memberCounter.object);if(memberCounter.count==0)delete memberMap[objectId]}if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta);return delta},addSource:function(source){if(source instanceof AbstractDataset){if(this.sources.add(source)){if(this.listen.source)source.addHandler(this.listen.source,this);var memberMap=this.memberMap_;for(var objectId in source.item_){if(memberMap[objectId]){memberMap[objectId].count++}else{memberMap[objectId]={count:1,object:source.item_[objectId]}}}this.applyRule();this.event_sourcesChanged({inserted:[source]});return true}}else{}},removeSource:function(source){if(this.sources.remove(source)){if(this.listen.source)source.removeHandler(this.listen.source,this);var memberMap=this.memberMap_;for(var objectId in source.item_)memberMap[objectId].count--;this.applyRule();this.event_sourcesChanged({deleted:[source]});return true}else{}},setSources:function(sources){var exists=Array.from(this.sources);for(var i=0,source;source=sources[i];i++){if(source instanceof AbstractDataset){if(!exists.remove(source))this.addSource(source)}else{}}exists.forEach(this.removeSource,this)},clear:function(){Array.from(this.sources).forEach(this.removeSource,this)},destroy:function(){AbstractDataset.prototype.destroy.call(this);this.sources=null}});Merge.UNION=Merge.prototype.rule;Merge.INTERSECTION=function(count,sourceCount){return count==sourceCount};Merge.DIFFERENCE=function(count,sourceCount){return count==1};Merge.MORE_THAN_ONE_INCLUDE=function(count,sourceCount){return sourceCount==1||count>1};Merge.AT_LEAST_ONE_EXCLUDE=function(count,sourceCount){return sourceCount==1||count<sourceCount};var datasetAbsentFilter=function(item){return!this.has(item)};var SUBTRACTDATASET_MINUEND_HANDLER={datasetChanged:function(dataset,delta){if(!this.subtrahend)return;var newDelta=getDelta(delta.inserted&&delta.inserted.filter(datasetAbsentFilter,this.subtrahend),delta.deleted&&delta.deleted.filter(this.has,this));if(newDelta)this.event_datasetChanged(newDelta)},destroy:function(){this.setOperands(null,this.subtrahend)}};var SUBTRACTDATASET_SUBTRAHEND_HANDLER={datasetChanged:function(dataset,delta){if(!this.minuend)return;var newDelta=getDelta(delta.deleted&&delta.deleted.filter(datasetAbsentFilter,this),delta.inserted&&delta.inserted.filter(this.has,this));if(newDelta)this.event_datasetChanged(newDelta)},destroy:function(){this.setOperands(this.minuend,null)}};var Subtract=Class(AbstractDataset,{className:namespace+".Subtract",subscribeTo:SUBSCRIPTION.MINUEND+SUBSCRIPTION.SUBTRAHEND,minuend:null,subtrahend:null,event_operandsChanged:createEvent("operandsChanged","oldMinuend","oldSubtrahend"),listen:{minuend:SUBTRACTDATASET_MINUEND_HANDLER,subtrahend:SUBTRACTDATASET_SUBTRAHEND_HANDLER},init:function(){AbstractDataset.prototype.init.call(this);var minuend=this.minuend;var subtrahend=this.subtrahend;this.minuend=null;this.subtrahend=null;if(minuend||subtrahend)this.setOperands(minuend,subtrahend)},setOperands:function(minuend,subtrahend){var delta;var operandsChanged=false;if(minuend instanceof AbstractDataset==false)minuend=null;if(subtrahend instanceof AbstractDataset==false)subtrahend=null;var oldMinuend=this.minuend;var oldSubtrahend=this.subtrahend;if(oldMinuend!==minuend){operandsChanged=true;this.minuend=minuend;var listenHandler=this.listen.minuend;if(listenHandler){if(oldMinuend)oldMinuend.removeHandler(listenHandler,this);if(minuend)minuend.addHandler(listenHandler,this)}}if(oldSubtrahend!==subtrahend){operandsChanged=true;this.subtrahend=subtrahend;var listenHandler=this.listen.subtrahend;if(listenHandler){if(oldSubtrahend)oldSubtrahend.removeHandler(listenHandler,this);if(subtrahend)subtrahend.addHandler(listenHandler,this)}}if(!operandsChanged)return false;this.event_operandsChanged(oldMinuend,oldSubtrahend);if(!minuend||!subtrahend){if(this.itemCount)this.event_datasetChanged(delta={deleted:this.getItems()})}else{var deleted=[];var inserted=[];for(var key in this.item_)if(!minuend.item_[key]||subtrahend.item_[key])deleted.push(this.item_[key]);for(var key in minuend.item_)if(!this.item_[key]&&!subtrahend.item_[key])inserted.push(minuend.item_[key]);if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta)}return delta},setMinuend:function(minuend){return this.setOperands(minuend,this.subtrahend)},setSubtrahend:function(subtrahend){return this.setOperands(this.minuend,subtrahend)},clear:function(){this.setOperands()}});var SourceDatasetMixin={subscribeTo:SUBSCRIPTION.SOURCE,source:null,sourceMap_:null,event_sourceChanged:createEvent("sourceChanged","oldSource"),listen:{source:{destroy:function(){this.setSource()}}},init:function(){this.sourceMap_={};var source=this.source;if(source)this.source=null;AbstractDataset.prototype.init.call(this);if(source)this.setSource(source)},setSource:function(source){if(source instanceof AbstractDataset==false)source=null;if(this.source!==source){var oldSource=this.source;var listenHandler=this.listen.source;this.source=source;if(listenHandler){var datasetChangedHandler=listenHandler.datasetChanged;if(oldSource){oldSource.removeHandler(listenHandler,this);if(datasetChangedHandler)datasetChangedHandler.call(this,oldSource,{deleted:oldSource.getItems()})}if(source){source.addHandler(listenHandler,this);if(datasetChangedHandler)datasetChangedHandler.call(this,source,{inserted:source.getItems()})}}this.event_sourceChanged(oldSource)}},clear:function(){this.setSource()},destroy:function(){AbstractDataset.prototype.destroy.call(this);this.sourceMap_=null}};var MAPREDUCE_SOURCEOBJECT_UPDATE=function(sourceObject){var newMember=this.map?this.map(sourceObject):object;if(newMember instanceof DataObject==false||this.reduce(newMember))newMember=null;var sourceMap=this.sourceMap_[sourceObject.eventObjectId];var curMember=sourceMap.member;if(curMember!==newMember){var memberMap=this.memberMap_;var delta;var inserted;var deleted;sourceMap.member=newMember;if(curMember){var curMemberId=curMember.eventObjectId;if(this.removeMemberRef)this.removeMemberRef(curMember,sourceObject);if(--memberMap[curMemberId]==0){delete memberMap[curMemberId];deleted=[curMember]}}if(newMember){var newMemberId=newMember.eventObjectId;if(this.addMemberRef)this.addMemberRef(newMember,sourceObject);if(memberMap[newMemberId]){memberMap[newMemberId]++}else{memberMap[newMemberId]=1;inserted=[newMember]}}if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta)}};var MAPREDUCE_SOURCE_HANDLER={datasetChanged:function(source,delta){var sourceMap=this.sourceMap_;var memberMap=this.memberMap_;var inserted=[];var deleted=[];var sourceObject;var sourceObjectId;var member;var updateHandler=this.ruleEvents;Dataset.setAccumulateState(true);if(delta.inserted){for(var i=0;sourceObject=delta.inserted[i];i++){member=this.map?this.map(sourceObject):sourceObject;if(member instanceof DataObject==false||this.reduce(member))member=null;if(updateHandler)sourceObject.addHandler(updateHandler,this);sourceMap[sourceObject.eventObjectId]={sourceObject:sourceObject,member:member};if(member){var memberId=member.eventObjectId;if(memberMap[memberId]){memberMap[memberId]++}else{memberMap[memberId]=1;inserted.push(member)}if(this.addMemberRef)this.addMemberRef(member,sourceObject)}}}if(delta.deleted){for(var i=0;sourceObject=delta.deleted[i];i++){sourceObjectId=sourceObject.eventObjectId;member=sourceMap[sourceObjectId].member;if(updateHandler)sourceObject.removeHandler(updateHandler,this);delete sourceMap[sourceObjectId];if(member){var memberId=member.eventObjectId;if(--memberMap[memberId]==0){delete memberMap[memberId];deleted.push(member)}if(this.removeMemberRef)this.removeMemberRef(member,sourceObject)}}}Dataset.setAccumulateState(false);if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta)}};var MapReduce=Class(AbstractDataset,SourceDatasetMixin,{className:namespace+".MapReduce",map:$self,reduce:$false,rule:Function.getter($true),ruleEvents:oneFunctionProperty(MAPREDUCE_SOURCEOBJECT_UPDATE,{update:true}),addMemberRef:null,removeMemberRef:null,listen:{source:MAPREDUCE_SOURCE_HANDLER},setMap:function(map){if(typeof map!="function")map=$self;if(this.map!==map){this.map=map;return this.applyRule()}},setReduce:function(reduce){if(typeof reduce!="function")reduce=$false;if(this.reduce!==reduce){this.reduce=reduce;return this.applyRule()}},setRule:function(rule){if(typeof rule!="function")rule=$true;if(this.rule!==rule){this.rule=rule;return this.applyRule()}},applyRule:function(){var sourceMap=this.sourceMap_;var memberMap=this.memberMap_;var curMember;var newMember;var curMemberId;var newMemberId;var sourceObject;var sourceObjectInfo;var inserted=[];var deleted=[];var delta;for(var sourceObjectId in sourceMap){sourceObjectInfo=sourceMap[sourceObjectId];sourceObject=sourceObjectInfo.sourceObject;curMember=sourceObjectInfo.member;newMember=this.map?this.map(sourceObject):sourceObject;if(newMember instanceof DataObject==false||this.reduce(newMember))newMember=null;if(curMember!=newMember){sourceObjectInfo.member=newMember;if(curMember){curMemberId=curMember.eventObjectId;if(this.removeMemberRef)this.removeMemberRef(curMember,sourceObject);memberMap[curMemberId]--}if(newMember){newMemberId=newMember.eventObjectId;if(this.addMemberRef)this.addMemberRef(newMember,sourceObject);if(newMemberId in memberMap){memberMap[newMemberId]++}else{memberMap[newMemberId]=1;inserted.push(newMember)}}}}for(var curMemberId in this.item_)if(memberMap[curMemberId]==0){delete memberMap[curMemberId];deleted.push(this.item_[curMemberId])}if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta);return delta}});var Subset=Class(MapReduce,{className:namespace+".Subset",reduce:function(object){return!this.rule(object)}});var Split=Class(MapReduce,{className:namespace+".Split",subsetClass:AbstractDataset,keyMap:null,map:function(sourceObject){return this.keyMap.resolve(sourceObject)},setRule:function(rule){if(typeof rule!="function")rule=$true;if(this.rule!==rule){this.rule=rule;this.keyMap.keyGetter=rule;return this.applyRule()}},addMemberRef:function(subset,sourceObject){subset.event_datasetChanged({inserted:[sourceObject]})},removeMemberRef:function(subset,sourceObject){subset.event_datasetChanged({deleted:[sourceObject]})},init:function(){if(!this.keyMap||this.keyMap instanceof KeyObjectMap==false)this.keyMap=new KeyObjectMap(extend({keyGetter:this.rule,itemClass:this.subsetClass},this.keyMap));MapReduce.prototype.init.call(this)},getSubset:function(data,autocreate){return this.keyMap.get(data,autocreate)},destroy:function(){MapReduce.prototype.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});function binarySearchPos(array,map){if(!array.length)return 0;var pos;var id=map.object.eventObjectId;var value=map.value||0;var cmpValue;var cmpId;var item;var l=0;var r=array.length-1;do{pos=l+r>>1;item=array[pos];cmpValue=item.value;if(cmpValue===value){cmpId=item.object.eventObjectId;if(id<cmpId)r=pos-1;else if(id>cmpId)l=pos+1;else return id==cmpId?pos:0}else{if(value<cmpValue)r=pos-1;else if(value>cmpValue)l=pos+1;else return value==cmpValue?pos:0}}while(l<=r);return pos+(cmpValue<value)}var SLICE_SOURCEOBJECT_UPDATE=function(sourceObject){var sourceObjectInfo=this.sourceMap_[sourceObject.eventObjectId];var newValue=this.rule(sourceObject);var index_=this.index_;if(newValue!==sourceObjectInfo.value){index_.splice(binarySearchPos(index_,sourceObjectInfo),1);sourceObjectInfo.value=newValue;index_.splice(binarySearchPos(index_,sourceObjectInfo),0,sourceObjectInfo);this.applyRule()}};function sliceIndexSort(a,b){return+(a.value>b.value)||-(a.value<b.value)||a.object.eventObjectId-b.object.eventObjectId}var SLICE_SOURCE_HANDLER={datasetChanged:function(source,delta){var sourceMap=this.sourceMap_;var index=this.index_;var updateHandler=this.ruleEvents;var dropIndex=false;var buildIndex=false;var sourceObjectInfo;var sourceObjectId;var inserted=delta.inserted;var deleted=delta.deleted;if(deleted){if(deleted.length>index.length-deleted.length){dropIndex=true;buildIndex=deleted.length!=index.length;index.length=0}for(var i=0,sourceObject;sourceObject=deleted[i];i++){if(!dropIndex){sourceObjectInfo=sourceMap[sourceObject.eventObjectId];index.splice(binarySearchPos(index,sourceObjectInfo),1)}delete sourceMap[sourceObject.eventObjectId];if(updateHandler)sourceObject.removeHandler(updateHandler,this)}if(buildIndex)for(var key in sourceMap){sourceObjectInfo=sourceMap[key];index.splice(binarySearchPos(index,sourceObjectInfo),0,sourceObjectInfo)}}if(inserted){buildIndex=!index.length;for(var i=0,sourceObject;sourceObject=inserted[i];i++){sourceObjectInfo={object:sourceObject,value:this.rule(sourceObject)};sourceMap[sourceObject.eventObjectId]=sourceObjectInfo;if(!buildIndex)index.splice(binarySearchPos(index,sourceObjectInfo),0,sourceObjectInfo);else index.push(sourceObjectInfo);if(updateHandler)sourceObject.addHandler(updateHandler,this)}if(buildIndex)index.sort(sliceIndexSort)}this.applyRule()}};var Slice=Class(AbstractDataset,SourceDatasetMixin,{className:namespace+".Slice",rule:Function.getter($true),ruleEvents:oneFunctionProperty(SLICE_SOURCEOBJECT_UPDATE,{update:true}),index_:null,orderDesc:false,offset:0,limit:10,listen:{source:SLICE_SOURCE_HANDLER},event_rangeChanged:createEvent("rangeChanged","oldOffset","oldLimit"),init:function(){this.index_=[];SourceDatasetMixin.init.call(this)},setRange:function(offset,limit){var oldOffset=this.offset;var oldLimit=this.limit;var delta=false;if(oldOffset!=offset||oldLimit!=limit){this.offset=offset;this.limit=limit;delta=this.applyRule();this.event_rangeChanged(oldOffset,oldLimit)}},setOffset:function(offset){return this.setRange(offset,this.limit)},setLimit:function(limit){return this.setRange(this.offset,limit)},applyRule:function(){var start=this.offset;var end=start+this.limit;if(this.orderDesc){start=this.index_.length-end;end=start+this.limit}var curSet=Object.slice(this.item_);var newSet=this.index_.slice(Math.max(0,start),Math.max(0,end));var inserted=[];var delta;for(var i=0,item;item=newSet[i];i++){var objectId=item.object.eventObjectId;if(curSet[objectId])delete curSet[objectId];else inserted.push(item.object)}if(delta=getDelta(inserted,values(curSet)))this.event_datasetChanged(delta);return delta},destroy:function(){SourceDatasetMixin.destroy.call(this);this.index_=null}});var CLOUD_SOURCEOBJECT_UPDATE=function(sourceObject){var sourceMap=this.sourceMap_;var memberMap=this.memberMap_;var sourceObjectId=sourceObject.eventObjectId;var oldList=sourceMap[sourceObjectId].list;var newList=sourceMap[sourceObjectId].list={};var list=this.rule(sourceObject);var delta;var inserted=[];var deleted=[];var subset;if(Array.isArray(list))for(var j=0;j<list.length;j++){subset=this.keyMap.resolve(list[j]);if(subset){subsetId=subset.eventObjectId;newList[subsetId]=subset;if(!oldList[subsetId]){subset.event_datasetChanged({inserted:[sourceObject]});if(!memberMap[subsetId]){inserted.push(subset);memberMap[subsetId]=1}else memberMap[subsetId]++}}}for(var subsetId in oldList)if(!newList[subsetId]){var subset=oldList[subsetId];subset.event_datasetChanged({deleted:[sourceObject]});if(!--memberMap[subsetId]){delete memberMap[subsetId];deleted.push(subset)}}if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta)};var CLOUD_SOURCE_HANDLER={datasetChanged:function(dataset,delta){var sourceMap=this.sourceMap_;var memberMap=this.memberMap_;var updateHandler=this.ruleEvents;var objectInfo;var array;var subset;var subsetId;var inserted=[];var deleted=[];Dataset.setAccumulateState(true);if(array=delta.inserted)for(var i=0,sourceObject;sourceObject=array[i];i++){var list=this.rule(sourceObject);var sourceObjectInfo={object:sourceObject,list:{}};sourceMap[sourceObject.eventObjectId]=sourceObjectInfo;if(Array.isArray(list))for(var j=0;j<list.length;j++){subset=this.keyMap.get(list[j],true);if(subset&&!subset.has(sourceObject)){subsetId=subset.eventObjectId;sourceObjectInfo.list[subsetId]=subset;subset.event_datasetChanged({inserted:[sourceObject]});if(!memberMap[subsetId]){inserted.push(subset);memberMap[subsetId]=1}else memberMap[subsetId]++}}if(updateHandler)sourceObject.addHandler(updateHandler,this)}if(array=delta.deleted)for(var i=0,sourceObject;sourceObject=array[i];i++){var sourceObjectId=sourceObject.eventObjectId;var list=sourceMap[sourceObjectId].list;delete sourceMap[sourceObjectId];for(var subsetId in list){var subset=list[subsetId];subset.event_datasetChanged({deleted:[sourceObject]});if(!--memberMap[subsetId]){delete memberMap[subsetId];deleted.push(subset)}}if(updateHandler)sourceObject.removeHandler(updateHandler,this)}Dataset.setAccumulateState(false);if(delta=getDelta(inserted,deleted))this.event_datasetChanged(delta)}};var Cloud=Class(AbstractDataset,SourceDatasetMixin,{className:namespace+".Cloud",subsetClass:AbstractDataset,rule:Function.getter($false),ruleEvents:oneFunctionProperty(CLOUD_SOURCEOBJECT_UPDATE,{update:true}),keyMap:null,map:$self,listen:{source:CLOUD_SOURCE_HANDLER},init:function(){if(!this.keyMap||this.keyMap instanceof KeyObjectMap==false)this.keyMap=new KeyObjectMap(extend({keyGetter:this.map,itemClass:this.subsetClass},this.keyMap));SourceDatasetMixin.init.call(this)},getSubset:function(data,autocreate){return this.keyMap.get(data,autocreate)},destroy:function(){SourceDatasetMixin.destroy.call(this);this.keyMap.destroy();this.keyMap=null}});module.exports={Merge:Merge,Subtract:Subtract,MapReduce:MapReduce,Subset:Subset,Split:Split,Slice:Slice,Cloud:Cloud}}],
// ../../../src/basis/timer.js
["basis.timer", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var Cleaner=basis.Cleaner;var getter=Function.getter;(function(){if(global.msSetImmediate&&global.msClearImmediate){global.setImmediate=global.msSetImmediate;global.clearImmediate=global.msClearImmediate}if(!global.setImmediate){var createScript=function(){return document.createElement("script")};var MESSAGE_NAME="setImmediate.basis";var addToQueue=function(taskId){global.nativeSetTimeout_(function(){runTask(taskId)},0)};var runTask=function(){var taskById={};var taskId=1;global.setImmediate=function(){taskById[++taskId]={fn:arguments[0],args:Array.from(arguments,1)};addToQueue(taskId);return taskId};global.clearImmediate=function(taskId){delete taskById[taskId]};return function(taskId){var task=taskById[taskId];if(task){try{if(typeof task.fn=="function")task.fn.apply(undefined,task.args);else{(global.execScript||function(fn){global["eval"].call(global,fn)})(String(task.fn))}}finally{delete taskById[taskId]}}}}();if(global.MessageChannel){var addToQueue=function(taskId){var channel=new global.MessageChannel;channel.port1.onmessage=function(){runTask(taskId)};channel.port2.postMessage("")}}else{var postMessageSupported=global.postMessage&&!global.importScripts;if(postMessageSupported){var oldOnMessage=global.onmessage;global.onmessage=function(){postMessageSupported=false};global.postMessage("","*");global.onmessage=oldOnMessage}if(postMessageSupported){var handleMessage=function(event){if(event&&event.source==global){var taskId=String(event.data).split(MESSAGE_NAME)[1];if(taskId)runTask(taskId)}};if(global.addEventListener)global.addEventListener("message",handleMessage,true);else global.attachEvent("onmessage",handleMessage);var addToQueue=function(taskId){postMessage(MESSAGE_NAME+taskId,"*")}}else{if(document&&"onreadystatechange"in createScript()){var addToQueue=function(taskId){var scriptEl=createScript();scriptEl.onreadystatechange=function(){runTask(taskId);scriptEl.onreadystatechange=null;scriptEl.parentNode.removeChild(scriptEl);scriptEl=null};document.documentElement.appendChild(scriptEl)}}}}}global.nativeSetTimeout_=global.setTimeout;global.nativeClearTimeout_=global.clearTimeout;global.setTimeout=function(fn,timeout){return isNaN(timeout)||timeout<=0?MESSAGE_NAME+global.setImmediate(fn):global.nativeSetTimeout_(fn,timeout)};global.clearTimeout=function(timer){var immediateId=String(timer).split(MESSAGE_NAME)[1];return immediateId?global.clearImmediate(immediateId):global.nativeClearTimeout_(timer)}})();var TimeEventManager=function(){var NEVER=2e12;var EVENT_TIME_GETTER=getter("eventTime");var eventStack=[];var map={};var fireTime=NEVER;var timer=null;var lockSetTimeout=false;function setNextTime(){if(lockSetTimeout)return;if(eventStack.length){var now=Date.now();var firstEventTime=Math.max(eventStack[0].eventTime,now);if(firstEventTime<fireTime){clearTimeout(timer);timer=setTimeout(fire,(fireTime=firstEventTime)-now)}}else{timer=clearTimeout(timer);fireTime=NEVER}}function add(object,event,eventTime){var objectId=object.eventObjectId;var eventMap=map[event];if(!eventMap)eventMap=map[event]={};var eventObject=eventMap[objectId];if(eventObject){if(isNaN(eventTime))return remove(object,event);if(eventObject.eventTime==eventTime)return;eventStack.remove(eventObject);eventObject.eventTime=eventTime}else{if(isNaN(eventTime))return;eventObject=eventMap[objectId]={eventName:event,object:object,eventTime:eventTime,callback:object[event]}}eventStack.splice(eventStack.binarySearchPos(eventTime,EVENT_TIME_GETTER),0,eventObject);setNextTime()}function remove(object,event){var objectId=object.eventObjectId;var eventObject=map[event]&&map[event][objectId];if(eventObject){eventStack.remove(eventObject);delete map[event][objectId];setNextTime()}}function fire(){var now=Date.now();var pos=eventStack.binarySearchPos(now+15,EVENT_TIME_GETTER);lockSetTimeout=true;eventStack.splice(0,pos).forEach(function(eventObject){delete map[eventObject.eventName][eventObject.object.eventObjectId];eventObject.callback.call(eventObject.object)});lockSetTimeout=false;fireTime=NEVER;setNextTime()}Cleaner.add({destroy:function(){lockSetTimeout=true;clearTimeout(timer);eventStack.length=0;map=null}});return{add:add,remove:remove}}();module.exports={TimeEventManager:TimeEventManager}}],
// ../../../src/basis/dom/event.js
["basis.dom.event", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var dom=basis.dom;var $null=Function.$null;var W3CSUPPORT=!!document.addEventListener;var EVENT_HOLDER="__basisEvents";var KEY={BACKSPACE:8,TAB:9,CTRL_ENTER:10,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};var MOUSE_LEFT={VALUE:1,BIT:1};var MOUSE_MIDDLE={VALUE:2,BIT:4};var MOUSE_RIGHT={VALUE:3,BIT:2};var BROWSER_EVENTS={mousewheel:["mousewheel","DOMMouseScroll"]};function browserEvents(eventName){return BROWSER_EVENTS[eventName]||[eventName]}var Handler=function(handler,thisObject){this.handler=handler;this.thisObject=thisObject};function wrap(event){return event||global.event}function getNode(object){return typeof object=="string"?dom.get(object):object}function sender(event){event=wrap(event);return event.target||event.srcElement}function cancelBubble(event){event=wrap(event);if(event.stopPropagation)event.stopPropagation();else event.cancelBubble=true}function cancelDefault(event){event=wrap(event);if(event.preventDefault)event.preventDefault();else event.returnValue=false}function kill(event,node){node=getNode(node);if(node)addHandler(node,event,kill);else{cancelDefault(event);cancelBubble(event)}}function key(event){event=wrap(event);return event.keyCode||event.which||0}function charCode(event){event=wrap(event);return event.charCode||event.keyCode||0}function mouseButton(event,button){event=wrap(event);if(typeof event.which=="number")return event.which==button.VALUE;else return event.button&button.BIT}function mouseX(event){event=wrap(event);if(event.changedTouches)return event.changedTouches[0].pageX;else if("pageX"in event)return event.pageX;else return event.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)}function mouseY(event){event=wrap(event);if(event.changedTouches)return event.changedTouches[0].pageY;else if("pageY"in event)return event.pageY;else return event.clientY+(document.documentElement.scrollTop||document.body.scrollTop)}function wheelDelta(event){event=wrap(event);if("wheelDelta"in event)return event.wheelDelta/120;else if(event.type=="DOMMouseScroll")return-event.detail/3;else return 0}var globalHandlers={};var captureHandlers={};var noCaptureSheme=!document.addEventListener;function observeGlobalEvents(event){var handlers=Array.from(globalHandlers[event.type]);var captureHandler=captureHandlers[event.type];if(captureHandler){captureHandler.handler.call(captureHandler.thisObject,event);kill(event);return}if(handlers){for(var i=handlers.length;i-->0;){var handlerObject=handlers[i];handlerObject.handler.call(handlerObject.thisObject,event)}}}function captureEvent(eventType,handler,thisObject){if(captureHandlers[eventType])releaseEvent(eventType);addGlobalHandler(eventType,handler,thisObject);captureHandlers[eventType]=globalHandlers[eventType][globalHandlers[eventType].length-1]}function releaseEvent(eventType){var handlerObject=captureHandlers[eventType];if(handlerObject){removeGlobalHandler(eventType,handlerObject.handler,handlerObject.thisObject);delete captureHandlers[eventType]}}function addGlobalHandler(eventType,handler,thisObject){var handlers=globalHandlers[eventType];if(handlers){for(var i=handlers.length;i-->0;){var handlerObject=handlers[i];if(handlerObject.handler===handler&&handlerObject.thisObject===thisObject)return}}else{if(noCaptureSheme)addHandler(document,eventType,$null);else document.addEventListener(eventType,observeGlobalEvents,true);handlers=globalHandlers[eventType]=new Array}handlers.push({handler:handler,thisObject:thisObject})}function removeGlobalHandler(eventType,handler,thisObject){var handlers=globalHandlers[eventType];if(handlers){for(var i=0,item;item=handlers[i];i++){if(item.handler===handler&&item.thisObject===thisObject){handlers.splice(i,1);if(!handlers.length){delete globalHandlers[eventType];if(noCaptureSheme)removeHandler(document,eventType,$null);else document.removeEventListener(eventType,observeGlobalEvents,true)}return}}}}function addHandler(node,eventType,handler,thisObject){node=getNode(node);if(!node)throw"basis.event.addHandler: can't attach event listener to undefined";if(typeof handler!="function")throw"basis.event.addHandler: handler is not a function";if(!node[EVENT_HOLDER])node[EVENT_HOLDER]={};var handlerObject={handler:handler,thisObject:thisObject};var handlers=node[EVENT_HOLDER];var eventTypeHandlers=handlers[eventType];if(!eventTypeHandlers){eventTypeHandlers=handlers[eventType]=[handlerObject];eventTypeHandlers.fireEvent=function(event){event=wrap(event);if(noCaptureSheme&&event&&globalHandlers[eventType]){if(typeof event.returnValue=="undefined"){observeGlobalEvents(event);if(event.cancelBubble===true)return;if(typeof event.returnValue=="undefined")event.returnValue=true}}for(var i=0,item;item=eventTypeHandlers[i++];)item.handler.call(item.thisObject,event)};if(node.addEventListener)node.addEventListener(eventType,eventTypeHandlers.fireEvent,false);else node.attachEvent("on"+eventType,eventTypeHandlers.fireEvent)}else{for(var i=0,item;item=eventTypeHandlers[i];i++)if(item.handler===handler&&item.thisObject===thisObject)return;eventTypeHandlers.push(handlerObject)}}function addHandlers(node,handlers,thisObject){node=getNode(node);for(var eventType in handlers)addHandler(node,eventType,handlers[eventType],thisObject)}function removeHandler(node,eventType,handler,thisObject){node=getNode(node);var handlers=node[EVENT_HOLDER];if(handlers){var eventTypeHandlers=handlers[eventType];if(eventTypeHandlers){for(var i=0,item;item=eventTypeHandlers[i];i++){if(item.handler===handler&&item.thisObject===thisObject){eventTypeHandlers.splice(i,1);if(!eventTypeHandlers.length)clearHandlers(node,eventType);return}}}}}function clearHandlers(node,eventType){node=getNode(node);var handlers=node[EVENT_HOLDER];if(handlers){if(typeof eventType!="string"){for(eventType in handlers)clearHandlers(node,eventType)}else{var eventTypeHandlers=handlers[eventType];if(eventTypeHandlers){if(node.removeEventListener)node.removeEventListener(eventType,eventTypeHandlers.fireEvent,false);else node.detachEvent("on"+eventType,eventTypeHandlers.fireEvent);delete handlers[eventType]}}}}function fireEvent(node,eventType,event){node=getNode(node);var handlers=node[EVENT_HOLDER];if(handlers&&handlers[eventType])handlers[eventType].fireEvent(event)}var onLoad=basis.ready;function onUnload(handler,thisObject){addHandler(global,"unload",handler,thisObject)}var tagNameEventMap={};function getEventInfo(eventName,tagName){if(!tagName)tagName="div";var id=tagName+"-"+eventName;if(tagNameEventMap[id])return tagNameEventMap[id];else{var supported=false;var bubble=false;if(!W3CSUPPORT){var onevent="on"+eventName;var target=dom.createElement(tagName);var host=dom.createElement("div",target);host[onevent]=function(){bubble=true};try{target.fireEvent(onevent);supported=true}catch(e){}}return tagNameEventMap[id]={supported:supported,bubble:bubble}}}this.setWrapper(wrap);module.exports={W3CSUPPORT:W3CSUPPORT,KEY:KEY,MOUSE_LEFT:MOUSE_LEFT,MOUSE_RIGHT:MOUSE_RIGHT,MOUSE_MIDDLE:MOUSE_MIDDLE,browserEvents:browserEvents,Handler:Handler,sender:sender,cancelBubble:cancelBubble,cancelDefault:cancelDefault,kill:kill,key:key,charCode:charCode,mouseButton:mouseButton,mouseX:mouseX,mouseY:mouseY,wheelDelta:wheelDelta,addGlobalHandler:addGlobalHandler,removeGlobalHandler:removeGlobalHandler,captureEvent:captureEvent,releaseEvent:releaseEvent,addHandler:addHandler,addHandlers:addHandlers,removeHandler:removeHandler,clearHandlers:clearHandlers,fireEvent:fireEvent,onLoad:onLoad,onUnload:onUnload,getEventInfo:getEventInfo}}],
// ../../../src/basis/cssom.js
["basis.cssom", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var path=basis.path;var dom=basis.dom;var event=basis.dom.event;var Class=basis.Class;var Cleaner=basis.Cleaner;var CLASSLIST_SUPPORTED=global.DOMTokenList&&document&&document.documentElement.classList instanceof global.DOMTokenList;var IMPORTANT_REGEXP=/\s*!important/i;var IMPORTANT=String("important");var GENERIC_RULE_SEED=1;var cssStyleSheets={};var SET_STYLE_EXCEPTION_BUG=function(){var element=dom.createElement();try{element.style.width="badvalue"}catch(e){return true}return false}();function createRule(selector,styleSheet){return getStyleSheet(styleSheet,true).createRule(selector)}function isPropertyImportant(style,property){if(style.getPropertyPriority)return style.getPropertyPriority(property)==IMPORTANT;else return false}function uniqueRule(element){var token="genericRule-"+GENERIC_RULE_SEED++;if(element)classList(element).add(token);var result=createRule("."+token);result.token=token;return result}function StyleSheet_insertRule(rule,index){var m=rule.match(/^([^{]+)\{(.*)\}\s*$/);if(m){var selectors=m[1].trim().split(/\s*,\s*/);for(var i=0;i<selectors.length;i++)this.addRule(selectors[i],m[2]||null,index++);return index-1}}function StyleSheet_makeCompatible(style){try{if(!style.cssRules)style.cssRules=style.rules}catch(e){}if(!style.insertRule)style.insertRule=StyleSheet_insertRule;if(!style.deleteRule)style.deleteRule=style.removeRule;return style}function addStyleSheet(url,title){var element=dom.createElement(!url?'STYLE[type="text/css"]':'LINK[type="text/css"][rel="{alt}stylesheet"][href={url}]'.format({alt:title?"alternate ":"",url:url.quote('"')}));dom.tag(null,"HEAD")[0].appendChild(element);return StyleSheet_makeCompatible(element.sheet||element.styleSheet)}var basisId=1;function getStyleSheet(id,createIfNotExists){if(!id)id="DefaultGenericStyleSheet";if(!cssStyleSheets[id])if(createIfNotExists)cssStyleSheets[id]=new StyleSheet(addStyleSheet());return cssStyleSheets[id]}var styleMapping={};var testElement=dom.createElement("DIV");function createStyleMapping(property,names,regSupport,getters){getters=getters||{};names=names.qw();for(var i=0,name;name=names[i];i++){if(typeof testElement.style[name]!="undefined"){if(regSupport)basis.platformFeature["css-"+property]=name;styleMapping[property]={key:name,getter:getters[name]};return}}}createStyleMapping("opacity","opacity MozOpacity KhtmlOpacity filter",true,{fitler:function(value){return"alpha(opacity:"+parseInt(value*100)+")"}});createStyleMapping("border-radius","borderRadius MozBorderRadius WebkitBorderRadius",true);createStyleMapping("float","cssFloat styleFloat");function getStylePropertyMapping(key,value){var mapping=styleMapping[key];if(key=mapping?mapping.key:key.replace(/^-ms-/,"ms-").camelize())return{key:key,value:mapping&&mapping.getter?mapping.getter(value):value}}function setStyleProperty(node,property,value){var mapping=getStylePropertyMapping(property,value);if(!mapping)return;var key=mapping.key;var imp=!!IMPORTANT_REGEXP.test(value);var style=node.style;if(imp||isPropertyImportant(style,property)){value=value.replace(IMPORTANT_REGEXP,"");if(style.setProperty){if(!imp)style.removeProperty(key);style.setProperty(key,mapping.value,imp?IMPORTANT:"")}else{var newValue=key+": "+mapping.value+(imp?" !"+IMPORTANT:"")+";";var rxText=style[key]?key+"\\s*:\\s*"+style[key]+"(\\s*!"+IMPORTANT+")?\\s*;?":"^";try{style.cssText=style.cssText.replace(new RegExp(rxText,"i"),newValue)}catch(e){}}}else{if(SET_STYLE_EXCEPTION_BUG){try{node.style[mapping.key]=mapping.value}catch(e){}}else node.style[mapping.key]=mapping.value;return node.style[mapping.key]}}function setStyle(node,style){for(var key in style)setStyleProperty(node,key,style[key]);return node}function display(node,display){return setStyleProperty(node,"display",typeof display=="string"?display:display?"":"none")}function show(element){return display(element,1)}function hide(element){return display(element)}function visibility(node,visible){return setStyleProperty(node,"visibility",visible?"":"hidden")}function visible(element){return visibility(element,1)}function invisible(element){return visibility(element)}var StyleSheet=Class(null,{className:namespace+".StyleSheet",styleSheet:null,rules:null,init:function(styleSheet){this.styleSheet=styleSheet;this.rules=[]},createRule:function(selector){var styleSheet=this.styleSheet;var index=this.rules.length;var newIndex=styleSheet.insertRule(selector+"{}",index);var cssRules=Array.from(styleSheet.cssRules,index);var ruleWrapper=cssRules[1]?new RuleSet(cssRules,this):new Rule(cssRules[0],this);this.rules.push.apply(this.rules,ruleWrapper.rules||[ruleWrapper]);return ruleWrapper},deleteRule:function(rule){if(rule instanceof RuleSet)rule.rules.forEach(this.deleteRule,this);else{var ruleIndex=this.rules.indexOf(rule);if(ruleIndex!=-1){this.rules.splice(ruleIndex,1);this.styleSheet.deleteRule(ruleIndex)}}rule.owner=null;rule.destroy()},destroy:function(){this.rules.forEach(function(item){item.destroy()});this.styleSheet=null;this.rules=null}});var Rule=Class(null,{className:namespace+".Rule",rule:null,selector:"",init:function(rule,owner){this.owner=owner;this.rule=rule;this.selector=rule.selectorText},setProperty:function(property,value){setStyleProperty(this.rule,property,value)},setStyle:function(style){Object.iterate(style,this.setProperty,this)},clear:function(){this.rule.style.cssText=""},destroy:function(){if(this.owner)this.owner.deleteRule(this);this.owner=null;this.rule=null}});var RuleSet=Class(null,{className:namespace+".RuleSet",rules:null,init:function(rules,owner){this.owner=owner;this.rules=rules.map(function(){return new Rule(rule,this)},this)},createRule:function(selector){var rule=this.owner.createRule(selector);this.rules.push(rule);rule.owner=this;return rule},deleteRule:function(rule){var ruleIndex=this.rules.indexOf(rule);if(ruleIndex!=-1){this.rules.splice(ruleIndex,1);this.owner.deleteRule(rule)}},destroy:function(){if(this.owner)this.owner.deleteRule(this);this.owner=null;this.rules=null}});["setProperty","setStyle","clear"].forEach(function(method){RuleSet.prototype[method]=function(){for(var rule,i=0;rule=this.rules[i];i++)rule[method].apply(rule,arguments)}});var classList;var tokenRxCache={};function tokenRegExp(token){return tokenRxCache[token]||(tokenRxCache[token]=new RegExp("\\s*\\b"+token+"\\b"))}var ClassList=Class(null,{className:namespace+".ClassList",init:function(element){this.element=element},toString:function(){return this.element.className},set:function(tokenList){this.clear();tokenList.qw().forEach(this.add,this)},replace:function(searchFor,replaceFor,prefix){prefix=prefix||"";if(typeof searchFor!="undefined")this.remove(prefix+searchFor);if(typeof replaceFor!="undefined")this.add(prefix+replaceFor)},bool:function(token,exists){if(exists)this.add(token);else this.remove(token)},clear:function(){this.element.className=""},contains:function(token){return!!this.element.className.match(tokenRegExp(token))},item:function(index){return this.element.className.qw()[index]},add:function(token){if(!this.element.className.match(tokenRegExp(token)))this.element.className+=" "+token},remove:function(token){var className=this.element.className;var newClassName=className.replace(tokenRegExp(token),"");if(newClassName!=className)this.element.className=newClassName},toggle:function(token){var exists=this.contains(token);if(exists)this.remove(token);else this.add(token);return!exists}});var prefixRxCache={};function prefixRegExp(prefix,global){var key=(global?"g":"s")+prefix;return prefixRxCache[key]||(prefixRxCache[key]=new RegExp((global?"":"\\s*")+"\\b"+prefix+"\\S*\\b"))}var ClassListNS=Class(null,{className:namespace+".ClassListNS",delim:"-",init:function(ns,classList){this.classList=classList;this.prefix=ns+this.delim},add:function(value){this.classList.add(this.prefix+value)},remove:function(value){this.classList.remove(this.prefix+value)},items:function(){var classList=this.classList.toString();if(classList)return classList.toString().match(prefixRegExp(this.prefix,true))},set:function(value){var items=this.items();var token=typeof value!="undefined"?this.prefix+value:"";var classList=this.classList;if(items){if(items.length==1){if(items[0]===token)return;classList.remove(items[0])}else this.clear()}if(token)classList.add(token)},clear:function(){this.items().forEach(this.classList.remove,this.classList)}});if(CLASSLIST_SUPPORTED){var proto=ClassList.prototype;Object.extend(global.DOMTokenList.prototype,{set:proto.set,replace:proto.replace,bool:proto.bool,clear:function(){for(var i=this.length;i-->0;)this.remove(this[i])},setPrefixToken:proto.setPrefixToken});classList=function(element){return(typeof element=="string"?dom.get(element):element).classList}}else{classList=function(element){return new ClassList(typeof element=="string"?dom.get(element):element)}}var classListProxy=function(element,ns){return ns?new ClassListNS(ns,classList(element)):classList(element)};basis.ready(function(){classList(document.body).bool("opacity-not-support",!basis.platformFeature["css-opacity"])});var dynamicResources={};var cleanupDom=true;var STYLE_APPEND_BUGGY=!function(tagName){try{return dom.createElement("style","")}catch(e){}}();var pathResolver=function(){var baseEl=dom.createElement("base");var documentHead=document.head;return{setBase:function(baseURI){baseEl.setAttribute("href",path.resolve(baseURI));dom.insert(documentHead,baseEl,0)},restoreBase:function(){baseEl.setAttribute("href",location);dom.remove(baseEl)}}}();var CssResource=Class(null,{inUse:0,cssText:"",element:null,textNode:null,init:function(url){this.url=path.resolve(url);this.baseURI=path.dirname(url)+"/";dynamicResources[url]=this},updateCssText:function(cssText){if(this.cssText!=cssText){this.cssText=cssText;if(this.inUse)this.syncCssText()}},syncCssText:function(){pathResolver.setBase(this.baseURI);if(this.textNode)this.textNode.nodeValue=this.cssText;else this.element.styleSheet.cssText=this.cssText;pathResolver.restoreBase()},startUse:function(){if(!this.inUse){this.inUse=1;if(!this.resource){var resource=basis.resource(this.url);this.resource=resource;this.cssText=this.resource.source}if(!this.element){this.element=dom.createElement('style[src="'+path.relative(this.url)+'"]');if(!STYLE_APPEND_BUGGY)this.textNode=this.element.appendChild(dom.createText(""))}dom.appendHead(this.element);this.syncCssText()}else this.inUse+=1},stopUse:function(){if(!this.inUse)return;this.inUse-=1;if(!this.inUse)dom.remove(this.element)},destroy:function(){if(this.element){if(cleanupDom)dom.remove(this.element);this.element=null;this.textNode=null}if(this.resource){this.resource=null;this.cssText=null}}});basis.resource.extensions[".css"]=function(content,url){var resource=dynamicResources[url];if(!resource)resource=new CssResource(url);else resource.updateCssText(content);return resource};basis.resource.extensions[".css"].updatable=true;Cleaner.add({destroy:function(){cleanupDom=false;for(var url in dynamicResources)dynamicResources[url].destroy();dynamicResources=null}});module.exports={setStyleProperty:setStyleProperty,setStyle:setStyle,classList:classListProxy,uniqueRule:uniqueRule,createRule:createRule,getStyleSheet:getStyleSheet,addStyleSheet:addStyleSheet,StyleSheet:StyleSheet,Rule:Rule,RuleSet:RuleSet,display:display,show:show,hide:hide,visibility:visibility,visible:visible,invisible:invisible};["em","ex","px","%"].forEach(function(unit){module.exports[unit=="%"?"percent":unit]=function(value){return value==0||isNaN(value)?"0":value+unit}})}],
// ../../../src/basis/data/property.js
["basis.data.property", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var DOM=basis.dom;var Cleaner=basis.Cleaner;var getter=Function.getter;var classList=basis.cssom.classList;var TimeEventManager=basis.timer.TimeEventManager;var EventObject=basis.event.EventObject;var createEvent=basis.event.create;var nsData=basis.data;var DataObject=nsData.DataObject;var STATE=nsData.STATE;var EXCEPTION_DATAOBJECT_REQUIRED=namespace+": Instance of DataObject required";var EXCEPTION_BAD_OBJECT_LINK=namespace+": Link to undefined object ignored";var AbstractProperty=Class(DataObject,{className:namespace+".AbstractProperty",event_change:createEvent("change"),locked:false,lockValue_:null,extendConstructor_:false,updateCount:0,init:function(initValue,handlers,proxy){DataObject.prototype.init.call(this,{});if(handlers)this.addHandler(handlers);this.proxy=typeof proxy=="function"?proxy:Function.$self;this.initValue=this.value=this.proxy(initValue)},set:function(data,forceEvent){var oldValue=this.value;var newValue=this.proxy?this.proxy(data):newValue;var updated=false;if(newValue!==oldValue){this.value=newValue;updated=true;this.updateCount+=1}if(!this.locked&&(updated||forceEvent))this.event_change(newValue,oldValue);return updated},lock:function(){if(!this.locked){this.lockValue_=this.value;this.locked=true}},unlock:function(){if(this.locked){this.locked=false;if(this.value!==this.lockValue_)this.event_change(this.value,this.lockValue_)}},update:function(newValue,forceEvent){return this.set(newValue,forceEvent)},reset:function(){this.set(this.initValue)},destroy:function(){DataObject.prototype.destroy.call(this);delete this.initValue;delete this.proxy;delete this.lockValue_;delete this.value}});var PropertyObjectDestroyAction={destroy:function(object){this.removeLink(object)}};var DOM_INSERT_HANDLER=function(value){DOM.insert(DOM.clear(this),value)};function getFieldHandler(object){if(object instanceof Property)return object.set;var nodeType=object.nodeType;if(isNaN(nodeType)==false)if(nodeType==1)return DOM_INSERT_HANDLER;else return"nodeValue"}var Property=Class(AbstractProperty,{className:namespace+".Property",links_:null,bindingBridge:{attach:function(property,handler,context){return property.addLink(context,handler)},detach:function(property,handler,context){return property.removeLink(context,handler)},get:function(property){return property.value}},event_change:function(value,oldValue){AbstractProperty.prototype.event_change.call(this,value,oldValue);if(!this.links_.length||Cleaner.globalDestroy)return;for(var i=0,link;link=this.links_[i++];)this.power_(link,oldValue)},init:function(initValue,handlers,proxy){AbstractProperty.prototype.init.call(this,initValue,handlers,proxy);this.links_=new Array;Cleaner.add(this)},addLink:function(object,field,format){if(field==null){if(typeof object!="object"&&object instanceof Object==false)throw new Error(EXCEPTION_BAD_OBJECT_LINK);field=getFieldHandler(object)}if(typeof format!="function")format=getter(Function.$self,format);var link={object:object,format:format,field:field,isEventObject:object instanceof EventObject};this.links_.push(link);if(link.isEventObject)object.addHandler(PropertyObjectDestroyAction,this);this.power_(link);return object},addLinkShortcut:function(element,shortcutName,format){return this.addLink(element,Property.shortcut[shortcutName],format)},removeLink:function(object,field){if(this.links_==null)return;var deleteAll=arguments.length<2;if(!deleteAll&&field==null)field=getFieldHandler(object);var k=0;for(var i=0,link;link=this.links_[i];i++){if(link.object===object&&(deleteAll||field==link.field)){if(link.isEventObject)link.object.removeHandler(PropertyObjectDestroyAction,this)}else this.links_[k++]=link}this.links_.length=k},clear:function(){for(var i=0,link;link=this.links_[i];i++)if(link.isEventObject)link.object.removeHandler(PropertyObjectDestroyAction,this);this.links_.clear()},power_:function(link,oldValue){var field=link.field;if(field!=null){var value=link.format(this.value);var object=link.object;if(typeof field=="function")field.call(object,value,arguments.length<2?value:link.format(oldValue));else object[field]=value}},destroy:function(){this.clear();AbstractProperty.prototype.destroy.call(this);this.links_=null;Cleaner.remove(this)}});Property.shortcut={className:function(newValue,oldValue){classList(this).replace(oldValue,newValue)},show:function(newValue){cssom.display(this,!!newValue)},hide:function(newValue){cssom.display(this,!newValue)},disable:function(newValue){this.disabled=!!newValue},enable:function(newValue){this.disabled=!newValue}};var DataObjectSetStatePriority=STATE.PRIORITY;var DataObjectSetHandlers={stateChanged:function(){this.fire(false,true)},update:function(){this.fire(true)},change:function(){this.fire(true)},destroy:function(object){this.remove(object)}};var DataObjectSet=Class(Property,{className:namespace+".DataObjectSet",statePriority:DataObjectSetStatePriority,calculateValue:function(){return this.value+1},objects:null,timer_:null,valueChanged_:false,stateChanged_:true,state:STATE.UNDEFINED,extendConstructor_:true,init:function(){var handlers=this.handler;this.handler=null;Property.prototype.init.call(this,this.value||0,handlers,this.proxy);var objects=this.objects;this.objects=[];if(objects&&Array.isArray(objects)){this.lock();this.add.apply(this,objects);this.unlock()}this.valueChanged_=this.stateChanged_=!!this.calculateOnInit;this.update()},add:function(){for(var i=0,len=arguments.length;i<len;i++){var object=arguments[i];if(object instanceof DataObject){if(this.objects.add(object))object.addHandler(DataObjectSetHandlers,this)}else throw new Error(EXCEPTION_DATAOBJECT_REQUIRED)}this.fire(true,true)},remove:function(object){if(this.objects.remove(object))object.removeHandler(DataObjectSetHandlers,this);this.fire(true,true)},clear:function(){for(var i=0,object;object=this.objects[i];i++)object.removeHandler(DataObjectSetHandlers,this);this.objects.clear();this.fire(true,true)},fire:function(valueChanged,stateChanged){if(!this.locked){this.valueChanged_=this.valueChanged_||!!valueChanged;this.stateChanged_=this.stateChanged_||!!stateChanged;if(!this.timer_&&(this.valueChanged_||this.stateChanged_)){this.timer_=true;TimeEventManager.add(this,"update",Date.now())}}},lock:function(){this.locked=true},unlock:function(){this.locked=false},update:function(){delete this.timer_;TimeEventManager.remove(this,"update");if(!Cleaner.globalDestroy){if(this.valueChanged_)this.set(this.calculateValue());if(this.stateChanged_){var stateMap={};var len=this.objects.length;if(!len)this.setState(STATE.UNDEFINED);else{var maxWeight=-2;var curObject;for(var i=0;i<len;i++){var object=this.objects[i];var weight=this.statePriority.indexOf(String(object.state));if(weight>maxWeight){curObject=object;maxWeight=weight}}if(curObject)this.setState(curObject.state,curObject.state.data)}}}this.valueChanged_=false;this.stateChanged_=false},destroy:function(){this.lock();this.clear();TimeEventManager.remove(this,"update");Property.prototype.destroy.call(this)}});module.exports={DataObjectSet:DataObjectSet,AbstractProperty:AbstractProperty,Property:Property,PropertySet:DataObjectSet}}],
// ../../../src/basis/data/index.js
["basis.data.index", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var nsData=basis.data;var DataObject=nsData.DataObject;var KeyObjectMap=nsData.KeyObjectMap;var AbstractDataset=nsData.AbstractDataset;var Property=basis.data.property.Property;var MapReduce=basis.data.dataset.MapReduce;function binarySearchPos(array,value){if(!array.length)return 0;var pos;var cmpValue;var l=0;var r=array.length-1;do{pos=l+r>>1;cmpValue=array[pos]||0;if(value<cmpValue)r=pos-1;else if(value>cmpValue)l=pos+1;else return value==cmpValue?pos:0}while(l<=r);return pos+(cmpValue<value)}var Index=Class(Property,{className:namespace+".Index",autoDestroy:true,indexCache_:null,valueGetter:Function.$null,updateEvents:{},init:function(){this.indexCache_={};Property.prototype.init.call(this,0)},add_:function(value){},remove_:function(value){},update_:function(newValue,oldValue){},destroy:function(){Property.prototype.destroy.call(this);this.indexCache_=null}});var Sum=Class(Index,{className:namespace+".Sum",add_:function(value){this.value+=value},remove_:function(value){this.value-=value},update_:function(newValue,oldValue){this.set(this.value-oldValue+newValue)}});var Count=Class(Index,{className:namespace+".Count",valueGetter:Function.$true,add_:function(value){this.value+=!!value},remove_:function(value){this.value-=!!value},update_:function(newValue,oldValue){this.set(this.value-!!oldValue+!!newValue)}});var Avg=Class(Index,{className:namespace+".Avg",sum_:0,count_:0,add_:function(value){this.sum_+=value;this.count_+=1;this.value=this.sum_/this.count_},remove_:function(value){this.sum_-=value;this.count_-=1;this.value=this.count_?this.sum_/this.count_:0},update_:function(newValue,oldValue){this.sum_+=newValue-oldValue;this.set(this.sum_/this.count_)}});var VectorIndex=Class(Index,{className:namespace+".VectorIndex",itemGetter:Function.$null,vector_:null,init:function(){this.vector_=[];Index.prototype.init.call(this)},add_:function(value){this.vector_.splice(binarySearchPos(this.vector_,value),0,value);this.value=this.vectorGetter(this.vector_)},remove_:function(value){this.vector_.splice(binarySearchPos(this.vector_,value),1);this.value=this.vectorGetter(this.vector_)},update_:function(newValue,oldValue){this.vector_.splice(binarySearchPos(this.vector_,oldValue),1);this.vector_.splice(binarySearchPos(this.vector_,newValue),0,newValue);this.set(this.vectorGetter(this.vector_))},destroy:function(){Index.prototype.destroy.call(this);this.vector_=null}});var Min=Class(VectorIndex,{className:namespace+".Min",vectorGetter:function(vector){return vector[0]}});var Max=Class(VectorIndex,{className:namespace+".Max",vectorGetter:function(vector){return vector[vector.length-1]}});var indexConstructors_={};var DATASET_INDEX_HANDLER={destroy:function(object){this.deleteIndex(object)}};function IndexConstructor(BaseClass,getter,events){if(!Class.isClass(BaseClass)||!BaseClass.isSubclassOf(Index))throw"Wrong class for index constructor";getter=Function.getter(getter);events=events||"update";if(typeof events!="string")throw"Events must be a event names space separated string";events=events.qw().sort();var indexId=[BaseClass.basisClassId_,getter.basisGetterId_,events].join("_");var indexConstructor=indexConstructors_[indexId];if(indexConstructor)return indexConstructor.owner;var events_={};for(var i=0;i<events.length;i++)events_[events[i]]=true;indexConstructors_[indexId]={owner:this,indexClass:BaseClass.subclass({indexId:indexId,updateEvents:events_,valueGetter:getter})};this.indexId=indexId}var createIndexConstructor=function(IndexClass){return function(getter,events){return new IndexConstructor(IndexClass,getter,events)}};var count=createIndexConstructor(Count);var sum=createIndexConstructor(Sum);var avg=createIndexConstructor(Avg);var min=createIndexConstructor(Min);var max=createIndexConstructor(Max);function applyIndexDelta(index,inserted,deleted){var indexCache=index.indexCache_;var objectId;index.lock();if(inserted)for(var i=0,object;object=inserted[i++];){var newValue=index.valueGetter(object);indexCache[object.eventObjectId]=newValue;index.add_(newValue)}if(deleted)for(var i=0,object;object=deleted[i++];){objectId=object.eventObjectId;index.remove_(indexCache[objectId]);delete indexCache[objectId]}index.unlock()}var ITEM_INDEX_HANDLER={"*":function(event){var oldValue;var newValue;var index;var eventType=event.type;var object=event.sender;var objectId=object.eventObjectId;for(var indexId in this.indexes__){index=this.indexes__[indexId];if(index.updateEvents[eventType]){oldValue=index.indexCache_[objectId];newValue=index.valueGetter(object);if(newValue!==oldValue){index.update_(newValue,oldValue);index.indexCache_[objectId]=newValue}}}}};var DATASET_WITH_INDEX_HANDLER={datasetChanged:function(object,delta){var array;if(array=delta.inserted)for(var i=array.length;i-->0;)array[i].addHandler(ITEM_INDEX_HANDLER,this);if(array=delta.deleted)for(var i=array.length;i-->0;)array[i].removeHandler(ITEM_INDEX_HANDLER,this);for(var indexId in this.indexes__)applyIndexDelta(this.indexes__[indexId],delta.inserted,delta.deleted)},destroy:function(){var indexes=Object.values(this.indexes__);for(var indexId in indexes)this.deleteIndex(indexes[indexId])}};AbstractDataset.extend({indexes__:null,getIndex:function(indexConstructor){if(indexConstructor instanceof IndexConstructor==false){return}if(!this.indexes__){this.indexes__={};this.addHandler(DATASET_WITH_INDEX_HANDLER);DATASET_WITH_INDEX_HANDLER.datasetChanged.call(this,this,{inserted:this.getItems()})}var indexId=indexConstructor.indexId;var index=this.indexes__[indexId];if(!index){indexConstructor=indexConstructors_[indexId];if(!indexConstructor)throw"Wrong index constructor";index=new indexConstructor.indexClass;index.addHandler(DATASET_INDEX_HANDLER,this);this.indexes__[indexId]=index;applyIndexDelta(index,this.getItems())}return index},deleteIndex:function(index){if(this.indexes__&&this.indexes__[index.indexId]){delete this.indexes__[index.indexId];index.removeHandler(DATASET_INDEX_HANDLER,this);for(var key in this.indexes__)return;this.removeHandler(DATASET_WITH_INDEX_HANDLER);this.indexes__=null}}});var IndexMap=Class(MapReduce,{className:namespace+".IndexMap",calcs:null,indexes:null,indexes_:null,timer_:undefined,indexUpdated:null,memberSourceMap:null,keyMap:null,map:function(item){return this.keyMap.get(item,true)},addMemberRef:function(member,sourceObject){this.memberSourceMap[member.eventObjectId]=sourceObject.eventObjectId;if(this.listen.member)member.addHandler(this.listen.member,this);this.sourceMap_[sourceObject.eventObjectId].updated=true;if(member.subscriberCount>0)this.calcMember(member)},removeMemberRef:function(member,sourceObject){delete this.memberSourceMap[member.eventObjectId];if(this.listen.member)member.removeHandler(this.listen.member,this)},event_sourceChanged:function(oldSource){MapReduce.prototype.event_sourceChanged.call(this,oldSource);var index;for(var indexName in this.indexes_){index=this.indexes_[indexName];if(oldSource){this.deleteIndex(indexName);oldSource.deleteIndex(this.indexes[indexName])}if(this.source)this.addIndex(indexName,this.source.getIndex(index))}},listen:{index:{change:function(sender,value){var indexMap=this.indexMap;indexMap.indexValues[this.key]=value;indexMap.indexUpdated=true;indexMap.recalcRequest()}},member:{subscribersChanged:function(object,oldCount){if(object.subscriberCount>0&&oldCount==0)this.calcMember(object)}}},ruleEvents:Class.oneFunctionProperty(function(sourceObject,delta){MapReduce.prototype.ruleEvents.update.call(this,sourceObject,delta);this.sourceMap_[sourceObject.eventObjectId].updated=true;this.recalcRequest()},{update:true}),init:function(){this.recalc=this.recalc.bind(this);this.indexUpdated=false;this.indexesBind_={};this.memberSourceMap={};var indexes=this.indexes;this.indexes={};this.indexes_={};this.calcs=this.calcs||{};this.indexValues={};if(!this.keyMap||this.keyMap instanceof KeyObjectMap==false)this.keyMap=new KeyObjectMap(Object.complete({create:function(key,config){return new this.itemClass(config)}},this.keyMap));MapReduce.prototype.init.call(this);Object.iterate(indexes,this.addIndex,this)},addIndex:function(key,index){if(!this.indexes[key]){if(index instanceof IndexConstructor){if(!this.indexes_[key]){this.indexes_[key]=index;index=this.source&&this.source.getIndex(index)}else{return}}if(index instanceof Index){this.indexValues[key]=index.value;this.indexes[key]=index;this.indexesBind_[key]={key:key,indexMap:this};var listenHandler=this.listen.index;if(listenHandler){index.addHandler(listenHandler,this.indexesBind_[key]);if(listenHandler.change)listenHandler.change.call(this.indexesBind_[key],index,index.value)}}else{return}}},removeIndex:function(key){if(this.indexes_[key]||this.indexes[key]){if(this.indexes[key]&&this.listen.index)this.indexes[key].removeHandler(this.listen.index,this.indexesBind_[key]);delete this.indexValues[key];delete this.indexesBind_[key];delete this.indexes[key];delete this.indexes_[key]}},addCalc:function(name,calc){this.calcs[name]=calc;this.recalcRequest()},removeCalc:function(name){delete this.calcs[name]},lock:function(){for(var indexId in this.indexes)this.indexes[indexId].lock()},unlock:function(){for(var indexId in this.indexes)this.indexes[indexId].unlock()},recalcRequest:function(){if(!this.timer_)this.timer_=setTimeout(this.recalc,0)},recalc:function(){for(var idx in this.item_)this.calcMember(this.item_[idx]);this.indexUpdated=false;this.timer_=clearTimeout(this.timer_)},calcMember:function(member){var sourceObject=this.sourceMap_[this.memberSourceMap[member.eventObjectId]];if(member.subscriberCount&&(sourceObject.updated||this.indexUpdated)){sourceObject.updated=false;var data={};var newValue;var oldValue;var update;for(var calcName in this.calcs){newValue=this.calcs[calcName](sourceObject.sourceObject.data,this.indexValues,sourceObject.sourceObject);oldValue=member.data[calcName];if(member.data[calcName]!==newValue&&(typeof newValue!="number"||typeof oldValue!="number"||!isNaN(newValue)||!isNaN(oldValue))){data[calcName]=newValue;update=true}}if(update)member.update(data)}},getMember:function(sourceObject){return this.keyMap.get(sourceObject,true)},destroy:function(){this.timer_=clearTimeout(this.timer_);this.calcs=null;this.indexUpdated=null;this.memberSourceMap=null;this.indexesBind_=null;this.keyMap.destroy();this.keyMap=null;for(var indexName in this.indexes)this.removeIndex(indexName);MapReduce.prototype.destroy.call(this)}});module.exports={IndexConstructor:IndexConstructor,createIndexConstructor:createIndexConstructor,Index:Index,Count:Count,Sum:Sum,Avg:Avg,VectorIndex:VectorIndex,Min:Min,Max:Max,count:count,sum:sum,avg:avg,max:max,min:min,IndexMap:IndexMap}}],
// ../../../src/basis/l10n.js
["basis.l10n", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var dictionaryLocations={};var resourcesLoaded={};var dictionaries={};var currentCulture="base";var cultureList=["en-US","ru-RU","uk-UA"];var tokenIndex=[];var Token=Class(null,{className:namespace+".Token",bindingBridge:{attach:function(token,handler,context){return token.attach(handler,context)},detach:function(token,handler,context){return token.detach(handler,context)},get:function(token){return token.value}},listeners:null,value:null,toString:function(){return this.value},init:function(dictionary,tokenName){this.listeners=[];this.value="";this.dictionary=dictionary;this.name=tokenName;tokenIndex.push(this)},set:function(value){if(value!=this.value){this.value=value;for(var i=0,listener;listener=this.listeners[i];i++)listener.handler.call(listener.context,value)}},get:function(){return this.value},attach:function(handler,context,apply){for(var i=0,listener;listener=this.listeners[i];i++){if(listener.handler==handler&&listener.context==context)return false}this.listeners.push({handler:handler,context:context});if(apply)handler.call(context,this.value);return true},detach:function(handler,context){for(var i=0,listener;listener=this.listeners[i];i++){if(listener.handler==handler&&listener.context==context){this.listeners.splice(i,1);return true}}return false},destroy:function(){for(var i=0,listener;listener=this.listeners[i];i++)this.detach(listener.handler,listener.context);delete this.listeners;delete this.value}});var Dictionary=Class(null,{className:namespace+".Dictionary",init:function(namespace){this.namespace=namespace;this.tokens={};this.resources={}},update:function(culture,newTokens){for(var tokenName in this.tokens)if(!newTokens[tokenName])this.setCultureValue(culture,tokenName,"");for(var tokenName in newTokens)this.setCultureValue(culture,tokenName,newTokens[tokenName])},setCulture:function(culture){for(var tokenName in this.tokens)this.setTokenValue(tokenName,culture)},setTokenValue:function(tokenName,culture){this.tokens[tokenName].set(this.getCultureValue(culture,tokenName)||this.getCultureValue("base",tokenName))},setCultureValue:function(culture,tokenName,tokenValue){var resource=this.resources[culture];if(!resource)resource=this.resources[culture]={};resource[tokenName]=tokenValue;if(this.tokens[tokenName]&&(culture=="base"||culture==currentCulture))this.setTokenValue(tokenName,currentCulture)},getCultureValue:function(culture,tokenName){return this.resources[culture]&&this.resources[culture][tokenName]},getToken:function(tokenName){if(!(tokenName in this.tokens)){this.tokens[tokenName]=new Token(this,tokenName);this.setTokenValue(tokenName,currentCulture)}return this.tokens[tokenName]},destroy:function(){delete this.namespace;delete this.tokens;delete this.resources}});function getToken(path){if(arguments.length>1)path=Array.from(arguments).join(".");if(path.charAt(0)=="#"){return tokenIndex[parseInt(path.substr(1),36)]}else{var dotIndex=path.lastIndexOf(".");return getDictionary(path.substr(0,dotIndex),true).getToken(path.substr(dotIndex+1))}}function getDictionary(namespace,autoCreate){var dict=dictionaries[namespace];if(!dict&&autoCreate)dict=dictionaries[namespace]=new Dictionary(namespace);return dict}function getDictionaries(){return dictionaries}function createDictionary(namespace,location,tokens){var dictionary=getDictionary(namespace);dictionary=getDictionary(namespace,true);dictionary.location=location;if(Array.isArray(tokens)){var idx=0;var token;var item;for(var i=0;i<tokens.length;i++,idx++){item=tokens[i];if(typeof item=="number")idx+=item;else{if(token=tokenIndex[idx])token.dictionary.setCultureValue("base",token.name,item)}}}else dictionary.update("base",tokens);loadCultureForDictionary(dictionary,currentCulture);fireCreateDictionaryEvent(namespace)}function updateDictionary(namespace,culture,tokens){getDictionary(namespace,true).update(culture,tokens)}function setCulture(culture){if(currentCulture!=culture){currentCulture=culture||"base";for(var i in dictionaries)setCultureForDictionary(dictionaries[i],currentCulture)}}function getCulture(){return currentCulture}function setCultureForDictionary(dictionary,culture){loadCultureForDictionary(dictionary,culture);dictionary.setCulture(culture)}function loadCultureForDictionary(dictionary,culture){if(culture=="base")return;if(!cultureList||cultureList.indexOf(culture)!=-1){if(!dictionary.location)return;var location=dictionary.location+"/"+culture;if(!resourcesLoaded[location]){resourcesLoaded[location]=true;var res=basis.resource(location+".json");res.bindingBridge.attach(res,function(content){updateDictionaryResource(content,culture)});updateDictionaryResource(res(),culture)}}else{}}function updateDictionaryResource(dictionaryData,culture){if(Array.isArray(dictionaryData)){var idx=0;var token;var item;for(var i=0;i<dictionaryData.length;i++,idx++){item=dictionaryData[i];if(typeof item=="number")idx+=item;else{if(token=tokenIndex[idx])token.dictionary.setCultureValue(culture,token.name,item)}}}else{for(var dictionaryName in dictionaryData)updateDictionary(dictionaryName,culture,dictionaryData[dictionaryName])}}function setCultureList(list){if(typeof list=="string")list=list.qw();cultureList=list}function getCultureList(){return cultureList}var dictionaryUpdateListeners=[];function addHandler(handler,context){for(var i=0,listener;listener=dictionaryUpdateListeners[i];i++){if(listener.handler==handler&&listener.context==context)return false}dictionaryUpdateListeners.push({handler:handler,context:context});return true}function removeHandler(handler,context){for(var i=0,listener;listener=dictionaryUpdateListeners[i];i++){if(listener.handler==handler&&listener.context==context){dictionaryUpdateListeners.splice(i,1);return true}}return false}function fireCreateDictionaryEvent(dictionaryName){for(var i=0,listener;listener=dictionaryUpdateListeners[i];i++)listener.handler.call(listener.context,dictionaryName)}module.exports={Token:Token,getToken:getToken,getDictionary:getDictionary,getDictionaries:getDictionaries,createDictionary:createDictionary,updateDictionary:updateDictionary,setCulture:setCulture,getCulture:getCulture,loadCultureForDictionary:loadCultureForDictionary,setCultureList:setCultureList,getCultureList:getCultureList,addCreateDictionaryHandler:addHandler,removeCreateDictionaryHandler:removeHandler}}],
// ../../../src/basis/dom/wrapper.js
["basis.dom.wrapper", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var nsData=basis.data;var createEvent=basis.event.create;var events=basis.event.events;var LISTEN=basis.event.LISTEN;var SUBSCRIPTION=nsData.SUBSCRIPTION;var DataObject=nsData.DataObject;var AbstractDataset=nsData.AbstractDataset;var Dataset=nsData.Dataset;var STATE=nsData.STATE;var getter=Function.getter;var nullGetter=Function.nullGetter;var $undef=Function.$undef;var complete=Object.complete;var oneFunctionProperty=Class.oneFunctionProperty;var EXCEPTION_CANT_INSERT=namespace+": Node can't be inserted at specified point in hierarchy";var EXCEPTION_NODE_NOT_FOUND=namespace+": Node was not found";var EXCEPTION_BAD_CHILD_CLASS=namespace+": Child node has wrong class";var EXCEPTION_NULL_CHILD=namespace+": Child node is null";var EXCEPTION_DATASOURCE_CONFLICT=namespace+": Operation is not allowed because node is under dataSource control";var EXCEPTION_PARENTNODE_OWNER_CONFLICT=namespace+": Node can't has owner and parentNode";var DELEGATE={NONE:"none",PARENT:"parent",OWNER:"owner"};function sortingSearch(node){return node.sortingValue||0}function sortAsc(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return+(a>b)||-(a<b)}function sortDesc(a,b){a=a.sortingValue||0;b=b.sortingValue||0;return-(a>b)||+(a<b)}function sortChildNodes(obj){return obj.childNodes.sort(obj.sortingDesc?sortDesc:sortAsc)}function updateNodeContextSelection(root,oldSelection,newSelection,rootUpdate,ignoreRootSelection){if(oldSelection===newSelection)return;var nextNode;var cursor=root;var selected=[];if(rootUpdate){root.contextSelection=newSelection;if(root.selected)selected.push(root)}while(cursor){nextNode=!cursor.selection||ignoreRootSelection&&cursor===root?cursor.firstChild:null;if(nextNode&&nextNode.contextSelection!==oldSelection)throw"Try change wrong context selection";while(!nextNode){if(cursor===root){if(selected.length){if(oldSelection)oldSelection.remove(selected);if(newSelection)newSelection.add(selected)}return}nextNode=cursor.nextSibling;if(!nextNode)cursor=cursor.parentNode}cursor=nextNode;if(cursor.selected)selected.push(cursor);cursor.contextSelection=newSelection}}function updateNodeDisableContext(node,disabled){if(node.disabled)return;if(node.contextDisabled!=disabled){node.contextDisabled=disabled;if(disabled)node.event_disable();else node.event_enable()}}SUBSCRIPTION.add("OWNER",{ownerChanged:function(object,oldOwner){this.remove(object,oldOwner);this.add(object,object.owner)}},function(action,object){action(object,object.owner)});SUBSCRIPTION.add("DATASOURCE",{dataSourceChanged:function(object,oldDataSource){this.remove(object,oldDataSource);this.add(object,object.dataSource)}},function(action,object){action(object,object.dataSource)});var NULL_SATELLITE_CONFIG=Class.customExtendProperty({},function(result,extend){for(var key in extend){var config=extend[key];if(Class.isClass(config))config={instanceOf:config};if(config&&typeof config=="object"){var hookRequired=false;var contextConfig={instanceOf:config.instanceOf};var context={key:key,config:contextConfig};if(typeof config.config)contextConfig.config=config.config;if(typeof config.existsIf=="function")hookRequired=contextConfig.existsIf=config.existsIf;if(typeof config.delegate=="function")hookRequired=contextConfig.delegate=config.delegate;if(typeof config.dataSource=="function")hookRequired=contextConfig.dataSource=config.dataSource;if(hookRequired){var hook=SATELLITE_OWNER_HOOK.__extend__(config.hook||{update:true});for(var hookEvent in hook)if(hook[hookEvent]===SATELLITE_UPDATE){context.hook=hook;break}}result[key]=context}else result[key]=null}});var SATELLITE_UPDATE=function(){var owner=this.owner;var key=this.context.key;var config=this.context.config;var exists=!config.existsIf||config.existsIf(owner);var satellite=owner.satellite[key];if(exists){if(satellite){if(config.delegate)satellite.setDelegate(config.delegate(owner));if(config.dataSource)satellite.setDataSource(config.dataSource(owner))}else{var satelliteConfig=(typeof config.config=="function"?config.config(owner):config.config)||{};satelliteConfig.owner=owner;if(config.delegate)satelliteConfig.delegate=config.delegate(owner);if(config.dataSource)satelliteConfig.dataSource=config.dataSource(owner);satellite=new config.instanceOf(satelliteConfig);owner.satellite[key]=satellite;owner.event_satelliteChanged(key,null);if(owner.listen.satellite)satellite.addHandler(owner.listen.satellite,owner)}}else{if(satellite){delete owner.satellite[key];owner.event_satelliteChanged(key,satellite);satellite.destroy()}}};var SATELLITE_OWNER_HOOK=oneFunctionProperty(SATELLITE_UPDATE,{});LISTEN.add("owner","ownerChanged");LISTEN.add("dataSource","dataSourceChanged");var AbstractNode=Class(DataObject,{className:namespace+".AbstractNode",event_update:function(delta){DataObject.prototype.event_update.call(this,delta);var parentNode=this.parentNode;if(parentNode){if(parentNode.matchFunction)this.match(parentNode.matchFunction);parentNode.insertBefore(this,this.nextSibling)}},event_childNodesModified:createEvent("childNodesModified","delta")&&function(delta){events.childNodesModified.call(this,delta);var listen=this.listen.childNode;var array;if(listen){if(array=delta.inserted)for(var i=0,child;child=array[i];i++)child.addHandler(listen,this);if(array=delta.deleted)for(var i=0,child;child=array[i];i++)child.removeHandler(listen,this)}},event_dataSourceChanged:createEvent("dataSourceChanged","oldDataSource"),event_groupingChanged:createEvent("groupingChanged","oldGroupingNode"),event_sortingChanged:createEvent("sortingChanged","oldSorting","oldSortingDesc"),event_ownerChanged:createEvent("ownerChanged","oldOwner"),event_satelliteChanged:createEvent("satelliteChanged","key","oldSattelite"),subscribeTo:DataObject.prototype.subscribeTo+SUBSCRIPTION.DATASOURCE,listen:{owner:{destroy:function(){this.setOwner()}}},autoDelegate:DELEGATE.NONE,nodeType:"DOMWrapperNode",name:null,childNodes:null,childClass:AbstractNode,dataSource:null,dataSourceMap_:null,destroyDataSourceMember:true,parentNode:null,nextSibling:null,previousSibling:null,firstChild:null,lastChild:null,sorting:nullGetter,sortingDesc:false,grouping:null,groupingClass:null,groupNode:null,groupId:NaN,satelliteConfig:NULL_SATELLITE_CONFIG,satellite:null,owner:null,init:function(){var dataSource=this.dataSource;var childNodes=this.childNodes;var grouping=this.grouping;if(dataSource)this.dataSource=null;DataObject.prototype.init.call(this);if(grouping){this.grouping=null;this.setGrouping(grouping)}if(this.childClass){this.childNodes=[];if(dataSource){this.dataSource=null;this.setDataSource(dataSource)}else{if(childNodes)this.setChildNodes(childNodes)}}else{if(childNodes)this.childNodes=null;if(dataSource)this.dataSource=null}if(!this.satellite)this.satellite={};else{var satelliteListen=this.listen.satellite;for(var key in this.satellite){var satellite=this.satellite[key];satellite.setOwner(this);this.event_satelliteChanged(key,null);if(satelliteListen)satellite.addHandler(satelliteListen,this)}}if(this.satelliteConfig!==NULL_SATELLITE_CONFIG){for(var key in this.satelliteConfig){var satelliteConfig=this.satelliteConfig[key];if(satelliteConfig&&typeof satelliteConfig=="object"){var context={context:satelliteConfig,owner:this};if(satelliteConfig.hook)this.addHandler(satelliteConfig.hook,context);SATELLITE_UPDATE.call(context)}}}var owner=this.owner;if(owner){this.owner=null;this.setOwner(owner)}},setSatellite:function(key,satellite){var oldSatellite=this.satellite[key];if(satellite instanceof DataObject==false)satellite=null;if(oldSatellite!=satellite&&!this.satelliteConfig[key]){var satelliteListen=this.listen.satellite;if(oldSatellite){oldSatellite.setOwner(null);if(satelliteListen)oldSatellite.removeHandler(satelliteListen,this)}this.satellite[key]=satellite;if(satellite){satellite.setOwner(this);if(satelliteListen)satellite.addHandler(satelliteListen,this)}this.event_satelliteChanged(key,oldSatellite)}},appendChild:function(newChild){},insertBefore:function(newChild,refChild){},removeChild:function(oldChild){},replaceChild:function(newChild,oldChild){},clear:function(alive){},setChildNodes:function(){},setGrouping:function(grouping,alive){},setSorting:function(sorting,desc){},setDataSource:function(dataSource){},setOwner:function(owner){if(!owner||owner instanceof AbstractNode==false)owner=null;if(owner&&this.parentNode)throw EXCEPTION_PARENTNODE_OWNER_CONFLICT;var oldOwner=this.owner;if(oldOwner!==owner){this.owner=owner;this.event_ownerChanged(oldOwner);if(this.autoDelegate==DELEGATE.OWNER)this.setDelegate(owner)}},destroy:function(){DataObject.prototype.destroy.call(this);if(this.dataSource){this.setDataSource()}else{if(this.firstChild)this.clear()}if(this.parentNode)this.parentNode.removeChild(this);if(this.grouping){this.grouping.setOwner();this.grouping=null}if(this.owner)this.setOwner();if(this.satellite){for(var key in this.satellite){var satellite=this.satellite[key];satellite.owner=null;satellite.destroy()}this.satellite=null}this.childNodes=null;this.parentNode=null;this.previousSibling=null;this.nextSibling=null;this.firstChild=null;this.lastChild=null}});var PartitionNode=Class(AbstractNode,{className:namespace+".PartitionNode",autoDestroyIfEmpty:false,nodes:null,first:null,last:null,init:function(){this.nodes=[];AbstractNode.prototype.init.call(this)},insert:function(newNode,refNode){var nodes=this.nodes;var pos=refNode?nodes.indexOf(refNode):-1;if(pos==-1){nodes.push(newNode);this.last=newNode}else nodes.splice(pos,0,newNode);this.first=nodes[0];newNode.groupNode=this;this.event_childNodesModified({inserted:[newNode]})},remove:function(oldNode){var nodes=this.nodes;if(nodes.remove(oldNode)){this.first=nodes[0]||null;this.last=nodes[nodes.length-1]||null;oldNode.groupNode=null;this.event_childNodesModified({deleted:[oldNode]})}if(!this.first&&this.autoDestroyIfEmpty)this.destroy()},clear:function(){if(!this.first)return;var nodes=this.nodes;for(var i=nodes.length;i-->0;)nodes[i].groupNode=null;this.nodes=[];this.first=null;this.last=null;this.event_childNodesModified({deleted:nodes});if(this.autoDestroyIfEmpty)this.destroy()},destroy:function(){AbstractNode.prototype.destroy.call(this);this.nodes=null;this.first=null;this.last=null}});var DOMMIXIN_DATASOURCE_HANDLER={datasetChanged:function(dataSource,delta){var newDelta={};var deleted=[];if(delta.deleted){newDelta.deleted=deleted;if(this.childNodes.length==delta.deleted.length){deleted=Array.from(this.childNodes);var tmp=this.dataSource;this.dataSource=null;this.clear(true);this.dataSource=tmp;this.dataSourceMap_={}}else{for(var i=0,item;item=delta.deleted[i];i++){var delegateId=item.eventObjectId;var oldChild=this.dataSourceMap_[delegateId];delete this.dataSourceMap_[delegateId];oldChild.canHaveDelegate=true;this.removeChild(oldChild);deleted.push(oldChild)}}}if(delta.inserted){newDelta.inserted=[];for(var i=0,item;item=delta.inserted[i];i++){var newChild=createChildByFactory(this,{cascadeDestroy:false,delegate:item});newChild.canHaveDelegate=false;this.dataSourceMap_[item.eventObjectId]=newChild;newDelta.inserted.push(newChild);if(this.firstChild)this.insertBefore(newChild)}}if(!this.firstChild)this.setChildNodes(newDelta.inserted);else this.event_childNodesModified(newDelta);if(this.destroyDataSourceMember&&deleted.length){for(var i=0,item;item=deleted[i];i++)item.destroy()}},destroy:function(dataSource){if(this.dataSource===dataSource)this.setDataSource()}};function fastChildNodesOrder(node,order){var lastIndex=order.length-1;node.childNodes=order;node.firstChild=order[0]||null;node.lastChild=order[lastIndex]||null;for(var orderNode,i=lastIndex;orderNode=order[i];i--){orderNode.nextSibling=order[i+1]||null;orderNode.previousSibling=order[i-1]||null;node.insertBefore(orderNode,orderNode.nextSibling)}}function fastChildNodesGroupOrder(node,order){for(var i=0,child;child=order[i];i++)child.groupNode.nodes.push(child);order.length=0;for(var group=node.grouping.nullGroup;group;group=group.nextSibling){var nodes=group.nodes;group.first=nodes[0]||null;group.last=nodes[nodes.length-1]||null;order.push.apply(order,nodes);group.event_childNodesModified({inserted:nodes})}return order}function createChildByFactory(node,config){var child;if(typeof node.childFactory=="function"){child=node.childFactory(config);if(child instanceof node.childClass)return child}if(!child)throw EXCEPTION_NULL_CHILD;throw EXCEPTION_BAD_CHILD_CLASS}var DomMixin={childClass:AbstractNode,childFactory:null,listen:{dataSource:DOMMIXIN_DATASOURCE_HANDLER},getChild:function(value,getter){return this.childNodes.search(value,getter)},getChildByName:function(name){return this.getChild(name,"name")},getChilds:function(value,getter){return this.childNodes.filter(function(child){return getter(child)==value})},appendChild:function(newChild){return this.insertBefore(newChild)},insertBefore:function(newChild,refChild){if(!this.childClass)throw EXCEPTION_CANT_INSERT;if(newChild.firstChild){var cursor=this;while(cursor=cursor.parentNode){if(cursor===newChild)throw EXCEPTION_CANT_INSERT}}var isChildClassInstance=newChild&&newChild instanceof this.childClass;if(this.dataSource){if(!isChildClassInstance||this.dataSourceMap_[newChild.delegate.eventObjectId]!==newChild)throw EXCEPTION_DATASOURCE_CONFLICT}if(!isChildClassInstance)newChild=createChildByFactory(this,newChild instanceof DataObject?{delegate:newChild}:newChild);if(newChild.owner)throw EXCEPTION_PARENTNODE_OWNER_CONFLICT;var isInside=newChild.parentNode===this;var currentNewChildGroup=newChild.groupNode;var grouping=this.grouping;var sorting=this.sorting;var sortingDesc;var childNodes=this.childNodes;var newChildValue;var groupNodes;var group=null;var pos=-1;var correctSortPos=false;var nextSibling;var prevSibling;if(isInside){nextSibling=newChild.nextSibling;prevSibling=newChild.previousSibling}if(sorting!==nullGetter){refChild=null;sortingDesc=this.sortingDesc;newChildValue=sorting(newChild)||0;if(isInside){if(newChildValue===newChild.sortingValue){correctSortPos=true}else{if((!nextSibling||(sortingDesc?nextSibling.sortingValue<=newChildValue:nextSibling.sortingValue>=newChildValue))&&(!prevSibling||(sortingDesc?prevSibling.sortingValue>=newChildValue:prevSibling.sortingValue<=newChildValue))){newChild.sortingValue=newChildValue;correctSortPos=true}}}}if(grouping){var cursor;group=grouping.getGroupNode(newChild,true);groupNodes=group.nodes;if(currentNewChildGroup===group)if(correctSortPos||isInside&&nextSibling===refChild)return newChild;if(sorting!==nullGetter){if(correctSortPos){if(nextSibling&&nextSibling.groupNode===group)pos=groupNodes.indexOf(nextSibling);else pos=groupNodes.length}else{pos=groupNodes.binarySearchPos(newChildValue,sortingSearch,sortingDesc);newChild.sortingValue=newChildValue}}else{if(refChild&&refChild.groupNode===group)pos=groupNodes.indexOf(refChild);else pos=groupNodes.length}if(pos<groupNodes.length){refChild=groupNodes[pos]}else{if(group.last){refChild=group.last.nextSibling}else{cursor=group;refChild=null;while(cursor=cursor.nextSibling)if(refChild=cursor.first)break}}if(newChild===refChild||isInside&&nextSibling===refChild){if(currentNewChildGroup!==group){if(currentNewChildGroup)currentNewChildGroup.remove(newChild);group.insert(newChild,refChild)}return newChild}pos=-1}else{if(sorting!==nullGetter){if(correctSortPos)return newChild;pos=childNodes.binarySearchPos(newChildValue,sortingSearch,sortingDesc);refChild=childNodes[pos];newChild.sortingValue=newChildValue;if(newChild===refChild||isInside&&nextSibling===refChild)return newChild}else{if(refChild&&refChild.parentNode!==this)throw EXCEPTION_NODE_NOT_FOUND;if(isInside){if(nextSibling===refChild)return newChild;if(newChild===refChild)throw EXCEPTION_CANT_INSERT}}}if(isInside){if(nextSibling){nextSibling.previousSibling=prevSibling;newChild.nextSibling=null}else this.lastChild=prevSibling;if(prevSibling){prevSibling.nextSibling=nextSibling;newChild.previousSibling=null}else this.firstChild=nextSibling;if(pos==-1)childNodes.remove(newChild);else{var oldPos=childNodes.indexOf(newChild);childNodes.splice(oldPos,1);pos-=oldPos<pos}if(currentNewChildGroup){currentNewChildGroup.remove(newChild);currentNewChildGroup=null}}else{if(newChild.parentNode)newChild.parentNode.removeChild(newChild)}if(currentNewChildGroup!=group)group.insert(newChild,refChild);if(refChild){if(pos==-1)pos=childNodes.indexOf(refChild);if(pos==-1)throw EXCEPTION_NODE_NOT_FOUND;newChild.nextSibling=refChild;childNodes.splice(pos,0,newChild)}else{pos=childNodes.length;childNodes.push(newChild);refChild={previousSibling:this.lastChild};this.lastChild=newChild}newChild.parentNode=this;newChild.previousSibling=refChild.previousSibling;if(pos==0)this.firstChild=newChild;else refChild.previousSibling.nextSibling=newChild;refChild.previousSibling=newChild;if(!isInside){updateNodeContextSelection(newChild,newChild.contextSelection,this.selection||this.contextSelection,true);updateNodeDisableContext(newChild,this.disabled||this.contextDisabled);if(newChild.match)newChild.match(this.matchFunction);if(newChild.autoDelegate==DELEGATE.PARENT)newChild.setDelegate(this);if(!this.dataSource)this.event_childNodesModified({inserted:[newChild]});if(newChild.listen.parentNode)this.addHandler(newChild.listen.parentNode,newChild)}return newChild},removeChild:function(oldChild){if(!oldChild||oldChild.parentNode!==this)throw EXCEPTION_NODE_NOT_FOUND;if(oldChild instanceof this.childClass==false)throw EXCEPTION_BAD_CHILD_CLASS;if(this.dataSource&&this.dataSource.has(oldChild.delegate))throw EXCEPTION_DATASOURCE_CONFLICT;var pos=this.childNodes.indexOf(oldChild);if(pos==-1)throw EXCEPTION_NODE_NOT_FOUND;this.childNodes.splice(pos,1);oldChild.parentNode=null;if(oldChild.nextSibling)oldChild.nextSibling.previousSibling=oldChild.previousSibling;else this.lastChild=oldChild.previousSibling;if(oldChild.previousSibling)oldChild.previousSibling.nextSibling=oldChild.nextSibling;else this.firstChild=oldChild.nextSibling;oldChild.nextSibling=null;oldChild.previousSibling=null;if(oldChild.listen.parentNode)this.addHandler(oldChild.listen.parentNode,oldChild);updateNodeContextSelection(oldChild,oldChild.contextSelection,null,true);if(oldChild.groupNode)oldChild.groupNode.remove(oldChild);if(!this.dataSource)this.event_childNodesModified({deleted:[oldChild]});if(oldChild.autoDelegate==DELEGATE.PARENT)oldChild.setDelegate();return oldChild},replaceChild:function(newChild,oldChild){if(this.dataSource)throw EXCEPTION_DATASOURCE_CONFLICT;if(oldChild==null||oldChild.parentNode!==this)throw EXCEPTION_NODE_NOT_FOUND;this.insertBefore(newChild,oldChild);return this.removeChild(oldChild)},clear:function(alive){if(this.dataSource&&this.dataSource.itemCount)throw EXCEPTION_DATASOURCE_CONFLICT;if(!this.firstChild)return;if(alive)updateNodeContextSelection(this,this.selection||this.contextSelection,null,false,true);var childNodes=this.childNodes;this.firstChild=null;this.lastChild=null;this.childNodes=[];this.event_childNodesModified({deleted:childNodes});for(var i=childNodes.length;i-->0;){var child=childNodes[i];child.parentNode=null;child.groupNode=null;if(alive){child.nextSibling=null;child.previousSibling=null;if(child.autoDelegate==DELEGATE.PARENT)child.setDelegate()}else child.destroy()}if(this.grouping){for(var childNodes=this.grouping.childNodes,i=childNodes.length-1,group;group=childNodes[i];i--)group.clear()}},setChildNodes:function(newChildNodes,keepAlive){if(!this.dataSource)this.clear(keepAlive);if(newChildNodes){if("length"in newChildNodes==false)newChildNodes=[newChildNodes];if(newChildNodes.length){var tmp=this.event_childNodesModified;this.event_childNodesModified=$undef;for(var i=0,len=newChildNodes.length;i<len;i++)this.insertBefore(newChildNodes[i]);this.event_childNodesModified=tmp;this.event_childNodesModified({inserted:this.childNodes})}}},setDataSource:function(dataSource){if(!dataSource||!this.childClass||dataSource instanceof AbstractDataset==false)dataSource=null;if(this.dataSource!==dataSource){var oldDataSource=this.dataSource;var listenHandler=this.listen.dataSource;if(oldDataSource){this.dataSourceMap_=null;this.dataSource=null}if(this.firstChild)this.clear();this.dataSource=dataSource;if(dataSource){this.dataSourceMap_={};if(listenHandler){if(dataSource.itemCount&&listenHandler.datasetChanged)listenHandler.datasetChanged.call(this,dataSource,{inserted:dataSource.getItems()})}}this.event_dataSourceChanged(oldDataSource)}},setGrouping:function(grouping,alive){if(typeof grouping=="function"||typeof grouping=="string")grouping={groupGetter:grouping};if(grouping instanceof GroupingNode==false){grouping=grouping&&typeof grouping=="object"?new this.groupingClass(grouping):null}if(this.grouping!==grouping){var oldGroupingNode=this.grouping;var order;if(this.grouping){if(!grouping){this.grouping=null;if(this.firstChild){if(this.sorting!==nullGetter)order=sortChildNodes(this);else order=this.childNodes;for(var i=order.length;i-->0;)order[i].groupNode=null;fastChildNodesOrder(this,order)}}oldGroupingNode.setOwner()}if(grouping){this.grouping=grouping;grouping.setOwner(this);if(this.firstChild){if(this.sorting!==nullGetter)order=sortChildNodes(this);else order=this.childNodes;for(var i=0,child;child=order[i];i++)child.groupNode=this.grouping.getGroupNode(child,true);order=fastChildNodesGroupOrder(this,order);fastChildNodesOrder(this,order)}}this.event_groupingChanged(oldGroupingNode)}},setSorting:function(sorting,sortingDesc){sorting=getter(sorting);sortingDesc=!!sortingDesc;if(this.sorting!==sorting||this.sortingDesc!=!!sortingDesc){var oldSorting=this.sorting;var oldSortingDesc=this.sortingDesc;this.sorting=sorting;this.sortingDesc=!!sortingDesc;if(sorting!==nullGetter&&this.firstChild){var order=[];var nodes;for(var node=this.firstChild;node;node=node.nextSibling)node.sortingValue=sorting(node)||0;if(this.grouping){for(var group=this.grouping.nullGroup;group;group=group.nextSibling){nodes=group.nodes=sortChildNodes({childNodes:group.nodes,sortingDesc:this.sortingDesc});group.first=nodes[0]||null;group.last=nodes[nodes.length-1]||null;order.push.apply(order,nodes)}}else{order=sortChildNodes(this)}fastChildNodesOrder(this,order)}this.event_sortingChanged(oldSorting,oldSortingDesc)}},setMatchFunction:function(matchFunction){if(this.matchFunction!=matchFunction){var oldMatchFunction=this.matchFunction;this.matchFunction=matchFunction;for(var node=this.lastChild;node;node=node.previousSibling)node.match(matchFunction);this.event_matchFunctionChanged(oldMatchFunction)}}};var Node=Class(AbstractNode,DomMixin,{className:namespace+".Node",event_enable:createEvent("enable")&&function(){for(var child=this.firstChild;child;child=child.nextSibling)updateNodeDisableContext(child,false);events.enable.call(this)},event_disable:createEvent("disable")&&function(){for(var child=this.firstChild;child;child=child.nextSibling)updateNodeDisableContext(child,true);events.disable.call(this)},event_select:createEvent("select"),event_unselect:createEvent("unselect"),event_match:createEvent("match"),event_unmatch:createEvent("unmatch"),event_matchFunctionChanged:createEvent("matchFunctionChanged","oldMatchFunction"),selectable:true,selected:false,selection:null,contextSelection:null,matchFunction:null,matched:true,disabled:false,contextDisabled:false,listen:{owner:{enable:function(){updateNodeDisableContext(this,false)},disable:function(){updateNodeDisableContext(this,true)}}},init:function(){if(this.selection&&this.selection instanceof AbstractDataset==false){this.selection=new Selection(this.selection);if(this.listen.selection)this.selection.addHandler(this.listen.selection,this)}AbstractNode.prototype.init.call(this);if(this.disabled)this.event_disable();if(this.selected){this.selected=false;this.select(true)}},setSelection:function(selection){if(this.selection!==selection){updateNodeContextSelection(this,this.selection||this.contextSelection,selection||this.contextSelection,false,true);if(this.selection&&this.listen.selection)this.selection.removeHandler(this.listen.selection,this);this.selection=selection;if(selection&&this.listen.selection)selection.addHandler(this.listen.selection,this);return true}},hasOwnSelection:function(){return!!this.selection},select:function(multiple){var selected=this.selected;var selection=this.contextSelection;if(selection){if(!multiple){if(this.selectable)selection.set([this])}else{if(selected)selection.remove([this]);else selection.add([this])}}else if(!selected&&this.selectable){this.selected=true;this.event_select()}return this.selected!=selected},unselect:function(){var selected=this.selected;if(selected){var selection=this.contextSelection;if(selection)selection.remove([this]);else{this.selected=false;this.event_unselect()}}return this.selected!=selected},enable:function(){if(this.disabled){this.disabled=false;if(this.disabled==this.contextDisabled)this.event_enable()}},disable:function(){if(!this.disabled){this.disabled=true;if(this.disabled!=this.contextDisabled)this.event_disable()}},isDisabled:function(){return this.disabled||this.contextDisabled},match:function(func){if(typeof func!="function")func=null;if(this.underMatch_&&!func)this.underMatch_(this,true);this.underMatch_=func;var matched=!func||func(this);if(this.matched!=matched){this.matched=matched;if(matched)this.event_match();else this.event_unmatch()}},destroy:function(){if(this.hasOwnSelection())this.setSelection();this.unselect();AbstractNode.prototype.destroy.call(this)}});var GroupingNode=Class(AbstractNode,DomMixin,{className:namespace+".GroupingNode",event_childNodesModified:function(delta){events.childNodesModified.call(this,delta);this.nullGroup.nextSibling=this.firstChild;var array;if(array=delta.inserted){for(var i=0,child;child=array[i++];){child.groupId_=child.delegate?child.delegate.eventObjectId:child.data.id;this.map_[child.groupId_]=child}if(this.dataSource&&this.nullGroup.first){var parentNode=this.owner;var nodes=Array.from(this.nullGroup.nodes);for(var i=nodes.length;i-->0;)parentNode.insertBefore(nodes[i],nodes[i].nextSibling)}}},event_ownerChanged:function(oldOwner){if(oldOwner&&oldOwner.grouping===this)oldOwner.setGrouping(null,true);if(this.owner&&this.owner.grouping!==this)this.owner.setGrouping(this);events.ownerChanged.call(this,oldOwner);if(!this.owner&&this.autoDestroyWithNoOwner)this.destroy()},map_:null,autoDestroyWithNoOwner:true,autoDestroyEmptyGroups:true,groupGetter:nullGetter,childClass:PartitionNode,childFactory:function(config){return new this.childClass(complete({autoDestroyIfEmpty:this.dataSource?false:this.autoDestroyEmptyGroups},config))},init:function(){this.map_={};this.nullGroup=new PartitionNode;AbstractNode.prototype.init.call(this)},getGroupNode:function(node,autocreate){var groupRef=this.groupGetter(node);var isDelegate=groupRef instanceof DataObject;var group=this.map_[isDelegate?groupRef.eventObjectId:groupRef];if(this.dataSource)autocreate=false;if(!group&&autocreate){group=this.appendChild(isDelegate?groupRef:{data:{id:groupRef,title:groupRef}})}return group||this.nullGroup},insertBefore:function(newChild,refChild){newChild=DomMixin.insertBefore.call(this,newChild,refChild);var firstNode=newChild.first;if(firstNode){var parent=firstNode.parentNode;var lastNode=newChild.last;var beforePrev;var beforeNext;var afterPrev;var afterNext=null;var cursor=newChild;while(cursor=cursor.nextSibling){if(afterNext=cursor.first)break}afterPrev=afterNext?afterNext.previousSibling:parent.lastChild;beforePrev=firstNode.previousSibling;beforeNext=lastNode.nextSibling;if(beforeNext!==afterNext){var parentChildNodes=parent.childNodes;var nodes=newChild.nodes;var nodesCount=nodes.length;if(beforePrev)beforePrev.nextSibling=beforeNext;if(beforeNext)beforeNext.previousSibling=beforePrev;if(afterPrev)afterPrev.nextSibling=firstNode;if(afterNext)afterNext.previousSibling=lastNode;firstNode.previousSibling=afterPrev;lastNode.nextSibling=afterNext;var firstPos=parentChildNodes.indexOf(firstNode);var afterNextPos=afterNext?parentChildNodes.indexOf(afterNext):parentChildNodes.length;if(afterNextPos>firstPos)afterNextPos-=nodesCount;parentChildNodes.splice(firstPos,nodesCount);parentChildNodes.splice.apply(parentChildNodes,[afterNextPos,0].concat(nodes));if(!afterPrev||!beforePrev)parent.firstChild=parentChildNodes[0];if(!afterNext||!beforeNext)parent.lastChild=parentChildNodes[parentChildNodes.length-1];if(firstNode instanceof PartitionNode)for(var i=nodesCount,insertBefore=afterNext;i-->0;){parent.insertBefore(nodes[i],insertBefore);refChild=nodes[i]}}}return newChild},removeChild:function(oldChild){if(oldChild=DomMixin.removeChild.call(this,oldChild)){delete this.map_[oldChild.groupId_];for(var i=0,node;node=oldChild.nodes[i];i++)node.parentNode.insertBefore(node)}return oldChild},clear:function(alive){var nodes=[];var getGroupNode=this.getGroupNode;var nullGroup=this.nullGroup;this.getGroupNode=function(){return nullGroup};for(var group=this.firstChild;group;group=group.nextSibling)nodes.push.apply(nodes,group.nodes);for(var i=0,child;child=nodes[i];i++)child.parentNode.insertBefore(child);this.getGroupNode=getGroupNode;DomMixin.clear.call(this,alive);this.map_={}},destroy:function(){this.autoDestroyWithNoOwner=false;AbstractNode.prototype.destroy.call(this);this.nullGroup.destroy();this.nullGroup=null;this.map_=null}});AbstractNode.prototype.groupingClass=GroupingNode;var CHILDNODESDATASET_HANDLER={childNodesModified:function(sender,delta){var memberMap=this.memberMap_;var newDelta={};var node;var insertCount=0;var deleteCount=0;var inserted=delta.inserted;var deleted=delta.deleted;if(inserted&&inserted.length){newDelta.inserted=inserted;while(node=inserted[insertCount]){memberMap[node.eventObjectId]=node;insertCount++}}if(deleted&&deleted.length){newDelta.deleted=deleted;while(node=deleted[deleteCount]){delete memberMap[node.eventObjectId];deleteCount++}}if(insertCount||deleteCount)this.event_datasetChanged(newDelta)},destroy:function(){if(this.autoDestroy)this.destroy();else this.setSourceNode()}};var ChildNodesDataset=Class(AbstractDataset,{className:namespace+".ChildNodesDataset",autoDestroy:true,sourceNode:null,listen:{sourceNode:CHILDNODESDATASET_HANDLER},event_sourceNodeChanged:createEvent("sourceNodeChanged")&&function(oldSourceNode){events.sourceNodeChanged.call(this,oldSourceNode);if(!this.sourceNode&&this.autoDestroy)this.destroy()},init:function(){AbstractDataset.prototype.init.call(this);if(this.sourceNode){var sourceNode=this.sourceNode;this.sourceNode=null;this.setSourceNode(sourceNode)}},setSourceNode:function(node){if(node instanceof AbstractNode==false)node=null;if(node!==this.sourceNode){var oldSourceNode=this.sourceNode;var listenHandler=this.listen.sourceNode;this.sourceNode=node;if(listenHandler){var childNodesModifiedHandler=listenHandler.childNodesModified;if(oldSourceNode){oldSourceNode.removeHandler(listenHandler,this);if(childNodesModifiedHandler)childNodesModifiedHandler.call(this,oldSourceNode,{deleted:oldSourceNode.childNodes})}if(node){node.addHandler(listenHandler,this);if(childNodesModifiedHandler)childNodesModifiedHandler.call(this,node,{inserted:node.childNodes})}}this.event_sourceNodeChanged(oldSourceNode)}},destroy:function(){this.setSourceNode();AbstractDataset.prototype.destroy.call(this)}});var Selection=Class(Dataset,{className:namespace+".Selection",multiple:false,event_datasetChanged:function(delta){Dataset.prototype.event_datasetChanged.call(this,delta);if(delta.inserted){for(var i=0,node;node=delta.inserted[i];i++){if(!node.selected){node.selected=true;node.event_select()}}}if(delta.deleted){for(var i=0,node;node=delta.deleted[i];i++){if(node.selected){node.selected=false;node.event_unselect()}}}},add:function(nodes){if(!this.multiple){if(this.itemCount)return this.set(nodes);else nodes=[nodes[0]]}var items=[];for(var i=0,node;node=nodes[i];i++){if(node.contextSelection==this&&node.selectable)items.push(node)}return Dataset.prototype.add.call(this,items)},set:function(nodes){var items=[];for(var i=0,node;node=nodes[i];i++){if(node.contextSelection==this&&node.selectable)items.push(node)}if(!this.multiple)items.splice(1);return Dataset.prototype.set.call(this,items)}});module.exports={DELEGATE:DELEGATE,AbstractNode:AbstractNode,Node:Node,GroupingNode:GroupingNode,PartitionNode:PartitionNode,ChildNodesDataset:ChildNodesDataset,Selection:Selection,nullSelection:new AbstractDataset}}],
// ../../../src/basis/template.js
["basis.template", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var Class=basis.Class;var dom=basis.dom;var domEvent=basis.dom.event;var Cleaner=basis.Cleaner;var CLONE_NORMALIZE_TEXT_BUG=typeof window!="undefined"&&function(){return dom.createElement("","a","b").cloneNode(true).childNodes.length==1}();var TYPE_ELEMENT=1;var TYPE_ATTRIBUTE=2;var TYPE_TEXT=3;var TYPE_COMMENT=8;var TOKEN_TYPE=0;var TOKEN_BINDINGS=1;var TOKEN_REFS=2;var ATTR_NAME=3;var ATTR_VALUE=4;var ELEMENT_NAME=3;var ELEMENT_ATTRS=4;var ELEMENT_CHILDS=5;var TEXT_VALUE=3;var COMMENT_VALUE=3;var SYNTAX_ERROR="Invalid or unsupported syntax";var TEXT=/((?:.|[\r\n])*?)(\{(?:l10n:([a-zA-Z\_][a-zA-Z0-9\-\_]*(?:\.[a-zA-Z\_][a-zA-Z0-9\-\_]*)*)\}|resource:([a-zA-Z0-9\_\-\.\:\\\/\s]+)\})?|<(\/|!--(\s*\{)?)?|$)/g;var TAG_NAME=/([a-z\_][a-z0-9\-\_]*)(\:|\{|\s*(\/?>)?)/ig;var ATTRIBUTE_NAME_OR_END=/([a-z\_][a-z0-9\-\_]*)(\:|\{|=|\s*)|(\/?>)/ig;var COMMENT=/(.|[\r\n])*?-->/g;var CLOSE_TAG=/([a-z\_][a-z0-9\-\_]*(?:\:[a-z\_][a-z0-9\-\_]*)?)>/ig;var REFERENCE=/([a-z\_][a-z0-9\_]*)(\||\}\s*)/ig;var ATTRIBUTE_VALUE=/"((?:(\\")|[^"])*?)"\s*/g;var quoteEscape=/"/g;var quoteUnescape=/\\"/g;var eventAttr=/^event-(.+)+/;var tmplEventListeners={};var tmplNodeMap={seed:1};var templateList=[];var tmplFilesMap={};var namespaceURI={svg:"http://www.w3.org/2000/svg"};var tokenize=function(source,debug){var result=[];var resources=[];var tagStack=[];var lastTag={childs:result};var sourceText;var token;var bufferPos;var startPos;var parseTag=false;var textStateEndPos=0;var textEndPos;var refName;var l10nMatch;var state=TEXT;var pos=0;var m;result.resources=resources;source=source.trim();try{while(pos<source.length||state!=TEXT){state.lastIndex=pos;startPos=pos;m=state.exec(source);if(!m||m.index!==pos){if(state==REFERENCE&&token&&token.type==TYPE_COMMENT){state=COMMENT;continue}if(parseTag)lastTag=tagStack.pop();if(token)lastTag.childs.pop();if(token=lastTag.childs.pop()){if(token.type==TYPE_TEXT&&!token.refs)textStateEndPos-="len"in token?token.len:token.value.length;else lastTag.childs.push(token)}parseTag=false;state=TEXT;continue}pos=state.lastIndex;switch(state){case TEXT:textEndPos=startPos+m[1].length;if(textStateEndPos!=textEndPos){sourceText=textStateEndPos==startPos?m[1]:source.substring(textStateEndPos,textEndPos);token=sourceText.replace(/\s*(\r\n?|\n\r?)\s*/g,"");if(token)lastTag.childs.push({type:TYPE_TEXT,len:sourceText.length,value:token})}textStateEndPos=textEndPos;if(m[3]){lastTag.childs.push({type:TYPE_TEXT,refs:["l10n:"+m[3]],value:"{l10n:"+m[3]+"}"})}else if(m[4]){resources.push(m[4])}else if(m[2]=="{"){bufferPos=pos-1;lastTag.childs.push(token={type:TYPE_TEXT});state=REFERENCE}else if(m[5]){if(m[5]=="/"){token=null;state=CLOSE_TAG}else{lastTag.childs.push(token={type:TYPE_COMMENT});if(m[6]){bufferPos=pos-m[6].length;state=REFERENCE}else{bufferPos=pos;state=COMMENT}}}else if(m[2]){parseTag=true;tagStack.push(lastTag);lastTag.childs.push(token={type:TYPE_ELEMENT,attrs:[],childs:[]});lastTag=token;state=TAG_NAME}break;case CLOSE_TAG:if(m[1]!==(lastTag.prefix?lastTag.prefix+":":"")+lastTag.name){lastTag.childs.push({type:TYPE_TEXT,value:"</"+m[0]})}else lastTag=tagStack.pop();state=TEXT;break;case TAG_NAME:case ATTRIBUTE_NAME_OR_END:if(m[2]==":"){if(token.prefix)throw SYNTAX_ERROR;token.prefix=m[1];break}if(m[1]){token.name=m[1];if(token.type==TYPE_ATTRIBUTE)lastTag.attrs.push(token)}if(m[2]=="{"){state=REFERENCE;break}if(m[3]){if(m[3]=="/>")lastTag=tagStack.pop();parseTag=false;state=TEXT;break}if(m[2]=="="){state=ATTRIBUTE_VALUE;break}token={type:TYPE_ATTRIBUTE};state=ATTRIBUTE_NAME_OR_END;break;case COMMENT:token.value=source.substring(bufferPos,pos-3);state=TEXT;break;case REFERENCE:refName=m[1];if(token.refs)token.refs.push(m[1]);else token.refs=[m[1]];if(m[2]!="|"){if(token.type==TYPE_TEXT){pos-=m[2].length-1;token.value=source.substring(bufferPos,pos);state=TEXT}else if(token.type==TYPE_COMMENT){state=COMMENT}else if(token.type==TYPE_ATTRIBUTE&&source[pos]=="="){pos++;state=ATTRIBUTE_VALUE}else{token={type:TYPE_ATTRIBUTE};state=ATTRIBUTE_NAME_OR_END}}break;case ATTRIBUTE_VALUE:token.value=m[1].replace(quoteUnescape,'"');token={type:TYPE_ATTRIBUTE};state=ATTRIBUTE_NAME_OR_END;break;default:throw"Parser bug"}if(state==TEXT)textStateEndPos=pos}if(textStateEndPos!=pos)lastTag.childs.push({type:TYPE_TEXT,value:source.substring(textStateEndPos,pos)});if(tagStack.length>1)throw"No close tag for "+tagStack.pop().name;result.templateTokens=true}catch(e){console.warn(e,source)}return result};function dirname(url){return String(url).replace(/[^\\\/]+$/,"")}var makeDeclaration=function(){var CLASS_ATTR_PARTS=/(\S+)/g;var CLASS_ATTR_BINDING=/^([a-z\_][a-z0-9\-\_]*)?\{((anim:)?[a-z\_][a-z0-9\-\_]*)\}$/i;var STYLE_ATTR_PARTS=/\s*[^:]+?\s*:(?:\(.*?\)|\".*?\"|\'.*?\'|[^;]+?)+(?:;|$)/gi;var STYLE_PROPERTY=/\s*([^:]+?)\s*:((?:\(.*?\)|\".*?\"|\'.*?\'|[^;]+?)+);?$/i;var ATTR_BINDING=/\{([a-z\_][a-z0-9\_]*|l10n:[a-z\_][a-z0-9\_]*(?:\.[a-z\_][a-z0-9\_]*)*)\}/i;var NAMED_CHARACTER_REF=/&([a-z]+|#[0-9]+|#x[0-9a-f]{1,4});?/gi;var tokenMap={};var tokenElement=document.createElement("div");var includeStack=[];var cleanupItems=[];function name(token){return(token.prefix?token.prefix+":":"")+token.name}function namedCharReplace(m,token){if(!tokenMap[token]){if(token.charAt(0)=="#"){tokenMap[token]=String.fromCharCode(token.charAt(1)=="x"||token.charAt(1)=="X"?parseInt(token.substr(2),16):token.substr(1))}else{tokenElement.innerHTML=m;tokenMap[token]=tokenElement.firstChild?tokenElement.firstChild.nodeValue:""}}return tokenMap[token]}function untoken(value){return value.replace(NAMED_CHARACTER_REF,namedCharReplace)}function refList(token){var array=token.refs;if(!array||!array.length)return 0;return array}function attrs(token,declToken){function buildExpression(parts){var bindName;var names=[];var expression=[];var map={};for(var j=0;j<parts.length;j++)if(j%2){bindName=parts[j];if(!map[bindName]){map[bindName]=names.length;names.push(bindName)}expression.push(map[bindName])}else{if(parts[j])expression.push(untoken(parts[j]))}return[names,expression]}var attrs=token.attrs;var result=[];var bindings;var parts;var m;for(var i=0,attr;attr=attrs[i];i++){bindings=0;if(attr.prefix=="b"){switch(attr.name){case"ref":var refs=(attr.value||"").trim().split(/\s+/);for(var j=0;j<refs.length;j++)addTokenRef(declToken,refs[j]);break}continue}if(attr.value){switch(attr.name){case"class":if(parts=attr.value.match(CLASS_ATTR_PARTS)){var newValue=[];var map={};bindings=[];for(var j=0,part;part=parts[j];j++){if(m=part.match(CLASS_ATTR_BINDING))bindings.push([m[1]||"",m[2]]);else newValue.push(part)}attr.value=newValue.join(" ")}break;case"style":var parts=attr.value.match(STYLE_ATTR_PARTS);var props=[];var bindings=[];for(var j=0,part;part=parts[j];j++){var m=part.match(STYLE_PROPERTY);var propertyName=m[1];var value=m[2].trim();var valueParts=value.split(ATTR_BINDING);if(valueParts.length>1){var expr=buildExpression(valueParts);expr.push(propertyName);bindings.push(expr)}else props.push(propertyName+": "+untoken(value))}props.push("");attr.value=props.join(";");break;default:parts=attr.value.split(ATTR_BINDING);if(parts.length>1)bindings=buildExpression(parts);else attr.value=untoken(attr.value)}}if(bindings&&!bindings.length)bindings=0;result.push([2,bindings,refList(attr),name(attr),attr.value])}return result.length?result:0}function addTokenRef(token,refName){if(!token[TOKEN_REFS])token[TOKEN_REFS]=[];token[TOKEN_REFS].add(refName);if(refName!="element")token[TOKEN_BINDINGS]=token[TOKEN_REFS].length==1?refName:0}function removeTokenRef(token,refName){if(token[TOKEN_REFS].remove(refName)){if(!token[TOKEN_REFS].length)token[TOKEN_REFS]=0}}function tokenAttrs(token){var result={};if(token.attrs)for(var i=0,attr;attr=token.attrs[i];i++)result[name(attr)]=attr.value;return result}function addUnique(array,items){for(var i=0;i<items.length;i++)array.add(items[i])}function process(tokens,template){var result=[];for(var i=0,token,item;token=tokens[i];i++){var refs=refList(token);var bindings=refs&&refs.length==1?refs[0]:0;switch(token.type){case TYPE_ELEMENT:var elName=name(token);if(token.prefix=="b"){var elAttrs=tokenAttrs(token);switch(token.name){case"resource":if(elAttrs.src)template.resources.push(basis.path.resolve(template.baseURI+elAttrs.src));break;case"set":if("name"in elAttrs&&"value"in elAttrs){var value=elAttrs.value;if(value==="true")value=true;if(value==="false")value=false;template.options[elAttrs.name]=value}break;case"define":if("name"in elAttrs&&!template.defines[elAttrs.name]){switch(elAttrs.type){case"bool":template.defines[elAttrs.name]=[elAttrs["default"]=="true"?1:0];break;case"enum":var values=elAttrs.values?elAttrs.values.qw():[];template.defines[elAttrs.name]=[values.indexOf(elAttrs["default"])+1,values];break}}break;case"include":if(elAttrs.src){var isTemplateRef=/^#\d+$/.test(elAttrs.src);var url=isTemplateRef?elAttrs.src.substr(1):basis.path.resolve(template.baseURI+elAttrs.src);if(includeStack.indexOf(url)==-1){includeStack.push(url);var decl;if(isTemplateRef){var tmpl=templateList[url];template.deps.add(tmpl);if(tmpl.source.bindingBridge)template.deps.add(tmpl.source);decl=getDeclFromTemplate(tmpl,true)}else{var resource=basis.resource(url);template.deps.add(resource);decl=makeDeclaration(resource(),basis.path.dirname(url)+"/")}includeStack.pop();if(decl.resources)addUnique(template.resources,decl.resources);if(decl.deps)addUnique(template.deps,decl.deps);var tokenRefMap=normalizeRefs(decl.tokens);for(var j=0,child;child=token.childs[j];j++){if(child.type==TYPE_ELEMENT&&child.prefix=="b"){switch(child.name){case"replace":var childAttrs=tokenAttrs(child);var tokenRef=childAttrs.ref&&tokenRefMap[childAttrs.ref];if(tokenRef){var pos=tokenRef.owner.indexOf(tokenRef.token);if(pos!=-1)tokenRef.owner.splice.apply(tokenRef.owner,[pos,1].concat(process(child.childs,template)||[]))}break}}else decl.tokens.push.apply(decl.tokens,process([child],template)||[])}if(tokenRefMap.element)removeTokenRef(tokenRefMap.element.token,"element");result.push.apply(result,decl.tokens)}else{console.warn("Recursion: ",includeStack.join(" -> "))}}break}continue}item=[1,bindings,refs,name(token),0,process(token.childs,template)];item[ELEMENT_ATTRS]=attrs(token,item);break;case TYPE_TEXT:if(refs&&refs.length==2&&refs.search("element"))bindings=refs[+!Array.lastSearchIndex];item=[3,bindings,refs];if(!refs||token.value!="{"+refs.join("|")+"}")item.push(untoken(token.value));break;case TYPE_COMMENT:item=[8,bindings,refs];if(!refs||token.value!="{"+refs.join("|")+"}")item.push(untoken(token.value));break}result.push(item)}return result.length?result:0}function normalizeRefs(tokens,map){if(!map)map={};for(var i=0,token;token=tokens[i];i++){var refs=token[TOKEN_REFS];if(refs){for(var j=refs.length-1,refName;refName=refs[j];j--){if(refName.indexOf(":")!=-1){removeTokenRef(token,refName);continue}if(map[refName])removeTokenRef(map[refName].token,refName);map[refName]={owner:tokens,token:token}}}if(token[TOKEN_TYPE]==TYPE_ELEMENT)normalizeRefs(token[ELEMENT_CHILDS],map)}return map}function applyDefines(tokens,defines,classMap,warns){var unpredictable=0;for(var i=0,token;token=tokens[i];i++){if(token[TOKEN_TYPE]==TYPE_ELEMENT){unpredictable+=applyDefines(token[ELEMENT_CHILDS],defines,classMap,warns);var attrs=token[ELEMENT_ATTRS];if(attrs){for(var j=0,attr;attr=attrs[j];j++){if(attr[ATTR_NAME]=="class"){var bindings=attr[TOKEN_BINDINGS];if(classMap)classMap.push(attr);if(bindings){var newAttrValue=attr[ATTR_VALUE].qw();for(var k=0,bind;bind=bindings[k];k++){if(bind.length>2)continue;var bindName=bind[1].split(":").pop();var bindDef=defines[bindName];if(bindDef){bind.push.apply(bind,bindDef);bindDef.used=true;if(bindDef[0]){if(bindDef.length==1)newAttrValue.add(bind[0]+bindName);else newAttrValue.add(bind[0]+bindDef[1][bindDef[0]-1])}if(classMap){if(bindDef.length==1){bind.push(bind[0]+bindName);bind[0]=0}else{bind.push(bindDef[1].map(function(name){return bind[0]+name}));bind[0]=0}}}else{unpredictable++}}attr[ATTR_VALUE]=newAttrValue.join(" ")}break}}}}}return unpredictable}return function(source,baseURI,options){var debug=!!(options&&options.debug);if(!source.templateTokens)source=tokenize(""+source,debug);var result={debug:debug,baseURI:baseURI||"",resources:source.resources.map(function(url){return(baseURI||"")+url}),deps:[],defines:{},unpredictable:true,options:{}};if(debug)result.warns=[];result.tokens=process(source,result);if(!result.tokens)result.tokens=[[3,0,0,""]];addTokenRef(result.tokens[0],"element");normalizeRefs(result.tokens);var classMap=options&&options.classMap?[]:null;result.unpredictable=!!applyDefines(result.tokens,result.defines,classMap,result.warns);if(classMap&&classMap.length)result.classMap=classMap;delete result.defines;delete result.debug;if(debug&&!result.warns.length)delete result.warns;return result}}();var buildPathes=function(){var PATH_REF_NAME="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".toArray();var pathList;var refList;var bindingList;var objectRefList;var rootPath;function putRefs(refs,pathIdx){for(var i=0,refName;refName=refs[i];i++)if(refName.indexOf(":")==-1)refList.push(refName+":"+pathIdx)}function putPath(path){var len=pathList.length;var pathRef=PATH_REF_NAME[len]||"r"+len;pathList.push(pathRef+"="+path);return pathRef}function putBinding(binding){bindingList.push(binding)}function processTokens(tokens,path){var localPath;var hasBindings;var attrs;var childs;var refs;var myRef;var explicitRef;var bindings;for(var i=0,cp=0,token;token=tokens[i];i++,cp++,explicitRef=false){if(!i)localPath=path+".firstChild";else{if(!tokens[i+1])localPath=path+".lastChild";else{if(CLONE_NORMALIZE_TEXT_BUG&&token[TOKEN_TYPE]==tokens[i-1][TOKEN_TYPE]&&token[TOKEN_TYPE]==TYPE_TEXT)cp++;localPath=path+".childNodes["+cp+"]"}}if(refs=token[TOKEN_REFS]){explicitRef=true;localPath=putPath(localPath);putRefs(refs,localPath)}if(token[TOKEN_BINDINGS]){if(!explicitRef){explicitRef=true;localPath=putPath(localPath)}putBinding([token[TOKEN_TYPE],localPath,token[TOKEN_BINDINGS]])}if(token[TOKEN_TYPE]==TYPE_ELEMENT){myRef=-1;if(!i&&path==rootPath)objectRefList.push(localPath);if(!explicitRef){localPath=putPath(localPath);myRef=pathList.length}if(attrs=token[ELEMENT_ATTRS])for(var j=0,attr;attr=attrs[j];j++){var attrName=attr[ATTR_NAME];if(refs=attr[TOKEN_REFS]){explicitRef=true;putRefs(refs,putPath(localPath+'.getAttributeNode("'+attrName+'")'))}if(bindings=attr[TOKEN_BINDINGS]){explicitRef=true;switch(attrName){case"class":for(var k=0,binding;binding=bindings[k];k++)putBinding([2,localPath,binding[1],attrName,binding[0]].concat(binding.slice(2)));break;case"style":for(var k=0,property;property=bindings[k];k++)for(var m=0,bindName;bindName=property[0][m];m++)putBinding([2,localPath,bindName,attrName,property[0],property[1],property[2]]);break;default:for(var k=0,bindName;bindName=bindings[0][k];k++)putBinding([2,localPath,bindName,attrName,bindings[0],bindings[1],token[ELEMENT_NAME]])}}}if(childs=token[ELEMENT_CHILDS])processTokens(childs,localPath);if(!explicitRef&&myRef==pathList.length)pathList.pop()}}}return function(tokens,path){pathList=[];refList=[];bindingList=[];objectRefList=[];rootPath=path||"_";processTokens(tokens,rootPath);return{path:pathList,ref:refList,binding:bindingList,objectRefList:objectRefList}}}();var makeFunctions=function(){var WHITESPACE=/\s+/;var W3C_DOM_NODE_SUPPORTED=typeof Node=="function"&&document instanceof Node;var CLASSLIST_SUPPORTED=global.DOMTokenList&&document&&document.documentElement.classList instanceof global.DOMTokenList;var TRANSITION_SUPPORTED=!!(document&&function(){var properties=["webkitTransition","MozTransition","msTransition","OTransition","transition"];var style=document.documentElement.style;for(var i=0;i<properties.length;i++)if(properties[i]in style)return true}());var SPECIAL_ATTR_MAP={disabled:true,checked:["input"],value:["input","textarea"],minlength:["input"],maxlength:["input"],selected:["option"]};function templateBindingUpdateFactory(names,getters){return function templateBindingUpdate(){for(var i=0,bindingName;bindingName=names[i];i++)this.tmpl.set(bindingName,getters[bindingName](this))}}function getBindingFactory(templateBindings){var bindingCache={};return function getBinding(bindings,testNode){var cacheId="bindingId"in bindings?bindings.bindingId:null;var result=bindingCache[cacheId];if(!result){var names=[];var events={};var handler={};var getters={};for(var key in templateBindings){var binding=bindings[key];var getter=binding&&binding.getter;if(getter){getters[key]=getter;names.push(key);if(binding.events){var eventList=String(binding.events).qw();for(var i=0,eventName;eventName=eventList[i];i++){if(events[eventName]){events[eventName].push(key)}else{if(!handler)handler={};events[eventName]=[key];handler[eventName]=templateBindingUpdateFactory(events[eventName],getters)}}}}}result={names:names,events:events,sync:templateBindingUpdateFactory(names,getters),handler:handler};if(cacheId)bindingCache[cacheId]=result}return result}}var bind_node=W3C_DOM_NODE_SUPPORTED?function(domRef,oldNode,newValue){var newNode=domRef;if(newValue instanceof Node){if(newValue.nodeType==11){if(newValue.firstChild===newValue.lastChild)newNode=newValue.firstChild;else newNode=Array.from(newValue)}else newNode=newValue}if(newNode!==oldNode){if(Array.isArray(newNode)){if(oldNode.fragmentStart){newNode.fragmentStart=oldNode.fragmentStart;newNode.fragmentEnd=oldNode.fragmentEnd;var cursor=newNode.fragmentStart.nextSibling;while(cursor&&cursor!=newNode.fragmentEnd){var tmp=cursor;cursor=cursor.nextSibling;tmp.parentNode.removeChild(tmp)}}else{newNode.fragmentStart=document.createComment("start");newNode.fragmentEnd=document.createComment("end");oldNode.parentNode.insertBefore(newNode.fragmentStart,oldNode);oldNode.parentNode.replaceChild(newNode.fragmentEnd,oldNode)}for(var i=0,node;node=newNode[i];i++)newNode.fragmentEnd.parentNode.insertBefore(node,newNode.fragmentEnd)}else{if(oldNode&&oldNode.fragmentStart){var cursor=oldNode.fragmentStart.nextSibling;while(cursor&&cursor!=oldNode.fragmentEnd){var tmp=cursor;cursor=cursor.nextSibling;tmp.parentNode.removeChild(tmp)}oldNode.fragmentStart.parentNode.removeChild(oldNode.fragmentStart);oldNode=oldNode.fragmentEnd}oldNode.parentNode.replaceChild(newNode,oldNode)}}return newNode}:function(domRef,oldNode,newValue){var newNode=newValue&&typeof newValue=="object"?newValue:domRef;if(newNode!==oldNode)try{oldNode.parentNode.replaceChild(newNode,oldNode)}catch(e){newNode=domRef;if(oldNode!==newNode)oldNode.parentNode.replaceChild(newNode,oldNode)}return newNode};var bind_element=function(domRef,oldNode,newValue){var newNode=bind_node(domRef,oldNode,newValue);if(newNode===domRef)domRef.innerHTML=newValue;return newNode};var bind_comment=bind_node;var bind_textNode=function(domRef,oldNode,newValue){var newNode=bind_node(domRef,oldNode,newValue);if(newNode===domRef)domRef.nodeValue=newValue;return newNode};var bind_attrClass=CLASSLIST_SUPPORTED?function(domRef,oldClass,newValue,prefix,anim){var newClass=newValue?prefix+newValue:"";if(newClass!=oldClass){if(oldClass)domRef.classList.remove(oldClass);if(newClass){domRef.classList.add(newClass);if(anim){domRef.classList.add(newClass+"-anim");setTimeout(function(){domRef.classList.remove(newClass+"-anim")},0)}}}return newClass}:function(domRef,oldClass,newValue,prefix,anim){var newClass=newValue?prefix+newValue:"";if(newClass!=oldClass){var classList=domRef.className.split(WHITESPACE);if(oldClass)classList.remove(oldClass);if(newClass){classList.push(newClass);if(anim){classList.add(newClass+"-anim");setTimeout(function(){var classList=domRef.className.split(WHITESPACE);classList.remove(newClass+"-anim");domRef.className=classList.join(" ")},0)}}domRef.className=classList.join(" ")}return newClass};var bind_attrStyle=function(domRef,propertyName,oldValue,newValue){if(oldValue!==newValue){try{domRef.style[propertyName.camelize()]=newValue}catch(e){}}return newValue};var bind_attr=function(domRef,attrName,oldValue,newValue){if(oldValue!==newValue){if(newValue)domRef.setAttribute(attrName,newValue);else domRef.removeAttribute(attrName)}return newValue};function buildAttrExpression(binding,l10n){var expression=[];var symbols=binding[5];var dictionary=binding[4];var exprVar;var colonPos;for(var j=0;j<symbols.length;j++)if(typeof symbols[j]=="string")expression.push('"'+symbols[j].replace(quoteEscape,'\\"')+'"');else{exprVar=dictionary[symbols[j]];colonPos=exprVar.indexOf(":");if(colonPos==-1)expression.push(l10n?'"{'+exprVar+'}"':"__"+exprVar);else expression.push('__l10n["'+exprVar.substr(colonPos+1)+'"]')}if(expression.length==1)expression.push('""');return expression.join("+")}var bindFunctions={1:"bind_element",3:"bind_textNode",8:"bind_comment"};function buildBindings(bindings){var bindMap={};var bindCode;var bindVar;var varList=[];var result=[];var varName;var l10nMap;var toolsUsed={};var specialAttr;for(var i=0,binding;binding=bindings[i];i++){var bindType=binding[0];var domRef=binding[1];var bindName=binding[2];var namePart=bindName.split(":");var anim=namePart[0]=="anim";if(anim){bindName=namePart[1];anim=TRANSITION_SUPPORTED}bindCode=bindMap[bindName];bindVar="_"+i;varName="__"+bindName;if(namePart[0]=="l10n"&&namePart[1]){var l10nName=namePart[1];if(!l10nMap)l10nMap={};if(!bindMap[l10nName]){bindMap[l10nName]=[];l10nMap[l10nName]=[]}bindCode=bindMap[l10nName];bindCode.l10n=true;if(binding[0]==TYPE_TEXT){bindCode.push(domRef+'.nodeValue=__l10n["'+l10nName+'"];');l10nMap[l10nName].push(domRef+".nodeValue=value;")}else{attrName='"'+binding[ATTR_NAME]+'"';l10nMap[l10nName].push("bind_attr("+[domRef,attrName,"NaN",buildAttrExpression(binding,true)]+");");toolsUsed.bind_attr=true;varList.push(bindVar);bindCode.push(bindVar+"=bind_attr("+[domRef,attrName,bindVar,buildAttrExpression(binding)]+");")}continue}if(!bindMap[bindName]){bindCode=bindMap[bindName]=[];varList.push(varName)}if(bindType!=TYPE_ATTRIBUTE){var bindFunction=bindFunctions[bindType];varList.push(bindVar+"="+domRef);toolsUsed[bindFunction]=true;bindCode.push(bindVar+"="+bindFunction+"("+[domRef,bindVar]+",value);")}else{var attrName=binding[ATTR_NAME];switch(attrName){case"class":var defaultExpr="";var valueExpr="value";var prefix=binding[4];if(binding.length>=6){if(binding.length==6||typeof binding[6]=="string"){if(binding.length==6){valueExpr='value?"'+bindName+'":""';if(binding[5])defaultExpr=prefix+bindName}else{prefix="";valueExpr='value?"'+binding[6]+'":""';if(binding[5])defaultExpr=binding[6]}}else{if(binding.length==7){valueExpr=binding[6].map(function(val){return'value=="'+val+'"'}).join("||");if(!valueExpr)continue;valueExpr+='?value:""';if(binding[5])defaultExpr=prefix+binding[6][binding[5]-1]}else{prefix="";valueExpr=[];var values=binding[6];for(var jj=0;jj<values.length;jj++)valueExpr.push('value=="'+values[jj]+'"?"'+binding[7][jj]+'"');if(!valueExpr.length)continue;valueExpr.push('""');valueExpr=valueExpr.join(":");if(binding[5])defaultExpr=binding[7][binding[5]-1]}}}varList.push(bindVar+'="'+defaultExpr+'"');toolsUsed.bind_attrClass=true;bindCode.push(bindVar+"=bind_attrClass("+[domRef,bindVar,valueExpr,'"'+prefix+'"']+(anim?",1":"")+");");break;case"style":varList.push(bindVar+'=""');toolsUsed.bind_attrStyle=true;bindCode.push(bindVar+"=bind_attrStyle("+[domRef,'"'+binding[6]+'"',bindVar,buildAttrExpression(binding)]+");");break;default:varList.push(bindVar+"="+buildAttrExpression(binding,true));toolsUsed.bind_attr=true;bindCode.push(bindVar+"=bind_attr("+[domRef,'"'+attrName+'"',bindVar,buildAttrExpression(binding)]+");");specialAttr=SPECIAL_ATTR_MAP[attrName];if(specialAttr){if(specialAttr===true||specialAttr.has(binding[6].toLowerCase())){bindCode.push(domRef+"."+attrName+"="+bindVar+";")}}}}}result.push("function set(bindName,value){\n"+"value=resolve(attaches,updateAttach,bindName,value);"+"switch(bindName){");for(var bindName in bindMap)result.push('case"'+bindName+'":\n'+(bindMap[bindName].l10n?bindMap[bindName].join("\n"):"if(__"+bindName+"!==value)"+"{"+"__"+bindName+"=value;\n"+bindMap[bindName].join("\n")+"}")+"break;");result.push("}}");for(var key in toolsUsed)varList.push(key+"=tools."+key);return{vars:varList,l10n:l10nMap,getBinding:getBindingFactory(bindMap),body:result.join("")}}function resolveValue(attaches,updateAttach,bindingName,value){var bridge=value&&value.bindingBridge;var oldAttach=attaches[bindingName];if(bridge||oldAttach){if(bridge){if(value!==oldAttach){if(oldAttach)oldAttach.bindingBridge.detach(oldAttach,updateAttach,bindingName);bridge.attach(value,updateAttach,bindingName);attaches[bindingName]=value}value=bridge.get(value)}else{if(oldAttach){oldAttach.bindingBridge.detach(oldAttach,updateAttach,bindingName);delete attaches[bindingName]}}}return value}var tools={bind_textNode:bind_textNode,bind_node:bind_node,bind_element:bind_element,bind_comment:bind_comment,bind_attr:bind_attr,bind_attrClass:bind_attrClass,bind_attrStyle:bind_attrStyle,resolve:resolveValue,l10nToken:basis.l10n.getToken};return function(tokens){var pathes=buildPathes(tokens,"_");var bindings=buildBindings(pathes.binding);var proto=buildHtml(tokens);var templateMap={};var l10nMap;if(bindings.l10n){l10nMap={};var code=[];for(var key in bindings.l10n)code.push('case"'+key+'":\n'+'if(value==null)value="{'+key+'}";'+"__l10n[token]=value;"+bindings.l10n[key].join(";")+"break;");var l10nProtoUpdate=new Function("_","__l10n","bind_attr","var "+pathes.path+";return function(token, value){"+"switch(token){"+code.join("")+"}"+"}");l10nProtoUpdate=l10nProtoUpdate(proto,l10nMap,bind_attr);for(var key in bindings.l10n)l10nProtoUpdate(key,basis.l10n.getToken(key).value)}var build=function(){return proto.cloneNode(true)};var objectRefs=pathes.objectRefList;for(var i=0,ref;ref=objectRefs[i];i++)objectRefs[i]+=".basisObjectId";objectRefs=objectRefs.join("=");var fnBody;var createInstance=new Function("gMap","tMap","build","tools","__l10n",fnBody="return function createInstance_(obj,actionCallback,updateCallback){"+"var id=gMap.seed++,attaches={},resolve=tools.resolve,_=build(),"+pathes.path.concat(bindings.vars)+";\n"+(objectRefs?"if(obj)gMap["+objectRefs+"=id]=obj;\n":"")+"function updateAttach(){set(String(this),attaches[this])};\n"+bindings.body+";return tMap[id]={"+[pathes.ref,"set:set,rebuild:function(){if(updateCallback)updateCallback.call(obj)},"+"destroy:function(){"+"for(var key in attaches)if(attaches[key])attaches[key].bindingBridge.detach(attaches[key],updateAttach,key);"+"attaches=null;"+"delete tMap[id];"+"delete gMap[id];"+"}"]+"}"+"}");createInstance=createInstance(tmplNodeMap,templateMap,build,tools,l10nMap);return{createInstance:createInstance,getBinding:bindings.getBinding,l10nProtoUpdate:l10nProtoUpdate,l10n:bindings.l10n,map:templateMap}}}();function createEventHandler(attrName){return function(event){if(event&&event.type=="click"&&event.which==3)return;var cursor=domEvent.sender(event);var attr;var refId;if(!cursor)return;do{if(attr=cursor.getAttributeNode&&cursor.getAttributeNode(attrName))break}while(cursor=cursor.parentNode);if(!cursor||!attr)return;do{if(refId=cursor.basisObjectId){var node=tmplNodeMap[refId];if(node&&node.templateAction){var actions=attr.nodeValue.qw();for(var i=0,actionName;actionName=actions[i++];)node.templateAction(actionName,domEvent(event));break}}}while(cursor=cursor.parentNode)}}var buildHtml=function(tokens){var result=document.createDocumentFragment();var attrs;var childs;var element;for(var i=0,token;token=tokens[i];i++){switch(token[TOKEN_TYPE]){case TYPE_ELEMENT:var tagName=token[ELEMENT_NAME];var parts=tagName.split(/:/);element=parts.length>1?document.createElementNS(namespaceURI[parts[0]],tagName):document.createElement(tagName);if(attrs=token[ELEMENT_ATTRS])for(var j=0,attr;attr=attrs[j];j++){var attrName=attr[ATTR_NAME];var m;element.setAttribute(attrName,attr[ATTR_VALUE]);if(m=attrName.match(eventAttr)){var eventName=m[1];if(!tmplEventListeners[eventName]){tmplEventListeners[eventName]=createEventHandler(attrName);for(var k=0,names=domEvent.browserEvents(eventName),browserEventName;browserEventName=names[k++];)domEvent.addGlobalHandler(browserEventName,tmplEventListeners[eventName])}if(!domEvent.W3CSUPPORT){var eventInfo=domEvent.getEventInfo(eventName,tagName);if(eventInfo.supported&&!eventInfo.bubble)element.attachEvent("on"+eventName,function(eventName){return function(){domEvent.fireEvent(document,eventName)}}(eventName))}}}if(childs=token[ELEMENT_CHILDS])element.appendChild(buildHtml(childs));result.appendChild(element);break;case TYPE_COMMENT:result.appendChild(document.createComment(token[COMMENT_VALUE]||(token[TOKEN_REFS]?"{"+token[TOKEN_REFS].join("|")+"}":"")));break;case TYPE_TEXT:if(CLONE_NORMALIZE_TEXT_BUG&&i&&tokens[i-1][TOKEN_TYPE]==TYPE_TEXT)result.appendChild(document.createComment(""));result.appendChild(document.createTextNode(token[TEXT_VALUE]||(token[TOKEN_REFS]?"{"+token[TOKEN_REFS].join("|")+"}":"")));break}}return result};var usableResources={".css":true};function isUsableResource(path){var ext=path.match(/(\.[a-z0-9\-\_]+)+$/);return ext&&usableResources[ext[0]]}function startUseResource(url){if(isUsableResource(url))basis.resource(url)().startUse()}function stopUseResource(url){if(isUsableResource(url))basis.resource(url)().stopUse()}function templateSourceUpdate(){if(this.instances_)buildTemplate.call(this);for(var i=0,attach;attach=this.attaches_[i];i++)attach.handler.call(attach.context)}function cloneDecl(array){var result=[];for(var i=0;i<array.length;i++){result.push(Array.isArray(array[i])?cloneDecl(array[i]):array[i])}return result}function getDeclFromTemplate(template,clone){var source=typeof template.source=="function"?template.source():String(template.source);if(typeof source=="string")return template.isDecl?source.toObject():makeDeclaration(source,template.baseURI);else return Array.isArray(source)?{tokens:clone?cloneDecl(source):source}:source}function buildTemplate(){var decl=getDeclFromTemplate(this);var instances=this.instances_;var funcs=makeFunctions(decl.tokens);var l10n=this.l10n_;var deps=this.deps_;if(deps){this.deps_=null;for(var i=0,dep;dep=deps[i];i++)dep.bindingBridge.detach(dep,buildTemplate,this)}if(decl.deps&&decl.deps.length){deps=decl.deps;this.deps_=deps;for(var i=0,dep;dep=deps[i];i++)dep.bindingBridge.attach(dep,buildTemplate,this)}if(l10n){this.l10n_=null;for(var i=0,link;link=l10n[i];i++)link.token.detach(link.handler,link)}this.createInstance=funcs.createInstance;this.getBinding=funcs.getBinding;this.instances_=funcs.map;var l10nProtoUpdate=funcs.l10nProtoUpdate;var hasResources=decl.resources&&decl.resources.length>0;if(hasResources)for(var i=0,res;res=decl.resources[i];i++)startUseResource(res);if(this.resources)for(var i=0,res;res=this.resources[i];i++)stopUseResource(res);this.resources=hasResources&&decl.resources;if(instances){for(var id in instances)instances[id].rebuild()}if(funcs.l10n){l10n=[];this.l10n_=l10n;instances=funcs.map;for(var key in funcs.l10n){var link={path:key,token:basis.l10n.getToken(key),handler:function(value){l10nProtoUpdate(this.path,value);for(var id in instances)instances[id].set(this.path,value)}};link.token.attach(link.handler,link);l10n.push(link)}}}function sourceById(sourceId){var host=document.getElementById(sourceId);if(host&&host.tagName=="SCRIPT"){var content=host.textContent||host.text;switch(host.type){case"text/basis-template":default:return content}}}function resolveSourceById(sourceId){return function(){return sourceById(sourceId)}}var Template=Class(null,{className:namespace+".Template",__extend__:function(value){if(value instanceof Template)return value;else return new Template(value)},baseURI:"",init:function(templateSource){this.attaches_=[];this.setSource(templateSource);this.templateId=templateList.push(this)-1},bindingBridge:{attach:function(template,handler,context){for(var i=0,listener;listener=template.attaches_[i];i++){if(listener.handler==handler&&listener.context==context)return false}template.attaches_.push({handler:handler,context:context});return true},detach:function(template,handler,context){for(var i=0,listener;listener=template.attaches_[i];i++)if(listener.handler==handler&&listener.context==context){template.attaches_.splice(i,1);return true}return false},get:function(template){return"?"}},createInstance:function(node,ac,uc){buildTemplate.call(this);return this.createInstance(node,ac,uc)},clearInstance:function(object,node){object.destroy()},getBinding:function(bindings){buildTemplate.call(this);return this.getBinding(bindings)},setSource:function(source){var oldSource=this.source;if(oldSource!=source){this.isDecl=false;if(typeof source=="string"){var m=source.match(/^([a-z]+):/);if(m){var prefix=m[1];source=source.substr(m[0].length);switch(prefix){case"file":source=basis.resource(source);break;case"id":source=resolveSourceById(source);case"tokens":this.isDecl=true;case"raw":break;default:}}}if(oldSource&&oldSource.bindingBridge){var tmplList=oldSource.url&&tmplFilesMap[oldSource.url];if(tmplList){tmplList.remove(this);if(!tmplList.length)delete tmplFilesMap[oldSource.url]}this.baseURI="";this.source.bindingBridge.detach(oldSource,templateSourceUpdate,this)}if(source&&source.bindingBridge){if(source.url){this.baseURI=dirname(source.url);if(!tmplFilesMap[source.url])tmplFilesMap[source.url]=[];tmplFilesMap[source.url].add(this)}source.bindingBridge.attach(source,templateSourceUpdate,this)}this.source=source;templateSourceUpdate.call(this)}}});Cleaner.add({destroy:function(){for(var i=0,template;template=templateList[i];i++){for(var key in template.instances_)template.instances_[key].destroy();template.createInstance=null;template.getBinding=null;template.instances_=null;template.resources=null;template.l10n_=null;template.source=null}templateList=null}});module.exports={TYPE_ELEMENT:TYPE_ELEMENT,TYPE_ATTRIBUTE:TYPE_ATTRIBUTE,TYPE_TEXT:TYPE_TEXT,TYPE_COMMENT:TYPE_COMMENT,TOKEN_TYPE:TOKEN_TYPE,TOKEN_BINDINGS:TOKEN_BINDINGS,TOKEN_REFS:TOKEN_REFS,ATTR_NAME:ATTR_NAME,ATTR_VALUE:ATTR_VALUE,ELEMENT_NAME:ELEMENT_NAME,ELEMENT_ATTRS:ELEMENT_ATTRS,ELEMENT_CHILDS:ELEMENT_CHILDS,TEXT_VALUE:TEXT_VALUE,COMMENT_VALUE:COMMENT_VALUE,Template:Template,tokenize:tokenize,makeDeclaration:makeDeclaration,buildPathes:buildPathes,makeFunctions:makeFunctions,buildHtml:buildHtml,resolveObjectById:function(refId){return tmplNodeMap[refId]}}}],
// ../../../src/basis/html.js
["basis.html", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var dom=basis.dom;var Template=basis.template.Template;function escape(html){return dom.createElement("div",dom.createText(html)).innerHTML}var unescapeElement=document.createElement("div");function unescape(escapedHtml){unescapeElement.innerHTML=escapedHtml;return unescapeElement.firstChild.nodeValue}function string2Html(text){unescapeElement.innerHTML=text;return dom.createFragment.apply(null,Array.from(unescapeElement.childNodes))}module.exports={Template:Template,escape:escape,unescape:unescape,string2Html:string2Html}}],
// ../../../src/basis/ui.js
["basis.ui", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var Class=basis.Class;var DOM=basis.dom;var cssom=basis.cssom;var Template=basis.template.Template;var classList=basis.cssom.classList;var getter=Function.getter;var createEvent=basis.event.create;var DWNode=basis.dom.wrapper.Node;var DWPartitionNode=basis.dom.wrapper.PartitionNode;var DWGroupingNode=basis.dom.wrapper.GroupingNode;var bindingSeed=1;function extendBinding(binding,extension){binding.bindingId=bindingSeed++;for(var key in extension){var def=null;var value=extension[key];if(!value)def=null;else{value=BINDING_PRESET.process(key,value);if(typeof value!="object")def={getter:getter(value)};else if(Array.isArray(value))def={getter:getter(value[0]),events:value[1]};else{def={getter:getter(value.getter),l10n:!!value.l10n,l10nProxy:value.l10nProxy,events:value.events}}}def.update=function(node){return node.tmpl.set(key,this.getter(node))};binding[key]=def}}var BINDING_PRESET=function(){var presets={};var prefixRegExp=/^([a-z\_][a-z0-9\_]*)\:(.*)/i;return{add:function(prefix,func){if(!presets[prefix])presets[prefix]=func},process:function(key,value){var preset;if(typeof value=="string"){var m=value.match(prefixRegExp);if(m){preset=presets[m[1]];value=m[2]||key}}return preset?preset(value):value}}}();BINDING_PRESET.add("data",function(path){return["data."+path,"update"]});BINDING_PRESET.add("satellite",function(satelliteName){return{events:"satelliteChanged",getter:function(node){return node.satellite[satelliteName]?node.satellite[satelliteName].element:null}}});BINDING_PRESET.add("l10n",function(token){return Function.$const(basis.l10n.getToken(token))});BINDING_PRESET.add("resource",function(url){return Function.$const(basis.resource(url))});var TEMPLATE_BINDING=Class.customExtendProperty({selected:{events:"select unselect",getter:function(node){return node.selected?"selected":""}},unselected:{events:"select unselect",getter:function(node){return node.selected?"":"unselected"}},disabled:{events:"disable enable",getter:function(node){return node.disabled||node.contextDisabled?"disabled":""}},enabled:{events:"disable enable",getter:function(node){return node.disabled||node.contextDisabled?"":"enabled"}},state:{events:"stateChanged",getter:"state"},childCount:{events:"childNodesModified",getter:function(node){return node.childNodes?node.childNodes.length:0}},hasChildren:{events:"childNodesModified",getter:function(node){return!!node.firstChild?"hasChildren":""}},empty:{events:"childNodesModified",getter:function(node){return!node.firstChild?"empty":""}}},extendBinding);var EMPTY_TEMPLATE_ACTION=Class.extensibleProperty();var EMPTY_TEMPLATE=new Template("<div/>");var TemplateMixin=function(super_){return{template:EMPTY_TEMPLATE,tmpl:null,action:EMPTY_TEMPLATE_ACTION,binding:TEMPLATE_BINDING,id:null,cssClassName:null,focusable:true,event_templateChanged:createEvent("templateChanged"),event_templateUpdate:createEvent("templateUpdate"),event_update:function(delta){this.templateUpdate(this.tmpl,"update",delta);super_.event_update.call(this,delta)},event_match:function(){super_.event_match.call(this);cssom.display(this.element,true)},event_unmatch:function(){super_.event_unmatch.call(this);cssom.display(this.element,false)},init:function(){var template=this.template;if(template){this.template=null;this.setTemplate(template)}super_.init.call(this)},postInit:function(){super_.postInit.call(this);if(this.template){this.templateSync(true);if(this.container){DOM.insert(this.container,this.element);this.container=null}}},templateSync:function(noRecreate){var template=this.template;var binding=template.getBinding(this.binding,this)||null;var oldBinding=this.templateBinding_;var tmpl=this.tmpl;var oldElement=this.element;if(binding!==oldBinding){if(oldBinding&&oldBinding.handler)this.removeHandler(oldBinding.handler);if(!noRecreate){if(this.tmpl)this.tmpl.destroy();tmpl=template.createInstance(this,this.templateAction,this.templateSync);if(tmpl.childNodesHere){tmpl.childNodesElement=tmpl.childNodesHere.parentNode;tmpl.childNodesElement.insertPoint=tmpl.childNodesHere}this.tmpl=tmpl;this.element=tmpl.element;this.childNodesElement=tmpl.childNodesElement||tmpl.element;if(!this.childNodesElement||this.childNodesElement.nodeType!=1){this.childNodesElement=document.createDocumentFragment()}}if(this.content){if(this.content instanceof basis.l10n.Token){var token=this.content;var textNode=DOM.createText(token.value);var handler=function(value){this.nodeValue=value};token.attach(handler,textNode);this.addHandler({destroy:function(){token.detach(handler,textNode)}});DOM.insert(tmpl.content||tmpl.element,textNode)}else DOM.insert(tmpl.content||tmpl.element,this.content)}if(this.id)tmpl.element.id=this.id;var cssClassNames=this.cssClassName;if(cssClassNames){if(typeof cssClassNames=="string")cssClassNames={element:cssClassNames};for(var alias in cssClassNames){var node=tmpl[alias];if(node){var nodeClassName=classList(node);var names=String(cssClassNames[alias]).qw();for(var i=0,name;name=names[i++];)nodeClassName.add(name)}}}this.templateUpdate(this.tmpl);if(binding&&binding.names.length){if(binding.handler)this.addHandler(binding.handler);binding.sync.call(this)}if(this instanceof PartitionNode){var nodes=this.nodes;if(nodes)for(var i=nodes.length;i-->0;){var child=nodes[i];child.parentNode.insertBefore(child,child.nextSibling)}}else for(var child=this.lastChild;child;child=child.previousSibling)this.insertBefore(child,child.nextSibling);if(oldElement&&this.element&&oldElement!==this.element){var parentNode=oldElement&&oldElement.parentNode;if(parentNode)parentNode.replaceChild(this.element,oldElement);this.event_templateChanged()}this.templateBinding_=binding}},setTemplate:function(template){if(template instanceof Template==false)template=null;if(this.template!==template){var tmpl;var oldTemplate=this.template;var oldElement=this.element;if(oldTemplate){oldTemplate.clearInstance(this.tmpl,this);var oldBinding=oldTemplate.getBinding(this.binding,this);if(oldBinding&&oldBinding.handler)this.removeHandler(oldBinding.handler);this.templateBinding_=null}this.template=template;if(template){tmpl=template.createInstance(this,this.templateAction,this.templateSync);if(tmpl.childNodesHere){tmpl.childNodesElement=tmpl.childNodesHere.parentNode;tmpl.childNodesElement.insertPoint=tmpl.childNodesHere}this.tmpl=tmpl;this.element=tmpl.element;this.childNodesElement=tmpl.childNodesElement||tmpl.element;if(!this.childNodesElement||this.childNodesElement.nodeType!=1){this.childNodesElement=document.createDocumentFragment()}if(oldTemplate)this.templateSync(true)}else{this.tmpl=null;this.element=null;this.childNodesElement=null}if(oldElement&&!this.element){var parentNode=oldElement&&oldElement.parentNode;if(parentNode&&parentNode.nodeType==DOM.ELEMENT_NODE)parentNode.removeChild(oldElement)}}},updateBind:function(bindName){var binding=this.binding[bindName];var getter=binding&&binding.getter;if(getter&&this.tmpl)this.tmpl.set(bindName,getter(this))},templateAction:function(actionName,event){var action=this.action[actionName];if(action)action.call(this,event)},templateUpdate:function(tmpl,eventName,delta){},focus:function(select){if(this.focusable){var focusElement=this.tmpl.focus||this.element;if(focusElement)setImmediate(function(){DOM.focus(focusElement,select)})}},blur:function(){if(this.focusable){var focusElement=this.tmpl.focus||this.element;if(focusElement)focusElement.blur()}},destroy:function(){super_.destroy.call(this);this.setTemplate()}}};var ContainerTemplateMixin=function(super_){return{insertBefore:function(newChild,refChild){newChild=super_.insertBefore.call(this,newChild,refChild);var target=newChild.groupNode||this;var container=target.childNodesElement||target.element||this.childNodesElement||this.element;var nextSibling=newChild.nextSibling;var insertPoint=nextSibling&&nextSibling.element.parentNode==container?nextSibling.element:null;var element=newChild.element;var refNode=insertPoint||container.insertPoint||null;if(element.parentNode!==container||element.nextSibling!==refNode)container.insertBefore(element,refNode);return newChild},removeChild:function(oldChild){super_.removeChild.call(this,oldChild);var element=oldChild.element;var parent=element.parentNode;if(parent)parent.removeChild(element);return oldChild},clear:function(alive){if(alive){var node=this.firstChild;while(node){var element=node.element;var parent=element.parentNode;if(parent)parent.removeChild(element);node=node.nextSibling}}super_.clear.call(this,alive)},setChildNodes:function(childNodes,keepAlive){var domFragment=DOM.createFragment();var target=this.grouping||this;var container=target.childNodesElement||target.element;target.childNodesElement=domFragment;super_.setChildNodes.call(this,childNodes,keepAlive);container.insertBefore(domFragment,container.insertPoint||null);target.childNodesElement=container}}};var PartitionNode=Class(DWPartitionNode,TemplateMixin,{className:namespace+".PartitionNode",binding:{title:"data:"}});var GroupingNode=Class(DWGroupingNode,ContainerTemplateMixin,{className:namespace+".GroupingNode",childClass:PartitionNode,groupingClass:Class.SELF,event_ownerChanged:function(oldOwner){this.syncDomRefs();DWGroupingNode.prototype.event_ownerChanged.call(this,oldOwner)},listen:{owner:{templateChanged:function(){this.syncDomRefs();for(var child=this.lastChild;child;child=child.previousSibling)this.insertBefore(child,child.nextSibling)}}},init:function(){this.nullElement=DOM.createFragment();this.element=this.childNodesElement=this.nullElement;DWGroupingNode.prototype.init.call(this)},syncDomRefs:function(){var cursor=this;var owner=this.owner;var element=null;if(owner){element=owner.tmpl&&owner.tmpl.groupsElement||owner.childNodesElement||owner.element;element.appendChild(this.nullElement)}do{cursor.element=cursor.childNodesElement=element}while(cursor=cursor.grouping)}});var Node=Class(DWNode,TemplateMixin,ContainerTemplateMixin,{className:namespace+".Node",childClass:Class.SELF,childFactory:function(config){return new this.childClass(config)},groupingClass:GroupingNode});module.exports={BINDING_PRESET:BINDING_PRESET,Node:Node,Container:Node,PartitionNode:PartitionNode,GroupingNode:GroupingNode}}],
// ../../../src/basis/layout.js
["basis.layout", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var document=global.document;var defaultView=document.defaultView;var Class=basis.Class;var DOM=basis.dom;var Event=basis.dom.event;var Browser=basis.ua;var extend=Object.extend;var cssom=basis.cssom;var classList=basis.cssom.classList;var nsWrappers=DOM.wrapper;var UIContainer=basis.ui.Container;var IS_IE=Browser.test("IE");var IS_IE7_UP=Browser.test("IE7+");var SUPPORT_DISPLAYBOX=false;var testElement=DOM.createElement("");var prefixes=["","-webkit-"];for(var i=0;i<prefixes.length;i++){try{var value=prefixes[i]+"box";testElement.style.display=value;if(testElement.style.display==value){SUPPORT_DISPLAYBOX=prefixes[i];break}}catch(e){}}var SUPPORT_ONRESIZE=typeof testElement.onresize!="undefined";var SUPPORT_COMPUTESTYLE=defaultView&&defaultView.getComputedStyle;function getComputedProperty(element,what){if(SUPPORT_COMPUTESTYLE)try{return parseFloat(defaultView.getComputedStyle(element,null)[what])}catch(e){return 0}else return 0}function getHeight(element,ruller){if(SUPPORT_COMPUTESTYLE){return getComputedProperty(element,"height")}else{cssom.setStyle(ruller,{borderTop:element.currentStyle.borderTopWidth+" solid red",borderBottom:element.currentStyle.borderBottomWidth+" solid red",paddingTop:element.currentStyle.paddingTop,paddingBottom:element.currentStyle.paddingBottom,fontSize:.01,height:0,overflow:"hidden"});return element.offsetHeight-ruller.offsetHeight}}function addBlockResizeHandler(element,handler){if(SUPPORT_ONRESIZE){classList(element).add("Basis-Layout-OnResizeElement");element.onresize=handler}else{var iframe=DOM.createElement({description:"IFRAME.Basis-Layout-OnResizeFrame",css:{position:"absolute",width:"100%",height:"100%",border:"none",left:0,zIndex:-1,top:"-2000px"}});DOM.insert(element,iframe);iframe.onload=function(){(iframe.contentWindow.onresize=handler)()}}}var Helper=function(){return DOM.createElement({css:{position:"absolute",top:0,left:0,width:0,height:0,padding:0,margin:0,border:0}})};Helper.className="basis.Layout.Helper";var BOX_UNDEFINED={top:Number.NaN,left:Number.NaN,bottom:Number.NaN,right:Number.NaN,width:Number.NaN,height:Number.NaN,defined:false};var Box=Class(null,{className:namespace+".Box",init:function(element,woCalc,offsetElement){this.reset();this.setElement(element,woCalc,offsetElement)},setElement:function(element,woCalc,offsetElement){this.element=DOM.get(element);this.offsetElement=offsetElement;if(!woCalc)this.recalc(this.offsetElement)},copy:function(box){["top","left","bottom","right","height","width","defined"].forEach(function(prop){this[prop]=box[prop]},this)},reset:function(){extend(this,BOX_UNDEFINED)},set:function(property,value){if(this.defined){switch(property.toLowerCase()){case"left":this.left=value;this.right=this.left+this.width;break;case"right":this.right=value;this.left=this.right-this.width;break;case"width":this.width=value;this.right=this.left+this.width;break;case"top":this.top=value;this.bottom=this.top+this.height;break;case"bottom":this.bottom=value;this.top=this.bottom-this.height;break;case"height":this.height=value;this.bottom=this.top+this.height;break}if(this.width<=0||this.height<=0)this.reset()}return this},recalc:function(offsetElement){this.reset();var element=this.element;if(element){var offsetParent=element;var documentElement=document.documentElement;if(element.getBoundingClientRect){var box=element.getBoundingClientRect();this.top=box.top;this.left=box.left;if(IS_IE){if(IS_IE7_UP){this.top+=documentElement.scrollTop-documentElement.clientTop;this.left+=documentElement.scrollLeft-documentElement.clientLeft}else if(element!=document.body){this.top-=document.body.clientTop-document.body.scrollTop;this.left-=document.body.clientLeft-document.body.scrollLeft}}if(offsetElement){var relBox=new Box(offsetElement);this.top-=relBox.top;this.left-=relBox.left;relBox.destroy()}}else if(document.getBoxObjectFor){var oPageBox=document.getBoxObjectFor(documentElement);var box=document.getBoxObjectFor(element);this.top=box.screenY-oPageBox.screenY;this.left=box.screenX-oPageBox.screenX;if(Browser.test("FF1.5-")){offsetParent=element.offsetParent;if(offsetParent){this.top-=offsetParent.scrollTop;this.left-=offsetParent.scrollLeft}if(offsetParent!=document.body){this.top+=documentElement.scrollTop;this.left+=documentElement.scrollLeft}}if(Browser.test("FF2+")){if(this.top){var top=documentElement.scrollTop;if(top>2){var end=0;for(var k=Math.floor(Math.log(top)/Math.LN2);k>=0;k-=3)end+=1<<k;if(top>end)this.top-=1}}if(this.left)this.left-=documentElement.scrollLeft>1}if(offsetElement){var relBox=new Box(offsetElement);this.top-=relBox.top;this.left-=relBox.left;relBox.destroy()}}else{if(element!=offsetElement){this.top=element.offsetTop;this.left=element.offsetLeft;this.top-=document.body.clientTop-document.body.scrollTop;this.left-=document.body.clientLeft-document.body.scrollLeft;while((offsetParent=offsetParent.offsetParent)&&offsetParent!=offsetElement){this.top+=offsetParent.offsetTop+offsetParent.clientTop-offsetParent.scrollTop;this.left+=offsetParent.offsetLeft+offsetParent.clientLeft-offsetParent.scrollLeft}}else this.top=this.left=0}this.width=element.offsetWidth;this.height=element.offsetHeight;{this.bottom=this.top+this.height;this.right=this.left+this.width;this.defined=true}}return this.defined},intersection:function(box){if(!this.defined)return false;if(box instanceof Box==false)box=new Box(box);return box.defined&&box.right>this.left&&box.left<this.right&&box.bottom>this.top&&box.top<this.bottom},inside:function(box){if(!this.defined)return false;if(box instanceof Box==false)box=new Box(box);return box.defined&&box.left>=this.left&&box.right<=this.right&&box.bottom>=this.bottom&&box.top<=this.top},point:function(point){if(!this.defined)return false;var x=point.left||point.x||0;var y=point.top||point.y||0;return x>=this.left&&x<this.right&&y>=this.top&&y<this.bottom},power:function(element){if(!this.defined)return false;element=DOM.get(element)||this.element;if(element){cssom.setStyle(element,{top:this.top+"px",left:this.left+"px",width:this.width+"px",height:this.height+"px"});return true}},destroy:function(){delete this.element}});var Intersection=Class(Box,{className:namespace+".Intersection",init:function(boxA,boxB,bWoCalc){this.setBoxes(boxA,boxB,bWoCalc)},setBoxes:function(boxA,boxB,bWoCalc){this.boxA=boxA instanceof Box?boxA:new Box(boxA,true);this.boxB=boxB instanceof Box?boxB:new Box(boxB,true);if(!bWoCalc)this.recalc()},recalc:function(){this.reset();if(!this.boxA.recalc()||!this.boxB.recalc())return false;if(this.boxA.intersection(this.boxB)){this.top=Math.max(this.boxA.top,this.boxB.top);this.left=Math.max(this.boxA.left,this.boxB.left);this.bottom=Math.min(this.boxA.bottom,this.boxB.bottom);this.right=Math.min(this.boxA.right,this.boxB.right);this.width=this.right-this.left;this.height=this.bottom-this.top;if(this.width<=0||this.height<=0)this.reset();else this.defined=true}return this.defined}});var Viewport=Class(Box,{className:namespace+".Viewport",recalc:function(){this.reset();var element=this.element;if(element){var offsetParent=element;this.width=element.clientWidth;this.height=element.clientHeight;if(element.getBoundingClientRect){var box=element.getBoundingClientRect();this.top=box.top;this.left=box.left;while(offsetParent=offsetParent.offsetParent){this.top-=offsetParent.scrollTop;this.left-=offsetParent.scrollLeft}}else if(document.getBoxObjectFor){var box=document.getBoxObjectFor(element);this.top=box.y;this.left=box.x;while(offsetParent=offsetParent.offsetParent){this.top-=offsetParent.scrollTop;this.left-=offsetParent.scrollLeft}}else{var box=new Box(element);this.top=box.top+element.clientTop;this.left=box.left+element.clientLeft}this.bottom=this.top+this.height;this.right=this.left+this.width;this.defined=true}return this.defined}});var stackPanelId=0;var VerticalPanelRule=cssom.createRule(".Basis-VerticalPanel");VerticalPanelRule.setStyle({position:"relative"});var VerticalPanelStackRule=cssom.createRule(".Basis-VerticalPanelStack");VerticalPanelStackRule.setStyle({overflow:"hidden"});if(SUPPORT_DISPLAYBOX!==false){VerticalPanelStackRule.setProperty("display",SUPPORT_DISPLAYBOX+"box");VerticalPanelStackRule.setProperty(SUPPORT_DISPLAYBOX+"box-orient","vertical")}var VerticalPanel=Class(UIContainer,{className:namespace+".VerticalPanel",template:'<div class="Basis-VerticalPanel"/>',flex:0,init:function(){UIContainer.prototype.init.call(this);if(this.flex){if(SUPPORT_DISPLAYBOX!==false)cssom.setStyleProperty(this.element,SUPPORT_DISPLAYBOX+"box-flex",this.flex)}else{if(SUPPORT_DISPLAYBOX===false){addBlockResizeHandler(this.element,function(){if(this.parentNode)this.parentNode.realign()}.bind(this))}}}});var VerticalPanelStack=Class(UIContainer,{className:namespace+".VerticalPanelStack",childClass:VerticalPanel,template:'<div class="Basis-VerticalPanelStack">'+(SUPPORT_DISPLAYBOX?"":'<div{ruller} style="position: absolute; visibility: hidden; top: -1000px; width: 10px;"/>')+"</div>",init:function(){this.cssRule=cssom.uniqueRule();this.ruleClassName=this.cssRule.token;this.cssRule.setProperty("overflow","auto");UIContainer.prototype.init.call(this);if(SUPPORT_DISPLAYBOX===false){this.realign();addBlockResizeHandler(this.childNodesElement,function(){this.realign()}.bind(this))}},insertBefore:function(newChild,refChild){if(newChild=UIContainer.prototype.insertBefore.call(this,newChild,refChild)){if(newChild.flex&&this.cssRule)classList(newChild.element).add(this.ruleClassName);this.realign();return newChild}},removeChild:function(oldChild){if(UIContainer.prototype.removeChild.call(this,oldChild)){if(oldChild.flex&&this.cssRule)classList(oldChild.element).remove(this.ruleClassName);this.realign();return oldChild}},realign:function(){if(SUPPORT_DISPLAYBOX!==false)return;var element=this.element;var lastElement=this.lastChild.element;var ruller=this.tmpl.ruller;var lastBox=new Box(lastElement,false,element);var bottom=lastBox.bottom-getComputedProperty(element,"paddingTop")-getComputedProperty(element,"borderTopWidth")||0;var height=getHeight(element,ruller);if(!SUPPORT_COMPUTESTYLE){var _height=ruller.offsetHeight;ruller.style.height=lastElement.currentStyle.marginBottom;bottom+=ruller.offsetHeight-_height}else{bottom+=getComputedProperty(lastElement,"marginBottom")}var delta=height-bottom;if(!delta)return;var flexNodeCount=0;var flexHeight=delta;for(var i=0,node;node=this.childNodes[i];i++){if(node.flex){flexNodeCount++;flexHeight+=getHeight(node.element,ruller)}}if(flexNodeCount)this.cssRule.setProperty("height",Math.max(0,flexHeight/flexNodeCount)+"px")},destroy:function(){UIContainer.prototype.destroy.call(this);this.cssRule.destroy();this.cssRule=null}});module.exports={Box:Box,Intersection:Intersection,Viewport:Viewport,VerticalPanel:VerticalPanel,VerticalPanelStack:VerticalPanelStack,Helper:Helper,addBlockResizeHandler:addBlockResizeHandler}}],
// ../../../src/basis/dragdrop.js
["basis.dragdrop", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var Event=basis.dom.event;var DOM=basis.dom;var Cleaner=basis.Cleaner;var getter=Function.getter;var classList=basis.cssom.classList;var addGlobalHandler=Event.addGlobalHandler;var removeGlobalHandler=Event.removeGlobalHandler;var EventObject=basis.event.EventObject;var createEvent=basis.event.create;var nsWrappers=basis.dom.wrapper;var nsLayout=basis.layout;var ua=basis.ua;var SELECTSTART_SUPPORTED=Event.getEventInfo("selectstart").supported;var DDEConfig;var DDEHandler={start:function(event){if(DDEConfig)DDEHandler.over();DDEConfig={dde:this,run:false,event:{initX:Event.mouseX(event),initY:Event.mouseY(event),deltaX:0,deltaY:0}};addGlobalHandler("mousemove",DDEHandler.move,DDEConfig);addGlobalHandler("mouseup",DDEHandler.over,DDEConfig);addGlobalHandler("mousedown",DDEHandler.over,DDEConfig);if(SELECTSTART_SUPPORTED)addGlobalHandler("selectstart",Event.kill,DDEConfig);Event.cancelDefault(event);this.event_prepare(DDEConfig.event,event)},move:function(event){var dde=DDEConfig.dde;if(!DDEConfig.run){DDEConfig.run=true;dde.draging=true;dde.event_start(DDEConfig.event)}if(dde.axisX)DDEConfig.event.deltaX=dde.axisXproxy(Event.mouseX(event)-DDEConfig.event.initX);if(dde.axisY)DDEConfig.event.deltaY=dde.axisYproxy(Event.mouseY(event)-DDEConfig.event.initY);dde.event_move(DDEConfig.event,event)},over:function(event){var dde=DDEConfig.dde;removeGlobalHandler("mousemove",DDEHandler.move,DDEConfig);removeGlobalHandler("mouseup",DDEHandler.over,DDEConfig);removeGlobalHandler("mousedown",DDEHandler.over,DDEConfig);if(SELECTSTART_SUPPORTED)removeGlobalHandler("selectstart",Event.kill,DDEConfig);dde.draging=false;if(DDEConfig.run)dde.event_over(DDEConfig.event,event);DDEConfig=null;Event.kill(event)}};var DDCssClass={dragable:"Basis-Dragable",element:"Basis-DragDrop-DragElement"};var DragDropElement=Class(EventObject,{className:namespace+".DragDropElement",containerGetter:getter("element"),element:null,trigger:null,baseElement:null,fixTop:true,fixRight:true,fixBottom:true,fixLeft:true,axisX:true,axisY:true,axisXproxy:Function.$self,axisYproxy:Function.$self,event_prepare:createEvent("prepare"),event_start:createEvent("start"),event_move:createEvent("move"),event_over:createEvent("over"),init:function(){EventObject.prototype.init.call(this);var element=this.element;var trigger=this.trigger;this.element=null;this.trigger=null;this.setElement(element,trigger);this.setBase(this.baseElement);Cleaner.add(this)},setElement:function(element,trigger){element=element&&DOM.get(element);trigger=trigger&&DOM.get(trigger)||element;if(this.trigger!=trigger){if(this.trigger)Event.removeHandler(this.trigger,"mousedown",DDEHandler.start,this);this.trigger=trigger;if(this.trigger)Event.addHandler(this.trigger,"mousedown",DDEHandler.start,this)}if(this.element!=element){if(this.element)classList(this.element).remove(DDCssClass.dragable);this.element=element;if(this.element)classList(this.element).add(DDCssClass.dragable)}},setBase:function(baseElement){this.baseElement=DOM.get(baseElement)||(ua.is("IE7-")?document.body:document.documentElement)},isDraging:function(){return!!(DDEConfig&&DDEConfig.dde==this)},start:function(event){if(!this.isDraging())DDEHandler.start.call(this,event)},stop:function(){if(this.isDraging())DDEHandler.over()},destroy:function(){Cleaner.remove(this);this.stop();EventObject.prototype.destroy.call(this);this.setElement();this.setBase()}});var MoveableElement=Class(DragDropElement,{className:namespace+".MoveableElement",event_start:function(config){var element=this.containerGetter(this,config.initX,config.initY);if(element){var box=new nsLayout.Box(element);var viewport=new nsLayout.Viewport(this.baseElement);classList(element).add(DDCssClass.element);config.element=element;config.box=box;config.viewport=viewport}DragDropElement.prototype.event_start.call(this,config)},event_move:function(config){if(!config.element)return;if(this.axisX){var newLeft=config.box.left+config.deltaX;if(this.fixLeft&&newLeft<0)newLeft=0;else if(this.fixRight&&newLeft+config.box.width>config.viewport.width)newLeft=config.viewport.width-config.box.width;config.element.style.left=newLeft+"px"}if(this.axisY){var newTop=config.box.top+config.deltaY;if(this.fixTop&&newTop<0)newTop=0;else if(this.fixBottom&&newTop+config.box.height>config.viewport.height)newTop=config.viewport.height-config.box.height;config.element.style.top=newTop+"px"}DragDropElement.prototype.event_move.call(this,config)},event_over:function(config){if(!config.element)return;classList(config.element).remove(DDCssClass.element);DragDropElement.prototype.event_over.call(this,config)}});module.exports={DragDropElement:DragDropElement,MoveableElement:MoveableElement}}],
// ../../../src/basis/ui/paginator.js
["basis.ui.paginator", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Event=basis.dom.event;var createEvent=basis.event.create;var events=basis.event.events;var Box=basis.layout.Box;var DragDropElement=basis.dragdrop.DragDropElement;var UIContainer=basis.ui.Container;var UINode=basis.ui.Node;function percent(value){return(100*value||0).toFixed(4)+"%"}function updateSelection(paginator){var node=paginator.childNodes.search(paginator.activePage,"pageNumber");if(node)node.select();else paginator.selection.clear()}var PaginatorNode=UINode.subclass({className:namespace+".PaginatorNode",event_pageNumberChanged:createEvent("pageNumberChanged","oldPageNumber"),template:basis.resource("38.tmpl"),binding:{pageNumber:{events:"pageNumberChanged",getter:function(node){return node.pageNumber+1}}},action:{click:function(event){Event.kill(event);if(!this.isDisabled())this.click()}},click:function(){if(this.parentNode)this.parentNode.setActivePage(this.pageNumber)},setPageNumber:function(pageNumber){if(this.pageNumber!=pageNumber){var oldPageNumber=this.pageNumber;this.pageNumber=pageNumber;this.event_pageNumberChanged(oldPageNumber)}}});var DRAGDROP_HANDLER={start:function(sender,config){this.initOffset=this.tmpl.scrollTrumb.offsetLeft},move:function(sender,config){var pos=((this.initOffset+config.deltaX)/this.tmpl.scrollTrumbWrapper.offsetWidth).fit(0,1);this.setSpanStartPage(Math.round(pos*(this.pageCount-this.pageSpan)));this.tmpl.scrollTrumb.style.left=percent(pos)},over:function(sender,config){this.setSpanStartPage(this.spanStartPage_)}};var Paginator=UIContainer.subclass({className:namespace+".Paginator",selection:true,childClass:PaginatorNode,template:basis.resource("39.tmpl"),binding:{noScroll:{events:"pageCountChanged",getter:function(node){return node.pageSpan>=node.pageCount?"noScroll":""}}},action:{jumpTo:function(actionName,event,node){var scrollbar=this.tmpl.scrollbar;var pos=(Event.mouseX(event)-(new Box(scrollbar)).left)/scrollbar.offsetWidth;this.setSpanStartPage(Math.floor(pos*this.pageCount)-Math.floor(this.pageSpan/2))},scroll:function(event){var delta=Event.wheelDelta(event);if(delta)this.setSpanStartPage(this.spanStartPage_+delta)}},event_activePageChanged:createEvent("activePageChanged"),event_pageCountChanged:createEvent("pageCountChanged"),pageSpan:NaN,pageCount:NaN,activePage:NaN,defaultPageSpan:5,defaultPageCount:1,defaultActivePage:0,spanStartPage_:-1,init:function(){UIContainer.prototype.init.call(this);var pageSpan=this.pageSpan||this.defaultPageSpan;var pageCount=this.pageCount||this.defaultPageCount;var activePage=this.activePage||this.defaultActivePage;this.pageSpan=NaN;this.pageCount=NaN;this.activePage=NaN;this.setProperties(pageCount,pageSpan);this.setActivePage(activePage,true);this.scrollbarDD=new DragDropElement({element:this.tmpl.scrollTrumb,handler:DRAGDROP_HANDLER,handlerContext:this})},setProperties:function(pageCount,pageSpan,activePage){pageCount=pageCount||1;pageSpan=Math.min(pageSpan||10,pageCount);if(pageSpan!=this.pageSpan){this.pageSpan=pageSpan;this.setChildNodes(Array.create(pageSpan,function(idx){return{pageNumber:idx}}))}if(this.pageCount!=pageCount){this.pageCount=pageCount;var rangeWidth=1/pageCount;var activePageMarkWidth=rangeWidth/(1-rangeWidth);this.tmpl.activePageMark.style.width=percent(activePageMarkWidth);this.tmpl.activePageMarkWrapper.style.width=percent(1-rangeWidth);this.event_pageCountChanged(this.pageCount)}var spanWidth=pageSpan/pageCount;var scrollTrumbWidth=spanWidth/(1-spanWidth);this.tmpl.scrollTrumbWrapper.style.width=percent(1-spanWidth);this.tmpl.scrollTrumb.style.width=percent(scrollTrumbWidth);this.setSpanStartPage(this.spanStartPage_);this.setActivePage(arguments.length==3?activePage:this.activePage)},setActivePage:function(newActivePage,spotlightActivePage){newActivePage=newActivePage.fit(0,this.pageCount-1);if(newActivePage!=this.activePage){this.activePage=Number(newActivePage);this.event_activePageChanged(newActivePage)}updateSelection(this);this.tmpl.activePageMark.style.left=percent(newActivePage/Math.max(this.pageCount-1,1));if(spotlightActivePage)this.spotlightPage(this.activePage)},spotlightPage:function(pageNumber){this.setSpanStartPage(pageNumber-Math.round(this.pageSpan/2)+1)},setSpanStartPage:function(pageNumber){pageNumber=pageNumber.fit(0,this.pageCount-this.pageSpan);if(pageNumber!=this.spanStartPage_){this.spanStartPage_=pageNumber;for(var i=this.childNodes.length;i-->0;)this.childNodes[i].setPageNumber(pageNumber+i);updateSelection(this)}this.tmpl.scrollTrumb.style.left=percent((pageNumber/Math.max(this.pageCount-this.pageSpan,1)).fit(0,1))},destroy:function(){this.scrollbarDD.destroy();this.scrollbarDD=null;UIContainer.prototype.destroy.call(this)}});module.exports={Paginator:Paginator}}],
// blog.js
["blog", function(basis, module, exports, resource, global, __dirname, __filename){var x=basis.resource("15.js");basis.ready(function(){var statOutElement=basis.dom.createElement("ul");function outStat(){var sdate=times.shift();var timelist=statOutElement;var lasttime=sdate;for(var i=0;i<times.length;i++){var t=times[i];timelist.appendChild(basis.dom.createElement("LI",t[0]-sdate+"ms, self: "+(t[0]-lasttime)+" ["+t[1]+"]"));lasttime=t[0]}basis.dom.insert(timelist,[basis.dom.createElement("B",lasttime-sdate),basis.dom.createElement("SPAN"," ("+(lasttime-firstTime)+")")])}var times=[new Date];var DataObject=basis.data.DataObject;var allPostDataset=new basis.data.Dataset({items:basis.resource("16.json").fetch().map(function(data){data.tags=data.tags.split(/\s*,\s*/);if(data.tags[0]=="")data.tags.shift();return new DataObject({data:data})})});times.push([new Date,"data load"]);var POST_PER_PAGE=15;var blogThreadPage=new basis.data.dataset.Slice({source:allPostDataset,orderDesc:true,limit:POST_PER_PAGE,rule:"data.pubDate"});times.push([new Date,"thread slice"]);var paginator=new basis.ui.paginator.Paginator({pageCount:Math.ceil(allPostDataset.itemCount/POST_PER_PAGE),pageSpan:12,handler:{activePageChanged:function(){blogThreadPage.setRange(this.activePage*POST_PER_PAGE,POST_PER_PAGE)}}});blogThreadPage.addHandler({sourceChanged:function(ds){this.setProperties(ds.source?Math.ceil(ds.source.itemCount/POST_PER_PAGE):0,10,0);this.spotlightPage(0)}},paginator);var postList=new basis.ui.Container({dataSource:blogThreadPage,sorting:"data.pubDate",sortingDesc:true,id:"blog-thread",childClass:{template:basis.resource("17.tmpl"),binding:{id:"data:",title:"data:",content:"data:",category:"data:",pubDate:{events:"update",getter:function(node){return Date.fromISOString(node.data.pubDate).toFormat("%D/%M/%Y %H:%I:%S")}},tagList:"satellite:"},action:{filterByCategory:function(){blogThreadPage.setSource(postByCategory.getSubset(this.data.category))}},satelliteConfig:{tagList:{existsIf:function(owner){return owner.data.tags&&owner.data.tags.length},delegate:Function.$self,instanceOf:basis.ui.Container.subclass({template:basis.resource("18.tmpl"),templateUpdate:function(object,eventName,delta){this.setChildNodes(this.data.tags.map(function(tag){return{data:{title:tag}}}))},childClass:{template:basis.resource("19.tmpl"),binding:{title:"data:"},action:{pick:function(){blogThreadPage.setSource(cloud.getSubset(this.data.title))}}}})}}}});times.push([new Date,"post list"]);var postByCategory=new basis.data.dataset.Split({source:allPostDataset,rule:"data.category"});var categoryList=new basis.ui.Container({dataSource:postByCategory,template:basis.resource("20.tmpl"),childClass:{template:basis.resource("21.tmpl"),binding:{title:"data:"},action:{choose:function(){blogThreadPage.setSource(this.delegate)}}}});times.push([new Date,"category list"]);var MONTH="January February March April May June July August September October November December".qw();var archiveList=new basis.ui.Container({dataSource:new basis.data.dataset.Split({source:allPostDataset,rule:"data.pubDate.substr(0, 7)"}),sorting:"data.id",sortingDesc:true,grouping:{groupGetter:"data.id.substr(0, 4)",sorting:"data.id",sortingDesc:true,childClass:{collapsed:true,template:basis.resource("22.tmpl"),binding:{collapsed:function(node){return node.collapsed?"collapsed":""}},action:{toggle:function(){this.collapsed=!this.collapsed;this.updateBind("collapsed")}}}},template:basis.resource("23.tmpl"),childClass:{template:basis.resource("24.tmpl"),binding:{count:"delegate.itemCount",title:function(node){return MONTH[node.data.id.substr(5)-1]}},action:{choose:function(){blogThreadPage.setSource(this.delegate)}},listen:{delegate:{datasetChanged:function(){this.updateBind("count")}}}}});archiveList.grouping.firstChild.collapsed=false;archiveList.grouping.firstChild.updateBind("collapsed");times.push([new Date,"archive list"]);var cloud=new basis.data.dataset.Cloud({source:allPostDataset,rule:"data.tags"});var cloudCalcs=new basis.data.index.IndexMap({source:cloud,indexes:{itemCountMin:basis.data.index.min("itemCount","datasetChanged"),itemCountMax:basis.data.index.max("itemCount","datasetChanged")},calcs:{percentOfMax:function(data,indexes,obj){return(obj.itemCount-indexes.itemCountMin)/(indexes.itemCountMax-indexes.itemCountMin)},source:function(data,indexes,obj){return obj}},ruleEvents:{datasetChanged:true}});var tagCloud=new basis.ui.Container({dataSource:cloudCalcs,sorting:"data.title",template:basis.resource("25.tmpl"),childClass:{active:true,template:basis.resource("26.tmpl"),binding:{title:"data.source.data.title",fontSize:{events:"update",getter:function(node){return"{0:.2}%".format(80+120*node.data.percentOfMax.fit(0,1))}}},action:{pick:function(){blogThreadPage.setSource(this.data.source)}}}});times.push([new Date,"tag cloud"]);var app=new basis.ui.Node({container:document.body,template:basis.resource("27.tmpl"),binding:{paginator:"satellite:",postList:"satellite:",categoryList:"satellite:",tagCloud:"satellite:",archiveList:"satellite:",stat:Function.$const(statOutElement)},action:{reset:function(){blogThreadPage.setSource(allPostDataset)}},satellite:{paginator:paginator,postList:postList,categoryList:categoryList,archiveList:archiveList,tagCloud:tagCloud}});times.push([new Date,"app"]);outStat()})}],
// ../../../src/basis/entity.js
["basis.entity", function(basis, module, exports, resource, global, __dirname, __filename){var namespace=this.path;var Class=basis.Class;var extend=Object.extend;var complete=Object.complete;var arrayFrom=Array.from;var $self=Function.$self;var getter=Function.getter;var EventObject=basis.event.EventObject;var createEvent=basis.event.create;var nsData=basis.data;var AbstractDataset=nsData.AbstractDataset;var Dataset=nsData.Dataset;var Collection=nsData.dataset.Subset;var Grouping=nsData.dataset.Split;var DataObject=nsData.DataObject;var STATE=nsData.STATE;var NULL_INFO={};var isKeyType={string:1,number:1};var entityTypes=[];var NumericId=function(value){return isNaN(value)?null:Number(value)};var NumberId=function(value){return isNaN(value)?null:Number(value)};var IntId=function(value){return isNaN(value)?null:parseInt(value)};var StringId=function(value){return value==null?null:String(value)};var untitledNames={};function getUntitledName(name){untitledNames[name]=untitledNames[name]||0;return name+untitledNames[name]++}var Index=basis.Class(null,{className:namespace+".Index",init:function(normalize){var index=this.index={};this.normalize=normalize;this.valueWrapper=function(newValue,oldValue){var value=normalize(newValue,oldValue);if(value!==oldValue&&index[value]){return oldValue}return value};this.calcWrapper=function(newValue,oldValue){var value=normalize(newValue,oldValue);if(value!==oldValue&&index[value])throw"Duplicate value for index "+oldValue+" => "+newValue;return value}},get:function(value,checkType){var item=this.index[value];if(item&&(!checkType||item instanceof checkType))return item},add:function(value,item){var curr=this.index[value];if(item&&(!curr||curr===item)){this.index[value]=item;return true}},remove:function(value,item){if(this.index[value]===item){delete this.index[value];return true}},destroy:function(){this.index=null}});function CalculateField(){var args=Array.from(arguments);var func=args.pop();if(typeof func!="function")console.warn("Last argument for calculate field constructor must be a function");var cond=[];var calcArgs=[];for(var i=0,name;i<args.length;i++){var name=args[i].quote('"');cond.push(name+" in delta");calcArgs.push("data["+name+"]")}var result=(new Function("calc","return function(delta, data, oldValue){"+(cond.length?"if ("+cond.join(" || ")+")":"")+"return calc("+calcArgs.join(", ")+");"+(cond.length?"return oldValue;":"")+"}"))(func);result.args=args;result.isCalcField=true;return result}function ConcatString(){return CalculateField.apply(null,Array.from(arguments).concat(function(){var value=[];for(var i=arguments.length;i-->0;){if(arguments[i]==null)return null;value.push(arguments[i])}return value.join("-")}))}var ENTITYSET_WRAP_METHOD=function(superClass,method){return function(data){return superClass.prototype[method].call(this,data&&data.map(this.wrapper))}};var ENTITYSET_INIT_METHOD=function(superClass,name){return function(){if(!this.name)this.name=getUntitledName(name);superClass.prototype.init.call(this)}};var ENTITYSET_SYNC_METHOD=function(superClass){return function(data,set){Dataset.setAccumulateState(true);data=(data||[]).map(this.wrapper);Dataset.setAccumulateState(false);var res=superClass.prototype.sync.call(this,data,set);return res}};var EntitySet=Class(Dataset,{className:namespace+".EntitySet",wrapper:Function.$self,init:ENTITYSET_INIT_METHOD(Dataset,"EntitySet"),sync:ENTITYSET_SYNC_METHOD(Dataset),set:ENTITYSET_WRAP_METHOD(Dataset,"set"),add:ENTITYSET_WRAP_METHOD(Dataset,"add"),remove:ENTITYSET_WRAP_METHOD(Dataset,"remove"),destroy:function(){Dataset.prototype.destroy.call(this);delete this.wrapper}});var ReadOnlyEntitySet=Class(EntitySet,{className:namespace+".ReadOnlyEntitySet",set:Function.$false,add:Function.$false,remove:Function.$false,clear:Function.$false});var EntityCollection=Class(Collection,{className:namespace+".EntityCollection",init:ENTITYSET_INIT_METHOD(Collection,"EntityCollection"),sync:ENTITYSET_SYNC_METHOD(Collection)});EntityCollection.sourceHandler=Collection.sourceHandler;var EntityGrouping=Class(Grouping,{className:namespace+".EntityGrouping",subsetClass:ReadOnlyEntitySet,init:ENTITYSET_INIT_METHOD(Grouping,"EntityGrouping"),sync:ENTITYSET_SYNC_METHOD(Grouping),getSubset:function(object,autocreate){var group=Grouping.prototype.getSubset.call(this,object,autocreate);if(group)group.wrapper=this.wrapper;return group}});var EntitySetWrapper=function(wrapper){if(this instanceof EntitySetWrapper){if(!wrapper)wrapper=$self;var entitySetType=new EntitySetConstructor({entitySetClass:{name:"Set of {"+((wrapper.entityType||wrapper).name||"UnknownWrapper")+"}",wrapper:wrapper}});var result=function(data,entitySet){if(data!=null){if(!(entitySet instanceof EntitySet))entitySet=entitySetType.createEntitySet();entitySet.set(data instanceof Dataset?data.getItems():Array.from(data));return entitySet}else return null};result.entitySetType=entitySetType;return result}};var EntitySetConstructor=Class(null,{className:namespace+".EntitySetConstructor",entitySetClass:EntitySet,extendConstructor_:true,createEntitySet:function(){return new this.entitySetClass}});var EntityTypeWrapper=function(config){if(this instanceof EntityTypeWrapper){var result=function(data,entity){if(data!=null){if(data===entity||data.entityType===entityType)return data;var idValue;var idField=entityType.idField;if(isKeyType[typeof data]){if(!idField)return;idValue=data;data={};data[idField]=idValue}else{if(entityType.compositeKey)idValue=entityType.compositeKey(data,data);else if(idField)idValue=data[idField];else{if(isSingleton){entity=entityType.singleton;if(!entity)return entityType.singleton=new entityClass(data)}}}if(idValue!=null&&index)entity=index.get(idValue,entityType.entityClass);if(entity&&entity.entityType===entityType)entity.update(data);else entity=new entityClass(data);return entity}else return entityType.singleton};var entityType=new EntityTypeConstructor(config||{},result);var index=entityType.index__;var entityClass=entityType.entityClass;var isSingleton=entityType.isSingleton;extend(result,{toString:function(){return this.typeName+"()"},entityType:entityType,type:result,typeName:entityType.name,index:index,reader:function(data){return entityType.reader(data)},get:function(data){return entityType.get(data)},addField:function(key,wrapper){entityType.addField(key,wrapper)},all:entityType.all,createCollection:function(name,memberSelector,dataset){var collection=entityType.collection_[name];if(!collection&&memberSelector){return entityType.collection_[name]=new EntityCollection({wrapper:result,source:dataset||entityType.all,rule:memberSelector})}return collection},getCollection:function(name){return entityType.collection_[name]},createGrouping:function(name,rule,dataset){var grouping=entityType.grouping_[name];if(!grouping&&rule){return entityType.grouping_[name]=new EntityGrouping({wrapper:result,source:dataset||entityType.all,rule:rule})}return grouping},getGrouping:function(name){return entityType.grouping_[name]},getSlot:function(index,defaults){return entityType.getSlot(index,defaults)}});return result}};var getSingleton=getter("singleton");var fieldDestroyHandlers={};var Slot=Class(DataObject,{className:namespace+".Slot"});var EntityTypeConstructor=Class(null,{className:namespace+".EntityType",name:"UntitledEntityType",defaults:null,fields:null,extensible:false,index__:null,slot_:null,init:function(config,wrapper){this.name=config.name||getUntitledName(this.name);var entityClass__;var idField;this.index__=config.index;this.idFields={};entityTypes.push(this);this.isSingleton=config.isSingleton;this.wrapper=wrapper;this.all=new ReadOnlyEntitySet(Object.extend(config.all||{},{wrapper:wrapper}));this.slot_={};if(config.extensible)this.extensible=true;this.fields={};this.defaults={};this.aliases={};this.getters={};Object.iterate(config.fields,this.addField,this);if(config.constrains)config.constrains.forEach(function(item){this.addCalcField(null,item)},this);if(this.isSingleton)this.get=getSingleton;if(config.aliases)Object.iterate(config.aliases,this.addAlias,this);this.collection_={};if(config.collections){for(var name in config.collections){this.collection_[name]=new EntityCollection({name:name,wrapper:wrapper,source:this.all,rule:config.collections[name]||Function.$true})}}this.grouping_={};if(config.groupings){for(var name in config.groupings){this.grouping_[name]=new EntityGrouping({name:name,wrapper:wrapper,source:this.all,rule:config.groupings[name]||Function.$true})}}idField=this.idField;entityClass__=this.entityClass=Entity(this,this.all,this.index__,this.slot_,this.fields,this.defaults,this.getters).extend({entityType:this,type:wrapper,typeName:this.name,getId:function(){return this.__id__}})},reader:function(data){var result={};if(isKeyType[typeof data]){if(this.idField){result[this.idField]=data;return result}return null}if(!data||data==null)return null;for(var key in data){var fieldKey=key in this.aliases?this.aliases[key]:"";if(fieldKey&&fieldKey in this.fields){result[fieldKey]=this.fields[fieldKey].reader?this.fields[fieldKey].reader(data[key]):data[key]}}return result},addAlias:function(alias,key){if(key in this.fields){if(alias in this.aliases==false)this.aliases[alias]=key}},addField:function(key,config){if(this.all.itemCount){return}this.aliases[key]=key;if(typeof config=="function"){config={type:config}}if("type"in config&&typeof config.type!="function"){config.type=$self}var wrapper=config.type||$self;var calcWrapper;if([NumericId,NumberId,IntId,StringId].has(wrapper))config.id=true;if(config.id){if(!this.index__)this.index__=new Index(String);this.idFields[key]=true;if(this.idField||this.compositeKey){this.idField=null;this.compositeKey=ConcatString.apply(null,Object.keys(this.idFields))}else{this.idField=key}}if(config.calc)this.addCalcField(key,config.calc,calcWrapper);else this.fields[key]=wrapper;this.defaults[key]="defValue"in config?config.defValue:wrapper();this.getters["get_"+key]=function(){return this.data[key]};if(!fieldDestroyHandlers[key])fieldDestroyHandlers[key]={destroy:function(){this.set(key,null)}}},addCalcField:function(key,wrapper,valueWrapper){if(key&&this.fields[key]){return}if(!this.calcs)this.calcs=[];var calcConfig={args:wrapper.args||[],wrapper:!valueWrapper?wrapper:function(delta,data,oldValue){return valueWrapper(wrapper(delta,data,oldValue))}};var before=this.calcs.length;var after=0;for(var i=0;i<this.calcs.length;i++)if(wrapper.args.has(this.calcs[i].key))after=i+1;if(key){calcConfig.key=key;for(var i=0;i<this.calcs.length;i++)if(this.calcs[i].args.has(key)){before=i;break}if(after>before){return}if(this.idField&&key==this.idField)this.compositeKey=wrapper;this.fields[key]=function(value,oldValue){return oldValue}}else{before=after}this.calcs.splice(Math.min(before,after),0,calcConfig)},get:function(entityOrData){var id=this.getId(entityOrData);if(id!=null)return this.index__.get(id,this.entityClass)},getId:function(entityOrData){if((this.idField||this.compositeKey)&&entityOrData!=null){if(isKeyType[typeof entityOrData])return entityOrData;if(entityOrData&&entityOrData.entityType===this)return entityOrData.__id__;if(entityOrData instanceof DataObject)entityOrData=entityOrData.data;if(this.compositeKey)return this.compositeKey(entityOrData,entityOrData);else return entityOrData[this.idField]}},getSlot:function(data){var id=this.getId(data);if(id!=null){var slot=this.slot_[id];if(!slot){if(isKeyType[typeof data]){var tmp={};if(this.idField&&!this.compositeKey)tmp[this.idField]=data;data=tmp}slot=this.slot_[id]=new DataObject({delegate:this.get(id),data:data})}return slot}}});function entityWarn(entity,message){}function fieldCleaner(key){this.set(key,null)}var BaseEntity=Class(DataObject,{className:namespace+".BaseEntity",init:EventObject.prototype.init,event_rollbackUpdate:createEvent("rollbackUpdate")});var Entity=function(entityType,all,index__,typeSlot,fields,defaults,getters){var idField=entityType.idField;function rollbackChanges(entity,delta,rollbackDelta){for(var key in delta)entity.data[key]=delta[key];if(rollbackDelta)for(var key in rollbackDelta){if(!entity.modified){entity.modified=rollbackDelta}else{}}}function calc(entity,delta,rollbackDelta){var update=false;var calcs=entityType.calcs;var id=entity.__id__;var data=entity.data;try{if(calcs){for(var i=0,calc;calc=calcs[i++];){var key=calc.key;if(key){var oldValue=data[key];data[key]=calc.wrapper(delta,data,data[key]);if(data[key]!==oldValue){delta[key]=oldValue;update=true}}else calc.wrapper(delta,data)}}if(entityType.compositeKey)entity.__id__=entityType.compositeKey(delta,data,entity.__id__);else if(idField&&idField in delta)entity.__id__=data[idField];if(entity.__id__!==id)entityType.index__.calcWrapper(entity.__id__)}catch(e){entity.__id__=id;rollbackChanges(entity,delta,rollbackDelta);update=false}if(entity.__id__!==id)updateIndex(entity,id,entity.__id__);return update}function updateIndex(entity,curValue,newValue){if(curValue!=null){index__.remove(curValue,entity);if(typeSlot[curValue])typeSlot[curValue].setDelegate()}if(newValue!=null){index__.add(newValue,entity);if(typeSlot[newValue])typeSlot[newValue].setDelegate(entity)}}return Class(BaseEntity,getters,{className:namespace+".Entity",canHaveDelegate:false,modified:null,isTarget:true,extendConstructor_:false,init:function(data){BaseEntity.prototype.init.call(this);this.fieldHandlers_={};this.data={};this.root=this;this.target=this;var value;var delta={};for(var key in fields){if(key in data){delta[key]=defaults[key];value=fields[key](data[key])}else{value=defaults[key]}if(value&&value!==this&&value instanceof EventObject){if(value.addHandler(fieldDestroyHandlers[key],this))this.fieldHandlers_[key]=true}this.data[key]=value}calc(this,delta);all.event_datasetChanged({inserted:[this]})},toString:function(){return"[object "+this.constructor.className+"("+this.entityType.name+")]"},get:function(key){return this.data[key]},set:function(key,value,rollback,silent_){var valueWrapper=fields[key];if(!valueWrapper){if(!entityType.extensible){return}valueWrapper=$self}var delta;var updateDelta;var result;var rollbackData=this.modified;var newValue=valueWrapper(value,this.data[key]);var curValue=this.data[key];var valueChanged=newValue!==curValue&&(!newValue||!curValue||newValue.constructor!==Date||curValue.constructor!==Date||+newValue!==+curValue);if(valueChanged)updateField:{result={};if(key!=idField){if(rollback){if(!rollbackData)this.modified=rollbackData={};if(key in rollbackData===false){result.rollback={key:key,value:undefined};rollbackData[key]=curValue}else{if(rollbackData[key]===newValue){result.rollback={key:key,value:newValue};delete rollbackData[key];if(!Object.keys(rollbackData).length)this.modified=null}}}else{if(rollbackData&&key in rollbackData){if(rollbackData[key]!==newValue){result.rollback={key:key,value:rollbackData[key]};rollbackData[key]=newValue;break updateField}else return false}}}this.data[key]=newValue;if(this.fieldHandlers_[key]){curValue.removeHandler(fieldDestroyHandlers[key],this);this.fieldHandlers_[key]=false}if(newValue&&newValue!==this&&newValue instanceof EventObject){if(newValue.addHandler(fieldDestroyHandlers[key],this))this.fieldHandlers_[key]=true}result.key=key;result.value=curValue;result.delta={};result.delta[key]=curValue}else{if(!rollback&&rollbackData&&key in rollbackData){result={rollback:{key:key,value:rollbackData[key]}};delete rollbackData[key];if(!Object.keys(rollbackData).length)this.modified=null}}if(!silent_&&result){var update=result.key;var delta=result.delta||{};var rollbackDelta;if(result.rollback){rollbackDelta={};rollbackDelta[result.rollback.key]=result.rollback.value}if(calc(this,delta,rollbackDelta))update=true;if(update){this.event_update(delta);result.delta=delta}if(rollbackDelta)this.event_rollbackUpdate(rollbackDelta)}return result||false},update:function(data,rollback){if(data){var update;var delta={};var rollbackUpdate;var rollbackDelta={};var setResult;for(var key in data){if(setResult=this.set(key,data[key],rollback,true)){if(setResult.key){update=true;delta[setResult.key]=setResult.value}if(setResult.rollback){rollbackUpdate=true;rollbackDelta[setResult.rollback.key]=setResult.rollback.value}}}if(calc(this,delta,rollbackDelta))update=true;if(update)this.event_update(delta);if(rollbackUpdate)this.event_rollbackUpdate(rollbackDelta)}return update?delta:false},reset:function(){this.update(defaults)},clear:function(){var data={};for(var key in this.data)data[key]=undefined;return this.update(data)},commit:function(data){if(this.modified){var rollbackData=this.modified;this.modified=null}this.update(data);if(rollbackData)this.event_rollbackUpdate(rollbackData)},rollback:function(){if(this.state==STATE.PROCESSING){return}if(this.modified){var rollbackData=this.modified;this.modified=null;this.update(rollbackData);this.event_rollbackUpdate(rollbackData)}this.setState(STATE.READY)},destroy:function(){for(var key in this.fieldHandlers_)if(this.fieldHandlers_[key])this.data[key].removeHandler(fieldDestroyHandlers[key],this);this.fieldHandlers_=NULL_INFO;if(this.__id__!=null)updateIndex(this,this.__id__,null);DataObject.prototype.destroy.call(this);all.event_datasetChanged({deleted:[this]});this.data=NULL_INFO;this.modified=null}})};function isEntity(value){return value&&value instanceof Entity}module.exports={isEntity:isEntity,NumericId:NumericId,NumberId:NumberId,IntId:IntId,StringId:StringId,Index:Index,CalculateField:CalculateField,EntityType:EntityTypeWrapper,Entity:Entity,BaseEntity:BaseEntity,EntitySetType:EntitySetWrapper,EntitySet:EntitySet,ReadOnlyEntitySet:ReadOnlyEntitySet,Collection:EntityCollection,Grouping:EntityGrouping}}]].forEach(function (module){
           var fn = module[1];
           var ns = basis.namespace(module[0]);
           // basis, module, exports, resource, global, __dirname, __filename
           fn.call(ns, basis, ns, ns.exports, basis.resource, this, "", "");
           Object.complete(ns, ns.exports);
         }, this)
}).call(this);